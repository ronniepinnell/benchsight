<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenchSight Documentation Hub</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary: #3182ce;
            --primary-dark: #2c5282;
            --success: #38a169;
            --warning: #d69e2e;
            --error: #e53e3e;
            --bg: #f7fafc;
            --card-bg: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .header .subtitle {
            opacity: 0.9;
            font-size: 1.2em;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 0.9em;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .nav {
            display: flex;
            gap: 10px;
            padding: 20px 0;
            flex-wrap: wrap;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 100;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .nav-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .card h2 {
            color: var(--primary-dark);
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .card h3 {
            color: var(--primary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--bg);
            font-weight: 600;
        }
        
        tr:hover {
            background: var(--bg);
        }
        
        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
        }
        
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .status-pass { color: var(--success); }
        .status-fail { color: var(--error); }
        .status-warn { color: var(--warning); }
        
        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .checklist li:before {
            content: '‚òê ';
            color: var(--primary);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .badge-success { background: #c6f6d5; color: #22543d; }
        .badge-warning { background: #fefcbf; color: #744210; }
        .badge-error { background: #fed7d7; color: #822727; }
        .badge-info { background: #bee3f8; color: #2a4365; }
        
        .command-box {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .copy-btn {
            float: right;
            background: var(--primary);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèí BenchSight Documentation</h1>
        <div class="subtitle">Hockey Analytics Platform - Complete Reference</div>
    </div>
    
    <div class="stats-bar">
        <div class="stat">
            <div class="stat-value">98%</div>
            <div class="stat-label">Complete</div>
        </div>
        <div class="stat">
            <div class="stat-value">317</div>
            <div class="stat-label">Stat Columns</div>
        </div>
        <div class="stat">
            <div class="stat-value">131</div>
            <div class="stat-label">Tests Passing</div>
        </div>
        <div class="stat">
            <div class="stat-value">100%</div>
            <div class="stat-label">Goal Accuracy</div>
        </div>
        <div class="stat">
            <div class="stat-value">45</div>
            <div class="stat-label">Tables</div>
        </div>
    </div>
    
    <div class="container">
        <div class="nav">
            <button class="nav-btn active" onclick="showSection('overview')">üìã Overview</button>
            <button class="nav-btn" onclick="showSection('architecture')">üèóÔ∏è Architecture</button>
            <button class="nav-btn" onclick="showSection('schema')">üóÑÔ∏è Schema</button>
            <button class="nav-btn" onclick="showSection('etl')">‚öôÔ∏è ETL Flow</button>
            <button class="nav-btn" onclick="showSection('deployment')">üöÄ Deployment</button>
            <button class="nav-btn" onclick="showSection('validation')">‚úÖ Validation</button>
            <button class="nav-btn" onclick="showSection('commands')">üíª Commands</button>
            <button class="nav-btn" onclick="showSection('roadmap')">üéØ Roadmap</button>
        </div>

        <!-- OVERVIEW SECTION -->
        <div id="overview" class="section active">
            <div class="card">
                <h2>Project Overview</h2>
                <p>BenchSight is a comprehensive hockey analytics ETL pipeline for the NORAD recreational hockey league. It transforms raw game tracking data into NHL-caliber statistics.</p>
                
                <h3>What It Does</h3>
                <ul>
                    <li>Processes Excel tracking files (events, shifts, rosters)</li>
                    <li>Calculates 317 statistics per player per game</li>
                    <li>Verifies accuracy against official noradhockey.com scores</li>
                    <li>Monitors data quality with automated QA</li>
                    <li>Deploys to Supabase PostgreSQL</li>
                </ul>
            </div>
            
            <div class="card">
                <h2>Current Status</h2>
                <table>
                    <tr><th>Metric</th><th>Value</th><th>Status</th></tr>
                    <tr><td>Goal Accuracy</td><td>17/17 (100%)</td><td class="status-pass">‚úÖ Verified</td></tr>
                    <tr><td>Validation Tests</td><td>131</td><td class="status-pass">‚úÖ All Pass</td></tr>
                    <tr><td>Games Loaded</td><td>4</td><td class="status-pass">‚úÖ Complete</td></tr>
                    <tr><td>Games Untracked</td><td>3</td><td class="status-warn">‚ö†Ô∏è Template Only</td></tr>
                    <tr><td>Supabase</td><td>Ready</td><td class="status-warn">‚ö†Ô∏è Not Deployed</td></tr>
                </table>
            </div>
            
            <div class="card">
                <h2>Goal Verification</h2>
                <table>
                    <tr><th>Game</th><th>Teams</th><th>Official</th><th>Ours</th><th>Match</th></tr>
                    <tr><td>18969</td><td>Platinum vs Velodrome</td><td>7</td><td>7</td><td class="status-pass">‚úÖ</td></tr>
                    <tr><td>18977</td><td>Velodrome vs HollowBrook</td><td>6</td><td>6</td><td class="status-pass">‚úÖ</td></tr>
                    <tr><td>18981</td><td>Nelson vs Velodrome</td><td>3</td><td>3</td><td class="status-pass">‚úÖ</td></tr>
                    <tr><td>18987</td><td>Outlaws vs Velodrome</td><td>1</td><td>1</td><td class="status-pass">‚úÖ</td></tr>
                </table>
            </div>
        </div>

        <!-- ARCHITECTURE SECTION -->
        <div id="architecture" class="section">
            <div class="card">
                <h2>System Architecture</h2>
                <div class="mermaid">
flowchart TB
    subgraph External["External Systems"]
        NORAD["noradhockey.com"]
        TRACKER["Game Tracker"]
    end

    subgraph DataLayer["Data Layer"]
        BLB[("BLB_Tables.xlsx")]
        RAW[("Tracking Files")]
        OUTPUT[("45 CSV Files")]
    end

    subgraph ETLLayer["ETL Pipeline"]
        E1["1. etl.py"]
        E2["2. orchestrator.py"]
        E3["3. enhance_stats.py"]
        E4["4. qa_facts.py"]
    end

    subgraph Storage["Storage"]
        SUPA[("Supabase")]
    end

    NORAD --> BLB
    TRACKER --> RAW
    BLB --> E1
    RAW --> E1
    E1 --> E2 --> E3 --> E4
    E4 --> OUTPUT --> SUPA
                </div>
            </div>
            
            <div class="card">
                <h2>File Organization</h2>
                <pre><code>benchsight_combined 6/
‚îú‚îÄ‚îÄ etl.py                  # Entry point
‚îú‚îÄ‚îÄ START_HERE.md           # Reading guide
‚îú‚îÄ‚îÄ src/                    # Core modules
‚îÇ   ‚îú‚îÄ‚îÄ etl_orchestrator.py # Fact builder
‚îÇ   ‚îî‚îÄ‚îÄ enhance_all_stats.py# Stat enhancement
‚îú‚îÄ‚îÄ scripts/                # Utilities
‚îÇ   ‚îú‚îÄ‚îÄ supabase_loader.py  # Flexible upload
‚îÇ   ‚îî‚îÄ‚îÄ qa_dynamic.py       # Validation
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ BLB_Tables.xlsx     # Master data
‚îÇ   ‚îú‚îÄ‚îÄ raw/games/          # Tracking files
‚îÇ   ‚îî‚îÄ‚îÄ output/             # 45 CSVs
‚îú‚îÄ‚îÄ sql/                    # DDL scripts
‚îî‚îÄ‚îÄ docs/                   # Documentation</code></pre>
            </div>
        </div>

        <!-- SCHEMA SECTION -->
        <div id="schema" class="section">
            <div class="card">
                <h2>Entity Relationship Diagram</h2>
                <div class="mermaid">
erDiagram
    dim_player ||--o{ fact_player_game_stats : "plays in"
    dim_schedule ||--o{ fact_player_game_stats : "has"
    dim_player ||--o{ fact_events_player : "participates"
    dim_player ||--o{ fact_shifts_player : "takes"
    dim_team ||--o{ dim_schedule : "plays"
    
    dim_player {
        string player_id PK
        string player_full_name
        int current_skill_rating
    }
    
    dim_schedule {
        int game_id PK
        int home_total_goals
        int away_total_goals
    }
    
    fact_player_game_stats {
        string player_game_key PK
        int game_id FK
        string player_id FK
        int goals
        int assists
        float toi_seconds
    }
                </div>
            </div>
            
            <div class="card">
                <h2>Table Summary</h2>
                <div class="grid">
                    <div>
                        <h3>Dimension Tables (25)</h3>
                        <table>
                            <tr><th>Table</th><th>Rows</th></tr>
                            <tr><td>dim_player</td><td>~298</td></tr>
                            <tr><td>dim_team</td><td>~15</td></tr>
                            <tr><td>dim_schedule</td><td>~562</td></tr>
                            <tr><td>dim_league</td><td>~2</td></tr>
                            <tr><td>dim_season</td><td>~8</td></tr>
                        </table>
                    </div>
                    <div>
                        <h3>Fact Tables (17)</h3>
                        <table>
                            <tr><th>Table</th><th>Rows</th></tr>
                            <tr><td>fact_player_game_stats</td><td>~107</td></tr>
                            <tr><td>fact_events_player</td><td>~11,635</td></tr>
                            <tr><td>fact_shifts_player</td><td>~4,626</td></tr>
                            <tr><td>fact_h2h</td><td>~684</td></tr>
                            <tr><td>fact_wowy</td><td>~641</td></tr>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Primary Key Structure</h2>
                <table>
                    <tr><th>Entity</th><th>Format</th><th>Example</th></tr>
                    <tr><td>Player</td><td>P100XXX</td><td>P100001</td></tr>
                    <tr><td>Team</td><td>N100XX</td><td>N10001</td></tr>
                    <tr><td>Event</td><td>E{game:05d}{event:06d}</td><td>E18969001234</td></tr>
                    <tr><td>Shift</td><td>S{game:05d}{shift:06d}</td><td>S18969000001</td></tr>
                </table>
            </div>
        </div>

        <!-- ETL SECTION -->
        <div id="etl" class="section">
            <div class="card">
                <h2>ETL Pipeline Flow</h2>
                <div class="mermaid">
flowchart LR
    subgraph Step1["Step 1: etl.py"]
        S1["Load BLB_Tables.xlsx<br/>‚Üí 25 dim tables"]
    end
    subgraph Step2["Step 2: orchestrator.py"]
        S2["Build fact tables<br/>‚Üí 17 fact tables"]
    end
    subgraph Step3["Step 3: enhance_stats.py"]
        S3["Add 317 columns<br/>‚Üí Enhanced stats"]
    end
    subgraph Step4["Step 4: qa_facts.py"]
        S4["Build QA tables<br/>‚Üí 3 QA tables"]
    end
    
    Step1 --> Step2 --> Step3 --> Step4
                </div>
            </div>
            
            <div class="card">
                <h2>Runtime Performance</h2>
                <table>
                    <tr><th>Step</th><th>Script</th><th>Time</th><th>Output</th></tr>
                    <tr><td>1</td><td>etl.py</td><td>~8s</td><td>25 dim tables</td></tr>
                    <tr><td>2</td><td>etl_orchestrator.py</td><td>~15s</td><td>17 fact tables</td></tr>
                    <tr><td>3</td><td>enhance_all_stats.py</td><td>~5s</td><td>317 columns</td></tr>
                    <tr><td>4</td><td>build_qa_facts.py</td><td>~10s</td><td>3 QA tables</td></tr>
                    <tr><th>Total</th><th></th><th>~43s</th><th>45 tables</th></tr>
                </table>
            </div>
        </div>

        <!-- DEPLOYMENT SECTION -->
        <div id="deployment" class="section">
            <div class="card">
                <h2>Supabase Deployment</h2>
                
                <h3>Step 1: Configure Credentials</h3>
                <div class="command-box">
                    export SUPABASE_URL="https://your-project.supabase.co"<br>
                    export SUPABASE_KEY="your-anon-key"
                </div>
                
                <h3>Step 2: Test Connection</h3>
                <div class="command-box">
                    python scripts/supabase_test_connection.py
                </div>
                
                <h3>Step 3: Full Rebuild</h3>
                <div class="command-box">
                    python scripts/supabase_loader.py --rebuild
                </div>
            </div>
            
            <div class="card">
                <h2>Upload Options</h2>
                <table>
                    <tr><th>Command</th><th>Description</th></tr>
                    <tr><td><code>--all</code></td><td>Upload all tables</td></tr>
                    <tr><td><code>--dims</code></td><td>Upload dimension tables only</td></tr>
                    <tr><td><code>--facts</code></td><td>Upload fact tables only</td></tr>
                    <tr><td><code>--tables x,y</code></td><td>Upload specific tables</td></tr>
                    <tr><td><code>--games x,y</code></td><td>Upload specific games only</td></tr>
                    <tr><td><code>--mode replace</code></td><td>Delete then insert (default)</td></tr>
                    <tr><td><code>--mode append</code></td><td>Add to existing data</td></tr>
                    <tr><td><code>--rebuild</code></td><td>Drop + create + upload all</td></tr>
                    <tr><td><code>--teardown</code></td><td>Drop all tables</td></tr>
                    <tr><td><code>--verify</code></td><td>Verify upload matches local</td></tr>
                </table>
            </div>
        </div>

        <!-- VALIDATION SECTION -->
        <div id="validation" class="section">
            <div class="card">
                <h2>Validation Test Suites</h2>
                <table>
                    <tr><th>Suite</th><th>Tests</th><th>Status</th></tr>
                    <tr><td>qa_dynamic.py</td><td>17</td><td class="status-pass">‚úÖ All Pass</td></tr>
                    <tr><td>qa_comprehensive.py</td><td>52</td><td class="status-pass">‚úÖ All Pass</td></tr>
                    <tr><td>test_validations.py</td><td>54</td><td class="status-pass">‚úÖ All Pass</td></tr>
                    <tr><td>enhanced_validations.py</td><td>8</td><td class="status-pass">‚úÖ All Pass</td></tr>
                    <tr><th>Total</th><th>131</th><th class="status-pass">‚úÖ All Pass</th></tr>
                </table>
            </div>
            
            <div class="card">
                <h2>QA Monitoring Tables</h2>
                <table>
                    <tr><th>Table</th><th>Purpose</th></tr>
                    <tr><td>fact_game_status</td><td>Game completeness tracking</td></tr>
                    <tr><td>fact_suspicious_stats</td><td>Outlier logging</td></tr>
                    <tr><td>fact_player_game_position</td><td>Dynamic position assignment</td></tr>
                </table>
            </div>
        </div>

        <!-- COMMANDS SECTION -->
        <div id="commands" class="section">
            <div class="card">
                <h2>Quick Reference Commands</h2>
                
                <h3>ETL Pipeline</h3>
                <div class="command-box">
python etl.py && \<br>
python src/etl_orchestrator.py --all && \<br>
python src/enhance_all_stats.py && \<br>
python scripts/build_qa_facts.py
                </div>
                
                <h3>Validation</h3>
                <div class="command-box">
python scripts/qa_dynamic.py
                </div>
                
                <h3>Supabase</h3>
                <div class="command-box">
# Test connection<br>
python scripts/supabase_test_connection.py<br><br>
# Full rebuild<br>
python scripts/supabase_loader.py --rebuild<br><br>
# Upload specific tables<br>
python scripts/supabase_loader.py --tables dim_player,fact_player_game_stats
                </div>
            </div>
        </div>

        <!-- ROADMAP SECTION -->
        <div id="roadmap" class="section">
            <div class="card">
                <h2>Goals Roadmap</h2>
                
                <h3>üî¥ Short-Term (Next Session)</h3>
                <ul class="checklist">
                    <li>Deploy to Supabase</li>
                    <li>Verify all row counts</li>
                    <li>Track remaining games (18965, 18991, 19032)</li>
                </ul>
                
                <h3>üü° Mid-Term (1-2 Months)</h3>
                <ul class="checklist">
                    <li>Load 50+ games</li>
                    <li>Build Power BI dashboard</li>
                    <li>Add incremental loading</li>
                </ul>
                
                <h3>üü¢ Long-Term (3-6 Months)</h3>
                <ul class="checklist">
                    <li>Expected Goals (xG) model</li>
                    <li>Real-time game tracking</li>
                    <li>Multi-league support</li>
                </ul>
            </div>
            
            <div class="card">
                <h2>Confidence Assessment</h2>
                <table>
                    <tr><th>Area</th><th>Confidence</th></tr>
                    <tr><td>Data Accuracy</td><td><span class="badge badge-success">95%</span></td></tr>
                    <tr><td>External Verification</td><td><span class="badge badge-success">100%</span></td></tr>
                    <tr><td>Scalability</td><td><span class="badge badge-warning">85%</span></td></tr>
                    <tr><td>Error Handling</td><td><span class="badge badge-warning">80%</span></td></tr>
                    <tr><td>Data Integrity</td><td><span class="badge badge-success">95%</span></td></tr>
                    <tr><th>Overall</th><th><span class="badge badge-success">90%</span></th></tr>
                </table>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>BenchSight Documentation Hub | Last Updated: December 29, 2024</p>
        <p>NHL-caliber analytics for beer league hockey</p>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
