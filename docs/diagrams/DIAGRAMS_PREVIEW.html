<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenchSight - Architecture & Schema Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #1a365d;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 10px;
        }
        h2 {
            color: #2c5282;
            margin-top: 40px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            overflow-x: auto;
        }
        .mermaid {
            display: flex;
            justify-content: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3182ce;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #edf2f7;
            font-weight: 600;
        }
        .status-pass { color: #38a169; }
        .status-fail { color: #e53e3e; }
        .status-warn { color: #d69e2e; }
    </style>
</head>
<body>
    <h1>üèí BenchSight - Hockey Analytics Platform</h1>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">98%</div>
            <div class="stat-label">Complete</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">317</div>
            <div class="stat-label">Stat Columns</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">131</div>
            <div class="stat-label">Tests Passing</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">100%</div>
            <div class="stat-label">Goal Accuracy</div>
        </div>
    </div>

    <h2>üìä System Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
flowchart TB
    subgraph External["External Systems"]
        NORAD["noradhockey.com"]
        TRACKER["Game Tracker"]
    end

    subgraph DataLayer["Data Layer"]
        BLB[("BLB_Tables.xlsx")]
        RAW[("Tracking Files")]
        OUTPUT[("45 CSV Files")]
    end

    subgraph ETLLayer["ETL Pipeline"]
        E1["1. etl.py"]
        E2["2. orchestrator.py"]
        E3["3. enhance_stats.py"]
        E4["4. qa_facts.py"]
    end

    subgraph ValidationLayer["Validation"]
        V1["131 Tests"]
    end

    subgraph StorageLayer["Storage"]
        SUPA[("Supabase")]
    end

    NORAD --> BLB
    TRACKER --> RAW
    BLB --> E1
    RAW --> E1
    E1 --> E2 --> E3 --> E4
    E4 --> OUTPUT
    OUTPUT --> ValidationLayer
    ValidationLayer --> SUPA
        </div>
    </div>

    <h2>üóÑÔ∏è Entity Relationship Diagram</h2>
    <div class="diagram-container">
        <div class="mermaid">
erDiagram
    dim_player ||--o{ fact_player_game_stats : "plays in"
    dim_schedule ||--o{ fact_player_game_stats : "has"
    dim_player ||--o{ fact_events_player : "participates"
    dim_player ||--o{ fact_shifts_player : "takes"
    dim_player ||--o{ fact_h2h : "faces"
    dim_player ||--o{ fact_wowy : "plays with"
    dim_team ||--o{ dim_schedule : "plays"
    
    dim_player {
        string player_id PK
        string player_full_name
        int current_skill_rating
    }
    
    dim_schedule {
        int game_id PK
        int home_total_goals
        int away_total_goals
        string game_url
    }
    
    fact_player_game_stats {
        string player_game_key PK
        int game_id FK
        string player_id FK
        int goals
        int assists
        float toi_seconds
    }
        </div>
    </div>

    <h2>‚öôÔ∏è ETL Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
flowchart LR
    subgraph Step1["Step 1"]
        S1["Load BLB_Tables.xlsx"]
    end
    subgraph Step2["Step 2"]
        S2["Build Fact Tables"]
    end
    subgraph Step3["Step 3"]
        S3["Add 317 Stats"]
    end
    subgraph Step4["Step 4"]
        S4["QA & Validate"]
    end
    
    Step1 --> Step2 --> Step3 --> Step4
        </div>
    </div>

    <h2>‚úÖ Validation Status</h2>
    <table>
        <tr>
            <th>Game</th>
            <th>Teams</th>
            <th>Official Score</th>
            <th>Our Goals</th>
            <th>Status</th>
        </tr>
        <tr>
            <td>18969</td>
            <td>Platinum vs Velodrome</td>
            <td>7</td>
            <td>7</td>
            <td class="status-pass">‚úÖ PASS</td>
        </tr>
        <tr>
            <td>18977</td>
            <td>Velodrome vs HollowBrook</td>
            <td>6</td>
            <td>6</td>
            <td class="status-pass">‚úÖ PASS</td>
        </tr>
        <tr>
            <td>18981</td>
            <td>Nelson vs Velodrome</td>
            <td>3</td>
            <td>3</td>
            <td class="status-pass">‚úÖ PASS</td>
        </tr>
        <tr>
            <td>18987</td>
            <td>Outlaws vs Velodrome</td>
            <td>1</td>
            <td>1</td>
            <td class="status-pass">‚úÖ PASS</td>
        </tr>
    </table>

    <h2>üìÅ Table Summary</h2>
    <table>
        <tr>
            <th>Category</th>
            <th>Tables</th>
            <th>Total Rows</th>
        </tr>
        <tr>
            <td>Dimension Tables</td>
            <td>25</td>
            <td>~1,500</td>
        </tr>
        <tr>
            <td>Fact Tables</td>
            <td>17</td>
            <td>~18,000</td>
        </tr>
        <tr>
            <td>QA Tables</td>
            <td>3</td>
            <td>~700</td>
        </tr>
    </table>

    <h2>üéØ Key Stats Available</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">15</div>
            <div class="stat-label">Scoring Stats</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">25</div>
            <div class="stat-label">Possession Stats</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">30</div>
            <div class="stat-label">Per-60 Rates</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">17</div>
            <div class="stat-label">Rating Adjusted</div>
        </div>
    </div>

    <h2>üöÄ Next Steps</h2>
    <table>
        <tr>
            <th>Priority</th>
            <th>Task</th>
            <th>Status</th>
        </tr>
        <tr>
            <td>üî¥ HIGH</td>
            <td>Deploy to Supabase</td>
            <td class="status-warn">Ready</td>
        </tr>
        <tr>
            <td>üü° MEDIUM</td>
            <td>Track remaining games</td>
            <td class="status-warn">Blocked</td>
        </tr>
        <tr>
            <td>üü¢ LOW</td>
            <td>Build Power BI dashboard</td>
            <td class="status-warn">Planned</td>
        </tr>
    </table>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>
</body>
</html>
