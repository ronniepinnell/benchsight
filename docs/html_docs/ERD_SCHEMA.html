<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenchSight Schema / ERD</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; }
        .nav { background: #2c3e50; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        .nav a { color: white; margin-right: 15px; text-decoration: none; }
        .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .section h2 { color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .mermaid { background: white; padding: 20px; overflow-x: auto; }
        .table-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .table-card { background: #f8f9fa; padding: 10px; border-radius: 5px; border-left: 4px solid #3498db; }
        .table-card.dim { border-left-color: #27ae60; }
        .table-card.fact { border-left-color: #e74c3c; }
        .table-card h4 { margin: 0 0 5px 0; font-size: 14px; }
        .table-card p { margin: 0; font-size: 12px; color: #666; }
        .legend { display: flex; gap: 20px; margin-bottom: 20px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 20px; height: 20px; border-radius: 3px; }
        .legend-color.dim { background: #27ae60; }
        .legend-color.fact { background: #e74c3c; }
        .legend-color.qa { background: #9b59b6; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="INDEX.html">Index</a>
        <a href="DATA_DICTIONARY.html">Data Dictionary</a>
        <a href="STATS_REFERENCE_COMPLETE.html">Stats Reference</a>
        <a href="CODE_ARCHITECTURE.html">Architecture</a>
    </div>

    <div class="header">
        <h1>üóÑÔ∏è BenchSight Schema / ERD</h1>
        <p>96 Tables | 44 Dimensions | 51 Facts | 1 QA</p>
    </div>

    <div class="section">
        <h2>Legend</h2>
        <div class="legend">
            <div class="legend-item"><div class="legend-color dim"></div> Dimension Tables (44)</div>
            <div class="legend-item"><div class="legend-color fact"></div> Fact Tables (51)</div>
            <div class="legend-item"><div class="legend-color qa"></div> QA Tables (1)</div>
        </div>
    </div>

    <div class="section">
        <h2>Core Entity Relationships</h2>
        <div class="mermaid">
erDiagram
    dim_player ||--o{ fact_player_game_stats : "player_id"
    dim_player ||--o{ fact_events : "event_player_1"
    dim_player ||--o{ fact_shifts : "player_id"
    dim_player ||--o{ fact_gameroster : "player_id"
    
    dim_team ||--o{ fact_team_game_stats : "team_id"
    dim_team ||--o{ fact_player_game_stats : "team_id"
    dim_team ||--o{ dim_player : "primary_team_id"
    
    dim_schedule ||--o{ fact_events : "game_id"
    dim_schedule ||--o{ fact_shifts : "game_id"
    dim_schedule ||--o{ fact_player_game_stats : "game_id"
    dim_schedule ||--o{ fact_team_game_stats : "game_id"
    
    dim_event_type ||--o{ fact_events : "event_type_id"
    dim_event_detail ||--o{ fact_events : "event_detail_id"
    
    dim_period ||--o{ fact_events : "period_id"
    dim_period ||--o{ fact_shifts : "period_id"
    
    dim_zone ||--o{ fact_events : "zone_id"
    dim_strength ||--o{ fact_events : "strength_id"
    
    fact_player_game_stats ||--o{ fact_h2h : "player_id"
    fact_player_game_stats ||--o{ fact_wowy : "player_id"
    fact_player_game_stats ||--o{ fact_line_combos : "player_id"
        </div>
    </div>

    <div class="section">
        <h2>Star Schema Overview</h2>
        <div class="mermaid">
erDiagram
    fact_player_game_stats {
        string player_game_key PK
        int game_id FK
        int player_id FK
        int team_id FK
        int goals
        int assists
        int points
        int shots
        float shooting_pct
        int toi_seconds
        float cf_pct
        float xg_for
        string _317_more_columns
    }
    
    fact_events {
        string event_key PK
        int game_id FK
        int event_index
        int period_id FK
        int event_type_id FK
        int event_player_1 FK
        int event_player_2 FK
        string success
        float x_coord
        float y_coord
    }
    
    fact_shifts {
        string shift_key PK
        int game_id FK
        int player_id FK
        int period_id FK
        int shift_number
        float start_time
        float end_time
        float duration
    }
    
    dim_player {
        int player_id PK
        string player_name
        string position
        int jersey_number
        int primary_team_id FK
    }
    
    dim_team {
        int team_id PK
        string team_name
        string team_abbrev
    }
    
    dim_schedule {
        int game_id PK
        date game_date
        int home_team_id FK
        int away_team_id FK
        string venue
    }
        </div>
    </div>

    <div class="section">
        <h2>All Tables by Category</h2>
        
        <h3>Dimension Tables (44)</h3>
        <div class="table-grid">
            <div class="table-card dim"><h4>dim_player</h4><p>Player master data</p></div>
            <div class="table-card dim"><h4>dim_team</h4><p>Team definitions</p></div>
            <div class="table-card dim"><h4>dim_schedule</h4><p>Game schedule</p></div>
            <div class="table-card dim"><h4>dim_season</h4><p>Season definitions</p></div>
            <div class="table-card dim"><h4>dim_venue</h4><p>Venue/rink info</p></div>
            <div class="table-card dim"><h4>dim_period</h4><p>Period codes</p></div>
            <div class="table-card dim"><h4>dim_event_type</h4><p>Event type codes</p></div>
            <div class="table-card dim"><h4>dim_event_detail</h4><p>Event detail codes</p></div>
            <div class="table-card dim"><h4>dim_event_detail_2</h4><p>Secondary details</p></div>
            <div class="table-card dim"><h4>dim_shot_type</h4><p>Shot type codes</p></div>
            <div class="table-card dim"><h4>dim_pass_type</h4><p>Pass type codes</p></div>
            <div class="table-card dim"><h4>dim_zone</h4><p>Ice zones</p></div>
            <div class="table-card dim"><h4>dim_zone_entry_type</h4><p>Entry types</p></div>
            <div class="table-card dim"><h4>dim_zone_exit_type</h4><p>Exit types</p></div>
            <div class="table-card dim"><h4>dim_strength</h4><p>Game strength</p></div>
            <div class="table-card dim"><h4>dim_situation</h4><p>Game situation</p></div>
            <div class="table-card dim"><h4>dim_success</h4><p>Success codes</p></div>
            <div class="table-card dim"><h4>dim_position</h4><p>Player positions</p></div>
            <div class="table-card dim"><h4>dim_player_role</h4><p>Player roles</p></div>
            <div class="table-card dim"><h4>dim_stat</h4><p>Stat definitions</p></div>
            <div class="table-card dim"><h4>dim_stat_category</h4><p>Stat categories</p></div>
            <div class="table-card dim"><h4>dim_stat_type</h4><p>Stat types</p></div>
            <div class="table-card dim"><h4>dim_danger_zone</h4><p>Danger zones</p></div>
            <div class="table-card dim"><h4>dim_net_location</h4><p>Net locations</p></div>
            <div class="table-card dim"><h4>dim_shift_slot</h4><p>Shift slots</p></div>
            <div class="table-card dim"><h4>dim_shift_start_type</h4><p>Shift start types</p></div>
            <div class="table-card dim"><h4>dim_shift_stop_type</h4><p>Shift stop types</p></div>
            <div class="table-card dim"><h4>dim_stoppage_type</h4><p>Stoppage types</p></div>
            <div class="table-card dim"><h4>dim_giveaway_type</h4><p>Giveaway types</p></div>
            <div class="table-card dim"><h4>dim_takeaway_type</h4><p>Takeaway types</p></div>
            <div class="table-card dim"><h4>dim_turnover_type</h4><p>Turnover types</p></div>
            <div class="table-card dim"><h4>dim_turnover_quality</h4><p>Turnover quality</p></div>
            <div class="table-card dim"><h4>dim_micro_stat</h4><p>Micro stat codes</p></div>
            <div class="table-card dim"><h4>dim_play_detail</h4><p>Play details</p></div>
            <div class="table-card dim"><h4>dim_play_detail_2</h4><p>Secondary play details</p></div>
            <div class="table-card dim"><h4>dim_comparison_type</h4><p>Comparison types</p></div>
            <div class="table-card dim"><h4>dim_composite_rating</h4><p>Rating definitions</p></div>
            <div class="table-card dim"><h4>dim_league</h4><p>League info</p></div>
            <div class="table-card dim"><h4>dim_rink_coord</h4><p>Rink coordinates</p></div>
            <div class="table-card dim"><h4>dim_rinkboxcoord</h4><p>Box coordinates</p></div>
            <div class="table-card dim"><h4>dim_rinkcoordzones</h4><p>Coordinate zones</p></div>
            <div class="table-card dim"><h4>dim_terminology_mapping</h4><p>Term mappings</p></div>
            <div class="table-card dim"><h4>dim_playerurlref</h4><p>Player URL refs</p></div>
            <div class="table-card dim"><h4>dim_randomnames</h4><p>Random names</p></div>
        </div>

        <h3>Fact Tables (51)</h3>
        <div class="table-grid">
            <div class="table-card fact"><h4>fact_events</h4><p>All tracked events</p></div>
            <div class="table-card fact"><h4>fact_events_long</h4><p>Events (long format)</p></div>
            <div class="table-card fact"><h4>fact_events_player</h4><p>Player events</p></div>
            <div class="table-card fact"><h4>fact_events_tracking</h4><p>Event tracking</p></div>
            <div class="table-card fact"><h4>fact_shifts</h4><p>Player shifts</p></div>
            <div class="table-card fact"><h4>fact_shifts_long</h4><p>Shifts (long format)</p></div>
            <div class="table-card fact"><h4>fact_shifts_player</h4><p>Player shifts</p></div>
            <div class="table-card fact"><h4>fact_shifts_tracking</h4><p>Shift tracking</p></div>
            <div class="table-card fact"><h4>fact_shift_players</h4><p>Shift player combos</p></div>
            <div class="table-card fact"><h4>fact_shift_quality</h4><p>Shift quality</p></div>
            <div class="table-card fact"><h4>fact_shift_quality_logical</h4><p>Logical shift quality</p></div>
            <div class="table-card fact"><h4>fact_linked_events</h4><p>Linked events</p></div>
            <div class="table-card fact"><h4>fact_event_chains</h4><p>Event chains</p></div>
            <div class="table-card fact"><h4>fact_player_event_chains</h4><p>Player event chains</p></div>
            <div class="table-card fact"><h4>fact_player_game_stats</h4><p>317 player stats</p></div>
            <div class="table-card fact"><h4>fact_team_game_stats</h4><p>Team stats</p></div>
            <div class="table-card fact"><h4>fact_goalie_game_stats</h4><p>Goalie stats</p></div>
            <div class="table-card fact"><h4>fact_player_period_stats</h4><p>Period stats</p></div>
            <div class="table-card fact"><h4>fact_player_stats_long</h4><p>Stats (long format)</p></div>
            <div class="table-card fact"><h4>fact_player_micro_stats</h4><p>Micro stats</p></div>
            <div class="table-card fact"><h4>fact_player_boxscore_all</h4><p>Full boxscore</p></div>
            <div class="table-card fact"><h4>fact_player_game_position</h4><p>Position tracking</p></div>
            <div class="table-card fact"><h4>fact_gameroster</h4><p>Game rosters</p></div>
            <div class="table-card fact"><h4>fact_playergames</h4><p>Player games</p></div>
            <div class="table-card fact"><h4>fact_game_status</h4><p>Game status</p></div>
            <div class="table-card fact"><h4>fact_h2h</h4><p>Head-to-head</p></div>
            <div class="table-card fact"><h4>fact_wowy</h4><p>With/Without You</p></div>
            <div class="table-card fact"><h4>fact_head_to_head</h4><p>H2H summary</p></div>
            <div class="table-card fact"><h4>fact_line_combos</h4><p>Line combinations</p></div>
            <div class="table-card fact"><h4>fact_matchup_summary</h4><p>Matchup summary</p></div>
            <div class="table-card fact"><h4>fact_player_pair_stats</h4><p>Pair stats</p></div>
            <div class="table-card fact"><h4>fact_cycle_events</h4><p>Cycle events</p></div>
            <div class="table-card fact"><h4>fact_rush_events</h4><p>Rush events</p></div>
            <div class="table-card fact"><h4>fact_possession_time</h4><p>Possession time</p></div>
            <div class="table-card fact"><h4>fact_team_zone_time</h4><p>Zone time</p></div>
            <div class="table-card fact"><h4>fact_scoring_chances</h4><p>Scoring chances</p></div>
            <div class="table-card fact"><h4>fact_shot_danger</h4><p>Shot danger</p></div>
            <div class="table-card fact"><h4>fact_player_xy_long</h4><p>Player XY (long)</p></div>
            <div class="table-card fact"><h4>fact_player_xy_wide</h4><p>Player XY (wide)</p></div>
            <div class="table-card fact"><h4>fact_puck_xy_long</h4><p>Puck XY (long)</p></div>
            <div class="table-card fact"><h4>fact_puck_xy_wide</h4><p>Puck XY (wide)</p></div>
            <div class="table-card fact"><h4>fact_shot_xy</h4><p>Shot XY coords</p></div>
            <div class="table-card fact"><h4>fact_plays</h4><p>Play sequences</p></div>
            <div class="table-card fact"><h4>fact_sequences</h4><p>Event sequences</p></div>
            <div class="table-card fact"><h4>fact_video</h4><p>Video links</p></div>
            <div class="table-card fact"><h4>fact_draft</h4><p>Draft data</p></div>
            <div class="table-card fact"><h4>fact_registration</h4><p>Registrations</p></div>
            <div class="table-card fact"><h4>fact_leadership</h4><p>Team leadership</p></div>
            <div class="table-card fact"><h4>fact_league_leaders_snapshot</h4><p>League leaders</p></div>
            <div class="table-card fact"><h4>fact_team_standings_snapshot</h4><p>Standings</p></div>
            <div class="table-card fact"><h4>fact_suspicious_stats</h4><p>Suspicious stats</p></div>
        </div>

        <h3>QA Tables (1)</h3>
        <div class="table-grid">
            <div class="table-card" style="border-left-color: #9b59b6;"><h4>qa_suspicious_stats</h4><p>QA anomaly tracking</p></div>
        </div>
    </div>

    <div class="section">
        <h2>Key Foreign Key Relationships</h2>
        <pre>
-- Player relationships
fact_player_game_stats.player_id ‚Üí dim_player.player_id
fact_events.event_player_1 ‚Üí dim_player.player_id
fact_shifts.player_id ‚Üí dim_player.player_id

-- Team relationships
fact_team_game_stats.team_id ‚Üí dim_team.team_id
fact_player_game_stats.team_id ‚Üí dim_team.team_id
dim_player.primary_team_id ‚Üí dim_team.team_id

-- Game relationships
fact_events.game_id ‚Üí dim_schedule.game_id
fact_shifts.game_id ‚Üí dim_schedule.game_id
fact_player_game_stats.game_id ‚Üí dim_schedule.game_id

-- Event type relationships
fact_events.event_type_id ‚Üí dim_event_type.event_type_id
fact_events.event_detail_id ‚Üí dim_event_detail.event_detail_id

-- Period/Zone relationships
fact_events.period_id ‚Üí dim_period.period_id
fact_events.zone_id ‚Üí dim_zone.zone_id
        </pre>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>
