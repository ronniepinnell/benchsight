<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTAL_DEV_HANDOFF - BenchSight</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; line-height: 1.6; color: #333; }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; }
        pre code { background: none; color: inherit; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        a { color: #3498db; }
        .nav { background: #2c3e50; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        .nav a { color: white; margin-right: 15px; text-decoration: none; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="INDEX.html">Index</a>
        <a href="DEPLOYMENT_GUIDE.html">Deploy</a>
        <a href="STATS_REFERENCE_COMPLETE.html">Stats</a>
    </div>
<h1>Portal/Admin Developer Handoff</h1>

<strong>Role:</strong> Admin Portal Developer  
<strong>Version:</strong> 2.0  
<strong>Date:</strong> December 30, 2025

<p>---</p>

<h2>Your Mission</h2>

<p>Build a web-based admin portal that provides:</p>
<p>1. Complete database management and monitoring</p>
<p>2. ETL execution and monitoring</p>
<p>3. Data quality validation and reporting</p>
<p>4. Log viewing and error tracking</p>
<p>5. Dimension table management (CRUD)</p>
<p>6. Game data upload and processing</p>
<p>7. System health dashboards</p>

<p>---</p>

<h2>Quick Start</h2>

<h3>1. Get the Codebase</h3>
<pre><code>unzip benchsight_COMPLETE_FULL.zip
<p>cd benchsight_COMPLETE_FULL</p>
</code></pre>

<h3>2. Understand the Architecture</h3>
<pre><code>Portal â†â†’ Supabase API â†â†’ PostgreSQL Database
<p>                â†“</p>
<p>         Python Scripts (ETL, Loaders)</p>
<p>                â†“</p>
<p>         CSV Files (data/output/)</p>
<p>                â†“</p>
<p>         Raw Excel Files (data/raw/)</p>
</code></pre>

<h3>3. Key Components You&#x27;ll Manage</h3>

<p>| Component | Location | Purpose |</p>
<p>|-----------|----------|---------|</p>
<p>| Database | Supabase | 96 tables + logs |</p>
<p>| ETL | <code>etl.py</code> | Process raw â†’ CSV |</p>
<p>| Loader | <code>scripts/load_all_tables.py</code> | CSV â†’ Supabase |</p>
<p>| Logs | <code>logs/</code> + <code>log_*</code> tables | Audit trail |</p>
<p>| Config | <code>config/config_local.ini</code> | Credentials |</p>
<p>| Tests | <code>tests/</code> | 326 validation tests |</p>

<p>---</p>

<h2>Portal Features Specification</h2>

<h3>1. DATABASE HEALTH DASHBOARD</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  DATABASE HEALTH                           Last Check: 2 min agoâ”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚</p>
<p>â”‚  â”‚   TABLES    â”‚  â”‚    ROWS     â”‚  â”‚    SIZE     â”‚             â”‚</p>
<p>â”‚  â”‚     96      â”‚  â”‚   120,000   â”‚  â”‚    45 MB    â”‚             â”‚</p>
<p>â”‚  â”‚   âœ… OK     â”‚  â”‚   âœ… OK     â”‚  â”‚   âœ… OK     â”‚             â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  RECENT ACTIVITY                                                â”‚</p>
<p>â”‚  â”œâ”€ 10:30 AM - ETL completed (4 games)                         â”‚</p>
<p>â”‚  â”œâ”€ 10:15 AM - Data load successful (24,639 rows)              â”‚</p>
<p>â”‚  â””â”€ 09:00 AM - Scheduled validation passed                     â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  ALERTS                                                         â”‚</p>
<p>â”‚  âš ï¸ 1 duplicate key found in fact_events (non-critical)        â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Implementation:</p>

<pre><code>// Get table counts
<p>async function getTableStats() {</p>
<p>  const { data } = await supabase.rpc(&#x27;get_all_table_counts&#x27;);</p>
<p>  return data;</p>
<p>}</p>

<p>// Get recent ETL runs</p>
<p>async function getRecentRuns() {</p>
<p>  const { data } = await supabase</p>
<p>    .from(&#x27;log_etl_runs&#x27;)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .order(&#x27;started_at&#x27;, { ascending: false })</p>
<p>    .limit(10);</p>
<p>  return data;</p>
<p>}</p>

<p>// Get unresolved errors</p>
<p>async function getAlerts() {</p>
<p>  const { data } = await supabase</p>
<p>    .from(&#x27;v_unresolved_errors&#x27;)</p>
<p>    .select(&#x27;*&#x27;);</p>
<p>  return data;</p>
<p>}</p>
</code></pre>

<h3>2. TABLE BROWSER</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  TABLE BROWSER                                                  â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚  TABLES (96)           â”‚  dim_player (337 rows)                 â”‚</p>
<p>â”‚  â”œâ”€ Dimensions (44)    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚  â”‚  â”œâ”€ dim_player  337 â”‚  â”‚ player_id | player_name | position  â”‚</p>
<p>â”‚  â”‚  â”œâ”€ dim_team     26 â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚</p>
<p>â”‚  â”‚  â”œâ”€ dim_schedule 562â”‚  â”‚ P001      â”‚ John Smith  â”‚ C        â”‚</p>
<p>â”‚  â”‚  â””â”€ ...             â”‚  â”‚ P002      â”‚ Jane Doe    â”‚ LW       â”‚</p>
<p>â”‚  â”œâ”€ Facts (51)         â”‚  â”‚ ...       â”‚ ...         â”‚ ...      â”‚</p>
<p>â”‚  â”‚  â”œâ”€ fact_events 5833â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚  â”‚  â”œâ”€ fact_shifts 672 â”‚                                        â”‚</p>
<p>â”‚  â”‚  â””â”€ ...             â”‚  [Export CSV] [Edit] [Delete Selected] â”‚</p>
<p>â”‚  â””â”€ Logs (5)           â”‚                                        â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Implementation:</p>

<pre><code>// Browse any table
<p>async function browseTable(tableName, page = 1, pageSize = 50) {</p>
<p>  const from = (page - 1) * pageSize;</p>
<p>  const to = from + pageSize - 1;</p>
  
<p>  const { data, count } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .select(&#x27;*&#x27;, { count: &#x27;exact&#x27; })</p>
<p>    .range(from, to);</p>
    
<p>  return { data, count, page, pageSize };</p>
<p>}</p>

<p>// Export to CSV</p>
<p>async function exportTable(tableName) {</p>
<p>  const { data } = await supabase.from(tableName).select(&#x27;*&#x27;);</p>
<p>  return convertToCSV(data);</p>
<p>}</p>
</code></pre>

<h3>3. DIMENSION TABLE EDITOR</h3>

<p>Allow CRUD operations on dimension tables:</p>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  EDIT: dim_event_type                                          â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  event_type_id: [EVT015    ]  (auto-generated)                 â”‚</p>
<p>â”‚  event_type:    [Deflection ]                                  â”‚</p>
<p>â”‚  description:   [Puck redirected by player&#x27;s stick or body   ] â”‚</p>
<p>â”‚  parent_type:   [Shot â–¼]                                       â”‚</p>
<p>â”‚  active:        [âœ“]                                            â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  [Cancel] [Save]                                                â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Implementation:</p>

<pre><code>// Add new dimension record
<p>async function addDimRecord(tableName, record) {</p>
<p>  const { data, error } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .insert([record])</p>
<p>    .select();</p>
    
<p>  if (error) throw error;</p>
  
<p>  // Log the change</p>
<p>  await logChange(&#x27;INSERT&#x27;, tableName, null, record);</p>
  
<p>  return data;</p>
<p>}</p>

<p>// Update dimension record</p>
<p>async function updateDimRecord(tableName, id, updates) {</p>
<p>  const primaryKey = getPrimaryKey(tableName);</p>
  
<p>  // Get old values for audit</p>
<p>  const { data: oldRecord } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .eq(primaryKey, id)</p>
<p>    .single();</p>
  
<p>  const { data, error } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .update(updates)</p>
<p>    .eq(primaryKey, id)</p>
<p>    .select();</p>
    
<p>  if (error) throw error;</p>
  
<p>  // Log the change</p>
<p>  await logChange(&#x27;UPDATE&#x27;, tableName, oldRecord, data[0]);</p>
  
<p>  return data;</p>
<p>}</p>

<p>// Delete dimension record</p>
<p>async function deleteDimRecord(tableName, id) {</p>
<p>  const primaryKey = getPrimaryKey(tableName);</p>
  
<p>  // Get old values for audit</p>
<p>  const { data: oldRecord } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .eq(primaryKey, id)</p>
<p>    .single();</p>
  
<p>  const { error } = await supabase</p>
<p>    .from(tableName)</p>
<p>    .delete()</p>
<p>    .eq(primaryKey, id);</p>
    
<p>  if (error) throw error;</p>
  
<p>  // Log the change</p>
<p>  await logChange(&#x27;DELETE&#x27;, tableName, oldRecord, null);</p>
<p>}</p>

<p>// Log all changes for audit</p>
<p>async function logChange(operation, tableName, oldValues, newValues) {</p>
<p>  await supabase.from(&#x27;log_data_changes&#x27;).insert([{</p>
<p>    table_name: tableName,</p>
<p>    operation: operation,</p>
<p>    old_values: oldValues,</p>
<p>    new_values: newValues,</p>
<p>    changed_by: getCurrentUser(),</p>
<p>    changed_at: new Date().toISOString()</p>
<p>  }]);</p>
<p>}</p>
</code></pre>

<h3>4. FILE UPLOAD &amp; ETL</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  UPLOAD &amp; PROCESS                                               â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  UPLOAD NEW DATA                                                â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚                                                           â”‚ â”‚</p>
<p>â”‚  â”‚     Drag &amp; drop files here or click to browse             â”‚ â”‚</p>
<p>â”‚  â”‚                                                           â”‚ â”‚</p>
<p>â”‚  â”‚     Supported: .xlsx, .csv                                â”‚ â”‚</p>
<p>â”‚  â”‚                                                           â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  PENDING FILES                                                  â”‚</p>
<p>â”‚  â”œâ”€ game_19001_tracking.xlsx (2.3 MB) [Process] [Remove]       â”‚</p>
<p>â”‚  â””â”€ BLB_Tables_updated.xlsx (500 KB) [Process] [Remove]        â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  OPTIONS                                                        â”‚</p>
<p>â”‚  â˜ Run validation after processing                             â”‚</p>
<p>â”‚  â˜ Auto-load to Supabase on success                            â”‚</p>
<p>â”‚  â˜‘ Send notification on completion                             â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  [Process All]                                                  â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Backend API Endpoints Needed:</p>

<pre><code><h1>Flask/FastAPI backend endpoints</h1>

<p>@app.post(&quot;/api/upload&quot;)</p>
<p>async def upload_file(file: UploadFile):</p>
<p>    &quot;&quot;&quot;Upload file to processing queue&quot;&quot;&quot;</p>
<p>    # Save to data/raw/pending/</p>
<p>    filepath = save_uploaded_file(file)</p>
<p>    return {&quot;status&quot;: &quot;uploaded&quot;, &quot;path&quot;: filepath}</p>

<p>@app.post(&quot;/api/etl/run&quot;)</p>
<p>async def run_etl(game_ids: List[str] = None):</p>
<p>    &quot;&quot;&quot;Run ETL pipeline&quot;&quot;&quot;</p>
<p>    # Call etl.py</p>
<p>    result = subprocess.run(</p>
<p>        [&quot;python&quot;, &quot;etl.py&quot;] + ([&quot;--games&quot;, &quot;,&quot;.join(game_ids)] if game_ids else []),</p>
<p>        capture_output=True</p>
<p>    )</p>
<p>    return {&quot;status&quot;: &quot;completed&quot;, &quot;output&quot;: result.stdout}</p>

<p>@app.post(&quot;/api/loader/run&quot;)</p>
<p>async def run_loader(tables: List[str] = None, operation: str = &quot;upsert&quot;):</p>
<p>    &quot;&quot;&quot;Run data loader&quot;&quot;&quot;</p>
<p>    cmd = [&quot;python&quot;, &quot;scripts/load_all_tables.py&quot;, f&quot;--{operation}&quot;]</p>
<p>    if tables:</p>
<p>        for table in tables:</p>
<p>            subprocess.run(cmd + [&quot;--table&quot;, table])</p>
<p>    else:</p>
<p>        subprocess.run(cmd)</p>
<p>    return {&quot;status&quot;: &quot;completed&quot;}</p>

<p>@app.get(&quot;/api/etl/status&quot;)</p>
<p>async def get_etl_status():</p>
<p>    &quot;&quot;&quot;Get current ETL status&quot;&quot;&quot;</p>
<p>    # Check for running processes</p>
<p>    # Return progress if running</p>
<p>    pass</p>
</code></pre>

<h3>5. LOG VIEWER</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  LOG VIEWER                                                     â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚  Filter: [All â–¼] [Last 24h â–¼] [Search...          ] [Apply]    â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  ğŸ“‹ ETL RUNS                                                    â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚ Run ID          â”‚ Status  â”‚ Tables â”‚ Rows   â”‚ Duration   â”‚ â”‚</p>
<p>â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚</p>
<p>â”‚  â”‚ etl_20251229... â”‚ âœ… OK   â”‚ 96     â”‚ 24,639 â”‚ 31s        â”‚ â”‚</p>
<p>â”‚  â”‚ etl_20251228... â”‚ âš ï¸ PART â”‚ 95     â”‚ 24,100 â”‚ 45s        â”‚ â”‚</p>
<p>â”‚  â”‚ etl_20251227... â”‚ âŒ FAIL â”‚ 12     â”‚ 0      â”‚ 5s         â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  ğŸ“‹ ERRORS                                                      â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚ âš ï¸ Duplicate key in fact_events (EV1896901594)           â”‚ â”‚</p>
<p>â”‚  â”‚    Occurred: 2025-12-29 19:04:55                          â”‚ â”‚</p>
<p>â”‚  â”‚    [View Details] [Mark Resolved]                         â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Implementation:</p>

<pre><code>// Get ETL runs
<p>async function getETLRuns(filters = {}) {</p>
<p>  let query = supabase</p>
<p>    .from(&#x27;log_etl_runs&#x27;)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .order(&#x27;started_at&#x27;, { ascending: false });</p>
    
<p>  if (filters.status) {</p>
<p>    query = query.eq(&#x27;status&#x27;, filters.status);</p>
<p>  }</p>
<p>  if (filters.after) {</p>
<p>    query = query.gte(&#x27;started_at&#x27;, filters.after);</p>
<p>  }</p>
  
<p>  return query;</p>
<p>}</p>

<p>// Get table load details for a run</p>
<p>async function getRunDetails(runId) {</p>
<p>  const { data } = await supabase</p>
<p>    .from(&#x27;log_etl_tables&#x27;)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .eq(&#x27;run_id&#x27;, runId);</p>
<p>  return data;</p>
<p>}</p>

<p>// Get errors</p>
<p>async function getErrors(resolved = false) {</p>
<p>  const { data } = await supabase</p>
<p>    .from(&#x27;log_errors&#x27;)</p>
<p>    .select(&#x27;*&#x27;)</p>
<p>    .eq(&#x27;resolved&#x27;, resolved)</p>
<p>    .order(&#x27;created_at&#x27;, { ascending: false });</p>
<p>  return data;</p>
<p>}</p>

<p>// Resolve error</p>
<p>async function resolveError(errorId, notes) {</p>
<p>  await supabase.rpc(&#x27;resolve_error&#x27;, {</p>
<p>    error_id: errorId,</p>
<p>    resolved_by: getCurrentUser(),</p>
<p>    resolution_notes: notes</p>
<p>  });</p>
<p>}</p>
</code></pre>

<h3>6. TEST RESULTS VIEWER</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  TEST RESULTS                          Last Run: 10 min ago     â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  SUMMARY                                                        â”‚</p>
<p>â”‚  â”œâ”€ Total Tests: 326                                           â”‚</p>
<p>â”‚  â”œâ”€ Passed: 326 âœ…                                             â”‚</p>
<p>â”‚  â”œâ”€ Failed: 0                                                  â”‚</p>
<p>â”‚  â””â”€ Pass Rate: 100%                                            â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  BY CATEGORY                                                    â”‚</p>
<p>â”‚  â”œâ”€ Referential Integrity: 45/45 âœ…                            â”‚</p>
<p>â”‚  â”œâ”€ Business Logic: 89/89 âœ…                                   â”‚</p>
<p>â”‚  â”œâ”€ Data Quality: 112/112 âœ…                                   â”‚</p>
<p>â”‚  â””â”€ Deployment: 80/80 âœ…                                       â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  [Run Tests Now] [View Full Report] [Export]                   â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Backend:</p>

<pre><code>@app.post(&quot;/api/tests/run&quot;)
<p>async def run_tests():</p>
<p>    &quot;&quot;&quot;Run pytest suite&quot;&quot;&quot;</p>
<p>    result = subprocess.run(</p>
<p>        [&quot;python&quot;, &quot;-m&quot;, &quot;pytest&quot;, &quot;tests/&quot;, &quot;-v&quot;, &quot;--json-report&quot;],</p>
<p>        capture_output=True</p>
<p>    )</p>
<p>    # Parse and store results</p>
<p>    return parse_test_results(result)</p>

<p>@app.get(&quot;/api/tests/results&quot;)</p>
<p>async def get_test_results():</p>
<p>    &quot;&quot;&quot;Get latest test results&quot;&quot;&quot;</p>
<p>    return supabase.from(&#x27;log_test_results&#x27;).select(&#x27;*&#x27;).order(&#x27;run_at&#x27;, descending=True).limit(1)</p>
</code></pre>

<h3>7. DATA VALIDATION PANEL</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  DATA VALIDATION                                                â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  INTEGRITY CHECKS                                               â”‚</p>
<p>â”‚  â”œâ”€ Referential Integrity: âœ… All FKs valid                    â”‚</p>
<p>â”‚  â”œâ”€ Primary Key Uniqueness: âš ï¸ 1 duplicate found               â”‚</p>
<p>â”‚  â”œâ”€ Null Constraints: âœ… No unexpected nulls                   â”‚</p>
<p>â”‚  â””â”€ Data Types: âœ… All valid                                   â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  BUSINESS RULES                                                 â”‚</p>
<p>â”‚  â”œâ”€ Goals Match Official: âœ… 4/4 games match                   â”‚</p>
<p>â”‚  â”œâ”€ Events in Shifts: âš ï¸ 58 events without shift              â”‚</p>
<p>â”‚  â”œâ”€ Linked Events Valid: âœ… All links valid                    â”‚</p>
<p>â”‚  â””â”€ Player Stats Sum: âœ… Totals match                          â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  DETAILS                                                        â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚ Issue: 58 events have shift_key containing &#x27;nan&#x27;          â”‚ â”‚</p>
<p>â”‚  â”‚ Impact: Minor - events still usable                        â”‚ â”‚</p>
<p>â”‚  â”‚ Games: 18969, 18977, 18981, 18987                         â”‚ â”‚</p>
<p>â”‚  â”‚ [View Events] [Auto-fix] [Ignore]                         â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  [Run Full Validation] [Export Report]                         â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<h3>8. UPLOAD NEW TABLES (SCHEMA EXTENSION)</h3>

<p>Allow users to upload entirely new dimension or fact tables:</p>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  CREATE NEW TABLE                                               â”‚</p>
<p>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  TABLE TYPE: [Dimension â–¼]                                     â”‚</p>
<p>â”‚  TABLE NAME: dim_[                    ]                        â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  UPLOAD CSV TO DEFINE SCHEMA                                    â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚     Drop CSV here to auto-detect columns                  â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  DETECTED COLUMNS                                               â”‚</p>
<p>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</p>
<p>â”‚  â”‚ Column       â”‚ Type     â”‚ Primary Key â”‚ Nullable          â”‚ â”‚</p>
<p>â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚</p>
<p>â”‚  â”‚ shot_zone_id â”‚ TEXT     â”‚ â˜‘           â”‚ â˜                 â”‚ â”‚</p>
<p>â”‚  â”‚ zone_name    â”‚ TEXT     â”‚ â˜           â”‚ â˜                 â”‚ â”‚</p>
<p>â”‚  â”‚ x_min        â”‚ DECIMAL  â”‚ â˜           â”‚ â˜‘                 â”‚ â”‚</p>
<p>â”‚  â”‚ x_max        â”‚ DECIMAL  â”‚ â˜           â”‚ â˜‘                 â”‚ â”‚</p>
<p>â”‚  â”‚ danger_level â”‚ INTEGER  â”‚ â˜           â”‚ â˜                 â”‚ â”‚</p>
<p>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â”‚  [Preview SQL] [Create Table] [Create &amp; Load Data]             â”‚</p>
<p>â”‚                                                                 â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>#### Implementation:</p>

<pre><code>// Generate CREATE TABLE SQL from CSV
<p>function generateCreateTableSQL(tableName, columns) {</p>
<p>  const colDefs = columns.map(col =&gt; {</p>
<p>    let def = <code>    &quot;${col.name}&quot; ${col.type}</code>;</p>
<p>    if (col.primaryKey) def += &#x27; PRIMARY KEY&#x27;;</p>
<p>    if (!col.nullable) def += &#x27; NOT NULL&#x27;;</p>
<p>    return def;</p>
<p>  });</p>
  
<p>  return <code>CREATE TABLE ${tableName} (\n${colDefs.join(&#x27;,\n&#x27;)}\n);</code>;</p>
<p>}</p>

<p>// Execute via Supabase</p>
<p>async function createTable(sql) {</p>
<p>  // Need to use Supabase Management API or direct SQL</p>
<p>  // This requires service role key</p>
<p>  const { error } = await supabase.rpc(&#x27;exec_sql&#x27;, { sql });</p>
<p>  return !error;</p>
<p>}</p>
</code></pre>

<p>---</p>

<h2>Python Scripts Reference</h2>

<h3>Data Loader Commands</h3>

<pre><code><h1>Load ALL tables (96 tables)</h1>
<p>python scripts/load_all_tables.py</p>

<h1>Load with upsert (handles duplicates)</h1>
<p>python scripts/load_all_tables.py --upsert</p>

<h1>Dry run (preview only)</h1>
<p>python scripts/load_all_tables.py --dry-run</p>

<h1>Load single table</h1>
<p>python scripts/load_all_tables.py --table dim_player --upsert</p>

<h1>Skip dimension tables</h1>
<p>python scripts/load_all_tables.py --skip-dims --upsert</p>
</code></pre>

<h3>Flexible Loader (with logging)</h3>

<pre><code><h1>Show config</h1>
<p>python scripts/flexible_loader_with_logging.py --show-config</p>

<h1>Test connection</h1>
<p>python scripts/flexible_loader_with_logging.py --test-connection</p>

<h1>Full load with replace</h1>
<p>python scripts/flexible_loader_with_logging.py --scope full --operation replace</p>

<h1>Single table upsert</h1>
<p>python scripts/flexible_loader_with_logging.py --scope table --table fact_events --operation upsert</p>

<h1>With Supabase logging</h1>
<p>python scripts/flexible_loader_with_logging.py --scope full --operation replace --log-to-supabase</p>

<h1>View last run</h1>
<p>python scripts/flexible_loader_with_logging.py --show-last-run</p>
</code></pre>

<h3>ETL Commands</h3>

<pre><code><h1>Run full ETL</h1>
<p>python etl.py</p>

<h1>ETL specific games</h1>
<p>python etl.py --games 18969,18977</p>

<h1>ETL with validation</h1>
<p>python etl.py --validate</p>

<h1>ETL dry run</h1>
<p>python etl.py --dry-run</p>
</code></pre>

<h3>Test Commands</h3>

<pre><code><h1>Run all tests</h1>
<p>python -m pytest tests/ -v</p>

<h1>Run specific test file</h1>
<p>python -m pytest tests/test_deployment_readiness.py -v</p>

<h1>Run with coverage</h1>
<p>python -m pytest tests/ --cov=src</p>

<h1>Generate HTML report</h1>
<p>python -m pytest tests/ --html=reports/test_report.html</p>
</code></pre>

<p>---</p>

<h2>Database Management SQL</h2>

<h3>Clear All Data (Keep Schema)</h3>

<pre><code>-- Run sql/06_TRUNCATE_ALL_DATA.sql
<p>-- Or individually:</p>
<p>TRUNCATE TABLE fact_events CASCADE;</p>
<p>TRUNCATE TABLE fact_shifts CASCADE;</p>
<p>-- etc.</p>
</code></pre>

<h3>Recreate Schema</h3>

<pre><code>-- Run sql/05_FINAL_COMPLETE_SCHEMA.sql
<p>-- This drops and recreates all 96 tables</p>
</code></pre>

<h3>Useful Admin Queries</h3>

<pre><code>-- Table row counts
<p>SELECT * FROM get_all_table_counts();</p>

<p>-- Recent ETL runs</p>
<p>SELECT * FROM v_recent_runs;</p>

<p>-- Daily statistics</p>
<p>SELECT * FROM v_daily_run_stats;</p>

<p>-- Table load performance</p>
<p>SELECT * FROM v_table_load_stats;</p>

<p>-- Unresolved errors</p>
<p>SELECT * FROM v_unresolved_errors;</p>

<p>-- Run summary</p>
<p>SELECT get_run_summary(&#x27;etl_run_20251229_123456_abc12345&#x27;);</p>

<p>-- Clean old logs (keep 30 days)</p>
<p>SELECT * FROM cleanup_old_logs(30);</p>

<p>-- Database size</p>
<p>SELECT </p>
<p>  schemaname,</p>
<p>  tablename,</p>
<p>  pg_size_pretty(pg_total_relation_size(schemaname || &#x27;.&#x27; || tablename)) as size</p>
<p>FROM pg_tables</p>
<p>WHERE schemaname = &#x27;public&#x27;</p>
<p>ORDER BY pg_total_relation_size(schemaname || &#x27;.&#x27; || tablename) DESC;</p>
</code></pre>

<p>---</p>

<h2>Logging Tables Schema</h2>

<h3>log_etl_runs</h3>
<p>| Column | Type | Description |</p>
<p>|--------|------|-------------|</p>
<p>| run_id | TEXT PK | Unique run identifier |</p>
<p>| started_at | TIMESTAMPTZ | Start time |</p>
<p>| completed_at | TIMESTAMPTZ | End time |</p>
<p>| status | TEXT | success/partial/failed |</p>
<p>| total_tables | INTEGER | Tables processed |</p>
<p>| successful_tables | INTEGER | Tables succeeded |</p>
<p>| failed_tables | INTEGER | Tables failed |</p>
<p>| total_rows | INTEGER | Rows loaded |</p>
<p>| duration_seconds | DECIMAL | Total duration |</p>
<p>| environment | TEXT | dev/prod |</p>
<p>| triggered_by | TEXT | manual/scheduled/api |</p>

<h3>log_etl_tables</h3>
<p>| Column | Type | Description |</p>
<p>|--------|------|-------------|</p>
<p>| id | SERIAL PK | Auto ID |</p>
<p>| run_id | TEXT FK | Links to run |</p>
<p>| table_name | TEXT | Table loaded |</p>
<p>| status | TEXT | success/failed |</p>
<p>| rows_before | INTEGER | Count before |</p>
<p>| rows_after | INTEGER | Count after |</p>
<p>| rows_inserted | INTEGER | New rows |</p>
<p>| rows_updated | INTEGER | Updated rows |</p>
<p>| rows_deleted | INTEGER | Deleted rows |</p>
<p>| duration_seconds | DECIMAL | Table duration |</p>
<p>| error_message | TEXT | Error if failed |</p>

<h3>log_errors</h3>
<p>| Column | Type | Description |</p>
<p>|--------|------|-------------|</p>
<p>| id | SERIAL PK | Auto ID |</p>
<p>| run_id | TEXT | Related run |</p>
<p>| table_name | TEXT | Related table |</p>
<p>| error_type | TEXT | Type of error |</p>
<p>| error_message | TEXT | Message |</p>
<p>| error_details | JSONB | Full context |</p>
<p>| stack_trace | TEXT | Python traceback |</p>
<p>| resolved | BOOLEAN | Is resolved |</p>
<p>| resolved_by | TEXT | Who resolved |</p>
<p>| resolved_at | TIMESTAMPTZ | When resolved |</p>
<p>| resolution_notes | TEXT | How fixed |</p>

<p>---</p>

<h2>Security Considerations</h2>

<h3>API Keys</h3>

<pre><code>ANON_KEY: For read-only public access (dashboards)
<p>SERVICE_ROLE_KEY: For admin operations (portal backend)</p>
</code></pre>

<strong>NEVER expose SERVICE_ROLE_KEY to frontend!</strong>

<h3>Portal Authentication</h3>

<p>Implement proper auth:</p>
<pre><code>// Use Supabase Auth
<p>const { data: { user } } = await supabase.auth.getUser();</p>

<p>// Check admin role</p>
<p>if (!user || !user.app_metadata?.role === &#x27;admin&#x27;) {</p>
<p>  throw new Error(&#x27;Unauthorized&#x27;);</p>
<p>}</p>
</code></pre>

<h3>Audit Trail</h3>

<p>Log all admin actions:</p>
<pre><code>async function logAdminAction(action, details) {
<p>  await supabase.from(&#x27;log_admin_actions&#x27;).insert([{</p>
<p>    user_id: getCurrentUser(),</p>
<p>    action: action,</p>
<p>    details: details,</p>
<p>    timestamp: new Date().toISOString(),</p>
<p>    ip_address: getClientIP()</p>
<p>  }]);</p>
<p>}</p>
</code></pre>

<p>---</p>

<h2>Deployment Architecture</h2>

<h3>Recommended Stack</h3>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<p>â”‚  FRONTEND (React/Next.js)                                       â”‚</p>
<p>â”‚  - Admin Dashboard UI                                           â”‚</p>
<p>â”‚  - Table browser                                                â”‚</p>
<p>â”‚  - Log viewer                                                   â”‚</p>
<p>â”‚  - File upload                                                  â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>                             â”‚</p>
<p>                             â–¼</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚  BACKEND API (FastAPI/Flask)                                    â”‚</p>
<p>â”‚  - ETL orchestration                                            â”‚</p>
<p>â”‚  - File processing                                              â”‚</p>
<p>â”‚  - Script execution                                             â”‚</p>
<p>â”‚  - Admin operations                                             â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>                             â”‚</p>
<p>                             â–¼</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚  SUPABASE                                                       â”‚</p>
<p>â”‚  - PostgreSQL Database                                          â”‚</p>
<p>â”‚  - Auth                                                         â”‚</p>
<p>â”‚  - Storage (for file uploads)                                   â”‚</p>
<p>â”‚  - Realtime subscriptions                                       â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
</code></pre>

<p>---</p>

<h2>Future Considerations</h2>

<h3>ML/CV Integration</h3>
<p>- Add tables for tracking data (player positions, puck tracking)</p>
<p>- Create pipelines for model predictions (xG, xA)</p>
<p>- Store model outputs alongside traditional stats</p>

<h3>NHL Data Integration</h3>
<p>- Add NHL API connector</p>
<p>- Map NHL player IDs to internal IDs</p>
<p>- Import historical NHL data for comparison</p>

<h3>Scaling</h3>
<p>- Consider read replicas for dashboards</p>
<p>- Implement caching layer (Redis)</p>
<p>- Use background job queue (Celery) for ETL</p>

<p>---</p>

<h2>Resources</h2>

<p>- Schema: <code>sql/05_FINAL_COMPLETE_SCHEMA.sql</code></p>
<p>- Logging Tables: <code>sql/02_CREATE_LOGGING_TABLES.sql</code></p>
<p>- Loader Script: <code>scripts/load_all_tables.py</code></p>
<p>- Config: <code>config/config_loader.py</code></p>
<p>- Tests: <code>tests/</code> directory</p>

<p>---</p>

<h2>Questions?</h2>

<p>See <code>prompts/portal_dev_prompt.md</code> for a prompt to start a new Claude chat with full context.</p>

</body></html>
