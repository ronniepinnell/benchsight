<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUPABASE_DEPLOYMENT - BenchSight</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Monaco', 'Menlo', monospace; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; }
        pre code { background: none; color: inherit; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        a { color: #3498db; }
        blockquote { border-left: 4px solid #3498db; margin: 0; padding-left: 20px; color: #666; }
        .nav { background: #2c3e50; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        .nav a { color: white; margin-right: 15px; text-decoration: none; }
        .nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="INDEX.html">Index</a>
        <a href="DEPLOYMENT_GUIDE.html">Deploy</a>
        <a href="STATS_REFERENCE_COMPLETE.html">Stats</a>
        <a href="DATA_DICTIONARY.html">Data Dict</a>
    </div>
<h1>ðŸš€ BenchSight Supabase Deployment Guide</h1>

<h2>Complete Instructions for Database Deployment</h2>

<p>---</p>

<h2>Prerequisites</h2>

<p>1. <strong>Python packages:</strong></p>
   <pre><code>   pip install supabase pandas
   </code></pre>

<p>2. <strong>Supabase project:</strong></p>
<p>   - Go to https://supabase.com</p>
<p>   - Create a new project</p>
<p>   - Note your Project URL and anon key (Settings &gt; API)</p>

<p>3. <strong>Local data:</strong></p>
<p>   - Run full ETL first: <code>python etl.py &amp;&amp; python src/etl_orchestrator.py --all</code></p>
<p>   - Verify CSVs exist in <code>data/output/</code></p>

<p>---</p>

<h2>Step 1: Configure Credentials</h2>

<h3>Option A: Environment Variables</h3>
<pre><code>export SUPABASE_URL=&quot;https://your-project.supabase.co&quot;
<p>export SUPABASE_KEY=&quot;your-anon-key&quot;</p>
</code></pre>

<h3>Option B: Config File</h3>
<p>Edit <code>config/config_local.ini</code>:</p>
<pre><code>[supabase]
<p>url = https://your-project.supabase.co</p>
<p>key = your-anon-key</p>
</code></pre>

<p>---</p>

<h2>Step 2: Test Connection</h2>

<pre><code>python scripts/supabase_test_connection.py
</code></pre>

<p>Expected output:</p>
<pre><code>âœ“ supabase package installed
<p>âœ“ Credentials loaded</p>
<p>âœ“ Client created successfully</p>
<p>âœ“ Connection is working!</p>
</code></pre>

<p>---</p>

<h2>Step 3: Choose Your Deployment Method</h2>

<h3>Method A: Full Rebuild (Recommended for First Time)</h3>
<p>Drops all tables, recreates schema, uploads all data:</p>
<pre><code>python scripts/supabase_loader.py --rebuild
</code></pre>

<h3>Method B: Create Tables Only</h3>
<p>Create schema without uploading data:</p>
<pre><code>python scripts/supabase_loader.py --create-only
</code></pre>

<h3>Method C: Upload All Data</h3>
<p>Upload all tables (tables must exist):</p>
<pre><code>python scripts/supabase_loader.py --all
</code></pre>

<h3>Method D: Upload Specific Tables</h3>
<pre><code><h1>Only dimension tables</h1>
<p>python scripts/supabase_loader.py --dims</p>

<h1>Only fact tables</h1>
<p>python scripts/supabase_loader.py --facts</p>

<h1>Specific tables</h1>
<p>python scripts/supabase_loader.py --tables dim_player,dim_team,fact_player_game_stats</p>
</code></pre>

<h3>Method E: Upload Specific Games</h3>
<pre><code><h1>Only data for specific games</h1>
<p>python scripts/supabase_loader.py --all --games 18969,18977</p>
</code></pre>

<p>---</p>

<h2>Step 4: Choose Upload Mode</h2>

<h3>Replace Mode (Default)</h3>
<p>Truncates existing data before inserting:</p>
<pre><code>python scripts/supabase_loader.py --all --mode replace
</code></pre>

<h3>Append Mode</h3>
<p>Adds to existing data (useful for incremental updates):</p>
<pre><code>python scripts/supabase_loader.py --all --mode append
</code></pre>

<p>---</p>

<h2>Step 5: Verify Deployment</h2>

<h3>Automatic Verification</h3>
<pre><code>python scripts/supabase_loader.py --verify
</code></pre>

<h3>Manual Verification in Supabase</h3>
<p>1. Go to Table Editor in Supabase dashboard</p>
<p>2. Check each table has correct row counts:</p>

<table>
<tr><th>Table</th><th>Expected Rows</th></tr>
<tr><td>dim_player</td><td>~298</td></tr>
<tr><td>dim_team</td><td>~15</td></tr>
<tr><th>dim_schedule</th><th>~562</th></tr>
<tr><th>fact_player_game_stats</th><th>~107</th></tr>
<tr><th>fact_events_player</th><th>~11,635</th></tr>
<tr><th>fact_shifts_player</th><th>~4,626</th></tr>
</table>

<p>---</p>

<h2>Teardown (Reset Everything)</h2>

<p>To completely remove all BenchSight tables:</p>

<h3>Option A: Using Loader</h3>
<pre><code>python scripts/supabase_loader.py --teardown
</code></pre>

<h3>Option B: Using SQL Editor</h3>
<p>1. Go to Supabase SQL Editor</p>
<p>2. Copy contents of <code>sql/00_drop_all_tables.sql</code></p>
<p>3. Execute</p>

<p>---</p>

<h2>Troubleshooting</h2>

<h3>&quot;Connection failed&quot;</h3>
<p>- Check URL and key are correct</p>
<p>- Check project is active (not paused)</p>
<p>- Check network connectivity</p>

<h3>&quot;Table does not exist&quot;</h3>
<p>- Run <code>--create-only</code> first</p>
<p>- Or use <code>--rebuild</code> for full setup</p>

<h3>&quot;Permission denied&quot;</h3>
<p>- Check you&#x27;re using correct key (anon vs service role)</p>
<p>- Check RLS policies aren&#x27;t blocking inserts</p>

<h3>&quot;Duplicate key&quot;</h3>
<p>- Use <code>--mode replace</code> to clear existing data first</p>
<p>- Or use <code>--teardown</code> then <code>--rebuild</code></p>

<h3>&quot;Rate limited&quot;</h3>
<p>- Wait a few minutes and retry</p>
<p>- Reduce batch size in <code>supabase_loader.py</code></p>

<p>---</p>

<h2>Common Workflows</h2>

<h3>First-Time Setup</h3>
<pre><code><h1>1. Test connection</h1>
<p>python scripts/supabase_test_connection.py</p>

<h1>2. Full rebuild</h1>
<p>python scripts/supabase_loader.py --rebuild</p>

<h1>3. Verify</h1>
<p>python scripts/supabase_loader.py --verify</p>
</code></pre>

<h3>Adding New Game Data</h3>
<pre><code><h1>1. Run ETL for new game</h1>
<p>python etl.py</p>

<h1>2. Upload new data (append mode)</h1>
<p>python scripts/supabase_loader.py --facts --mode append</p>
</code></pre>

<h3>Refreshing All Data</h3>
<pre><code><h1>Replace all fact tables, keep dims</h1>
<p>python scripts/supabase_loader.py --facts --mode replace</p>
</code></pre>

<h3>Complete Reset</h3>
<pre><code><h1>Drop everything and start fresh</h1>
<p>python scripts/supabase_loader.py --rebuild</p>
</code></pre>

<p>---</p>

<h2>Log Files</h2>

<p>All uploads are logged to <code>logs/supabase_upload_YYYYMMDD_HHMMSS.log</code></p>

<p>Log includes:</p>
<p>- Tables processed</p>
<p>- Row counts</p>
<p>- Errors</p>
<p>- Verification results</p>

<p>---</p>

<h2>Security Notes</h2>

<p>1. <strong>Never commit credentials</strong> - Use environment variables or .gitignore config_local.ini</p>
<p>2. <strong>Use anon key for uploads</strong> - Service role key has more permissions than needed</p>
<p>3. <strong>Enable RLS</strong> - Row Level Security for production use</p>
<p>4. <strong>Backup before teardown</strong> - Export data before dropping tables</p>

<p>---</p>

<h2>Quick Reference</h2>

<pre><code><h1>Test connection</h1>
<p>python scripts/supabase_test_connection.py</p>

<h1>Full rebuild (drop + create + upload)</h1>
<p>python scripts/supabase_loader.py --rebuild</p>

<h1>Upload all tables</h1>
<p>python scripts/supabase_loader.py --all</p>

<h1>Upload dims only</h1>
<p>python scripts/supabase_loader.py --dims</p>

<h1>Upload facts only</h1>
<p>python scripts/supabase_loader.py --facts</p>

<h1>Upload specific tables</h1>
<p>python scripts/supabase_loader.py --tables dim_player,dim_team</p>

<h1>Upload specific games</h1>
<p>python scripts/supabase_loader.py --all --games 18969,18977</p>

<h1>Append mode (don&#x27;t delete existing)</h1>
<p>python scripts/supabase_loader.py --all --mode append</p>

<h1>Replace mode (delete then insert)</h1>
<p>python scripts/supabase_loader.py --all --mode replace</p>

<h1>Verify upload</h1>
<p>python scripts/supabase_loader.py --verify</p>

<h1>Teardown (drop all)</h1>
<p>python scripts/supabase_loader.py --teardown</p>

<h1>Create tables only</h1>
<p>python scripts/supabase_loader.py --create-only</p>

<h1>Dry run (see what would happen)</h1>
<p>python scripts/supabase_loader.py --all --dry-run</p>
</code></pre>

</body></html>
