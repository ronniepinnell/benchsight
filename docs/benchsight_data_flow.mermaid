%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#1A365D', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2D3748', 'lineColor': '#4A5568', 'secondaryColor': '#E2E8F0', 'tertiaryColor': '#F7FAFC'}}}%%
flowchart TB
    subgraph Sources["ğŸ“ DATA SOURCES"]
        BLB["ğŸ“Š BLB_Tables.xlsx<br/>14 sheets<br/>335 players, 17 teams"]
        TRACK["ğŸ“‹ Game Tracking<br/>9 games tracked<br/>11K+ events"]
        NORAD["ğŸŒ NORAD Website<br/>Standings, schedules<br/>Official box scores"]
    end

    subgraph ETL["âš™ï¸ ETL PIPELINE (Python)"]
        EXT["extract.py<br/>Read Excel files"]
        TRN["transform.py<br/>Normalize & enrich"]
        LD["load.py<br/>Output JSON/CSV"]
        ORC["orchestrator.py<br/>Run full pipeline"]
    end

    subgraph Mart["ğŸ—„ï¸ DATAMART"]
        FEL["fact_events_long<br/>1 row per event"]
        FSL["fact_shifts_long<br/>1 row per player-shift"]
        FPB["fact_player_boxscore<br/>G, A, TOI, Corsi"]
        FVL["fact_video_links<br/>YouTube timestamps"]
        DIM["dim_player<br/>dim_team<br/>dim_game"]
    end

    subgraph Apps["ğŸ“± APPLICATIONS"]
        DASH["ğŸ–¥ï¸ Dashboard HTML<br/>Standings, Players<br/>Game Details"]
        TRCK["ğŸ“ Tracker HTML<br/>Log events/shifts<br/>Excel import/export"]
        PBI["ğŸ“ˆ Power BI<br/>Advanced visuals<br/>DAX measures"]
    end

    BLB --> EXT
    TRACK --> EXT
    NORAD --> EXT
    EXT --> TRN
    TRN --> LD
    LD --> ORC
    ORC --> Mart
    
    FEL --> DASH
    FSL --> DASH
    FPB --> DASH
    FVL --> DASH
    DIM --> DASH
    
    FEL --> TRCK
    FSL --> TRCK
    DIM --> TRCK
    
    Mart --> PBI

    classDef sourceStyle fill:#E2E8F0,stroke:#4A5568,stroke-width:2px
    classDef etlStyle fill:#FED7D7,stroke:#C53030,stroke-width:2px
    classDef martStyle fill:#C6F6D5,stroke:#276749,stroke-width:2px
    classDef appStyle fill:#BEE3F8,stroke:#2B6CB0,stroke-width:2px

    class BLB,TRACK,NORAD sourceStyle
    class EXT,TRN,LD,ORC etlStyle
    class FEL,FSL,FPB,FVL,DIM martStyle
    class DASH,TRCK,PBI appStyle
