<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRACKER DEV HANDOFF</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        a { color: #3498db; }
        hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
        .success { color: #27ae60; }
        .warning { color: #f39c12; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
<h1>Tracker Developer Handoff</h1>
<strong>Role:</strong> Game Tracker Developer  
<strong>Version:</strong> 2.0  
<strong>Date:</strong> December 30, 2025
<hr>
<h2>Your Mission</h2>
<p>Build an interactive web-based hockey game tracker that allows users to:
1. Load existing game data from Supabase
2. Track live game events and shifts in real-time
3. Write data back to Supabase (save drafts, publish final)
4. Validate data quality before publishing</p>
<hr>
<h2>Quick Start</h2>
<h3>1. Get the Codebase</h3>
<pre><code>unzip benchsight_COMPLETE_FULL.zip
cd benchsight_COMPLETE_FULL</code></pre>
<h3>2. Understand the Data Model</h3>
<ul>
<li>Events are individual plays (shots, passes, goals, etc.)</li>
<li>Shifts are time periods when specific players are on ice</li>
<li>Each event belongs to a shift</li>
<li>Events can be linked (shot → save → rebound)</li>
</ul>
<h3>3. Key Files to Review</h3>
<ul>
<li><code>developer_handoffs/tracker_dev/</code> - Existing tracker docs</li>
<li><code>dashboard/tracker_<em>.html</code> - Prototype tracker UIs</li>
<li><code>data/output/dim_</em>.csv</code> - All dimension tables (lookups)</li>
<li><code>data/output/fact_events.csv</code> - Event structure</li>
<li><code>data/output/fact_shifts.csv</code> - Shift structure</li>
</ul>
<hr>
<h2>Data Architecture</h2>
<h3>Core Tables You'll Write To</h3>
<td> Table </td> Purpose <td> Primary Key </td>
<td>-------</td>---------<td>-------------</td>
<td> <code>fact_events</code> </td> All game events <td> <code>event_key</code> </td>
<td> <code>fact_shifts</code> </td> All shifts <td> <code>shift_key</code> </td>
<td> <code>fact_events_player</code> </td> Event-player junction <td> <code>event_player_key</code> </td>
<td> <code>fact_shifts_player</code> </td> Shift-player junction <td> <code>shift_player_key</code> </td>
<td> <code>staging_events</code> </td> Draft events before publish <td> (use for saves) </td>
<td> <code>staging_shifts</code> </td> Draft shifts before publish <td> (use for saves) </td>
<h3>Key Generation Patterns</h3>
<pre><code>// Event Key: EV{game_id}{event_index padded to 5 digits}
const eventKey = <code>EV${gameId}${String(eventIndex).padStart(5, '0')}</code>;
// Example: EV1896900001, EV1896900002
<p>// Shift Key: {game_id}_{shift_index}
const shiftKey = <code>${gameId}_${shiftIndex}</code>;
// Example: 18969_1, 18969_2</p>
<p>// Event Player Key: {event_key}_{player_index}
const eventPlayerKey = <code>${eventKey}_${playerIndex}</code>;
// Example: EV1896900001_1, EV1896900001_2</p>
<p>// Shift Player Key: {shift_key}_{player_id}
const shiftPlayerKey = <code>${shiftKey}_${playerId}</code>;
// Example: 18969_1_P001</code></pre></p>
<hr>
<h2>Dimension Tables Reference</h2>
<h3>CRITICAL: Load These On Startup</h3>
<p>These tables provide dropdowns, validation, and ID lookups:</p>
<p>#### Event Types (<code>dim_event_type</code>)
<td> event_type_id </td> event_type <td>
</td>---------------<td>------------</td>
<td> EVT001 </td> Shot <td>
</td> EVT002 <td> Pass </td>
<td> EVT003 </td> Faceoff <td>
</td> EVT004 <td> Goal </td>
<td> EVT005 </td> Save <td>
</td> EVT006 <td> Hit </td>
<td> EVT007 </td> Block <td>
</td> EVT008 <td> Turnover </td>
<td> EVT009 </td> Takeaway <td>
</td> EVT010 <td> Zone Entry </td>
<td> EVT011 </td> Zone Exit <td>
</td> ... <td> ... </td></p>
<p>#### Event Details (<code>dim_event_detail</code>)
Provides detail options based on event type:
<td> event_detail_id </td> event_detail <td> parent_event_type </td>
<td>-----------------</td>--------------<td>-------------------</td>
<td> ED001 </td> Wrist Shot <td> Shot </td>
<td> ED002 </td> Slap Shot <td> Shot </td>
<td> ED003 </td> Snap Shot <td> Shot </td>
<td> ED004 </td> Backhand <td> Shot </td>
<td> ED005 </td> Tip-in <td> Shot </td>
<td> ED006 </td> Saucer Pass <td> Pass </td>
<td> ED007 </td> Tape to Tape <td> Pass </td>
<td> ... </td> ... <td> ... </td></p>
<p>#### Play Details (<code>dim_play_detail</code>, <code>dim_play_detail_2</code>)
<pre><code>-- Used for play context
SELECT <em> FROM dim_play_detail;
-- Examples: Rush, Cycle, Power Play, Penalty Kill, Breakaway, Odd-Man Rush</p>
<p>SELECT </em> FROM dim_play_detail_2;
-- Examples: 2-on-1, 3-on-2, Rebound, Cross-ice, One-timer</code></pre></p>
<p>#### Shot Types (<code>dim_shot_type</code>)
<td> shot_type_id </td> shot_type <td>
</td>--------------<td>-----------</td>
<td> ST001 </td> Wrist <td>
</td> ST002 <td> Slap </td>
<td> ST003 </td> Snap <td>
</td> ST004 <td> Backhand </td>
<td> ST005 </td> Deflection <td>
</td> ST006 <td> Wrap-around </td></p>
<p>#### Pass Types (<code>dim_pass_type</code>)
<td> pass_type_id </td> pass_type <td>
</td>--------------<td>-----------</td>
<td> PT001 </td> Direct <td>
</td> PT002 <td> Saucer </td>
<td> PT003 </td> Bank <td>
</td> PT004 <td> Cross-ice </td>
<td> PT005 </td> Drop <td>
</td> PT006 <td> Behind-back </td></p>
<p>#### Zones (<code>dim_zone</code>)
<td> zone_id </td> zone_name <td>
</td>---------<td>-----------</td>
<td> OZ </td> Offensive Zone <td>
</td> NZ <td> Neutral Zone </td>
<td> DZ </td> Defensive Zone <td></p>
<p>#### Success Outcomes (<code>dim_success</code>)
</td> success_id <td> success_value </td>
<td>------------</td>---------------<td>
</td> s <td> Successful </td>
<td> u </td> Unsuccessful <td></p>
<p>#### Player Roles (<code>dim_player_role</code>)
</td> role_id <td> role_name </td> role_abrev <td>
</td>---------<td>-----------</td>------------<td>
</td> R001 <td> Shooter </td> SH <td>
</td> R002 <td> Passer </td> PA <td>
</td> R003 <td> Receiver </td> RC <td>
</td> R004 <td> Blocker </td> BL <td>
</td> R005 <td> Hitter </td> HT <td>
</td> R006 <td> Target </td> TG <td></p>
<p>#### Periods (<code>dim_period</code>)
</td> period_id <td> period_name </td> period_number <td>
</td>-----------<td>-------------</td>---------------<td>
</td> P1 <td> 1st Period </td> 1 <td>
</td> P2 <td> 2nd Period </td> 2 <td>
</td> P3 <td> 3rd Period </td> 3 <td>
</td> OT <td> Overtime </td> 4 <td>
</td> SO <td> Shootout </td> 5 <td></p>
<p>#### Situations (<code>dim_situation</code>)
</td> situation_id <td> situation </td>
<td>--------------</td>-----------<td>
</td> EV <td> Even Strength </td>
<td> PP </td> Power Play <td>
</td> PK <td> Penalty Kill </td>
<td> EN </td> Empty Net <td>
</td> 4v4 <td> 4-on-4 </td>
<td> 3v3 </td> 3-on-3 <td></p>
<p>#### Strength (<code>dim_strength</code>)
</td> strength_id <td> strength </td>
<td>-------------</td>----------<td>
</td> 5v5 <td> 5-on-5 </td>
<td> 5v4 </td> 5-on-4 <td>
</td> 4v5 <td> 4-on-5 </td>
<td> 5v3 </td> 5-on-3 <td>
</td> 3v5 <td> 3-on-5 </td>
<td> 4v4 </td> 4-on-4 <td>
</td> 3v3 <td> 3-on-3 </td>
<td> 6v5 </td> 6-on-5 <td>
</td> 6v4 <td> 6-on-4 </td></p>
<hr>
<h2>Event Structure</h2>
<h3>fact_events Columns</h3>
<pre><code>const eventRecord = {
  // Keys
  event_key: "EV1896900001",           // PRIMARY KEY
  game_id: "18969",
  shift_key: "18969_1",                // Links to fact_shifts
  
  // Timing
  period: 1,
  event_index: 1,
  event_start_min: 19,
  event_start_sec: 45,
  event_end_min: 19,
  event_end_sec: 43,
  time_start_total_seconds: 15,        // Seconds into period
  time_end_total_seconds: 17,
  
  // Video timing (CRITICAL for dashboard)
  running_video_time: 125.5,           // Seconds from video start
  event_running_start: 125.5,
  event_running_end: 127.5,
  
  // Event classification
  event_type: "Shot",
  event_detail: "Wrist Shot",
  event_detail_2: null,
  event_successful: "s",               // 's' or 'u'
  Type: "Shot",                        // Legacy field
  
  // Play context
  play_detail1: "Rush",
  play_detail_2: "2-on-1",
  play_detail_successful: "s",
  
  // Zone info
  event_team_zone: "OZ",
  home_team_zone: "DZ",
  away_team_zone: "OZ",
  
  // Team context
  team_venue: "Away",
  team_venue_abv: "A",
  home_team: "Storm",
  away_team: "Lightning",
  home_team_id: "T001",
  away_team_id: "T002",
  
  // Linking
  linked_event_index: null,            // For shot→save→rebound chains
  sequence_index: 1,                   // Possession sequence
  play_index: 1,                       // Play within sequence
  
  // IDs for joins
  period_id: "P1",
  venue_id: "H",
  event_type_id: "EVT001",
  event_detail_id: "ED001",
  success_id: "s",
  zone_id: "OZ",
  play_detail_id: "PD001",
  
  // Special
  empty_net_goal: 0
};</code></pre>
<h3>fact_events_player Columns</h3>
<p>Each event can have multiple players involved:</p>
<pre><code>const eventPlayerRecord = {
  // Keys
  event_player_key: "EV1896900001_1",  // PRIMARY KEY
  event_key: "EV1896900001",           // FK to fact_events
  game_id: "18969",
  
  // Player info
  player_id: "P001",
  player_name: "John Smith",
  player_number: 17,
  role_abrev: "SH",                    // Shooter
  
  // Same timing as parent event
  period: 1,
  event_index: 1,
  // ... all timing fields ...
  
  // Same event info
  event_type: "Shot",
  Type: "Shot",
  // ... all event classification fields ...
  
  // Team context for this player
  player_team_id: "T002",
  shift_key: "18969_1"
};</code></pre>
<hr>
<h2>Linked Events Logic</h2>
<h3>CRITICAL: How Events Chain Together</h3>
<p>Events are linked via <code>linked_event_index</code>. The pattern:</p>
<pre><code>Event 1 (Shot) → Event 2 (Save) → Event 3 (Rebound) → Event 4 (Shot)...</code></pre>
<h3>Shot → Save → Rebound Chain</h3>
<pre><code>// EVENT 1: SHOT
{
  event_key: "EV1896900001",
  event_index: 1,
  event_type: "Shot",
  linked_event_index: null,  // First in chain
  
  // Players:
  // event_player_1: Shooter (team A)
  // opp_player_1: Goalie (team B)
  // event_player_2-6: Other attackers
  // opp_player_2-6: Other defenders
}
<p>// EVENT 2: SAVE (linked to shot)
{
  event_key: "EV1896900002",
  event_index: 2,
  event_type: "Save",
  linked_event_index: 1,     // Links back to shot
  
  // Players SWAP:
  // event_player_1: Goalie (was opp_player_1)
  // opp_player_1: Shooter (was event_player_1)
  // Other players swap sides too
}</p>
<p>// EVENT 3: REBOUND (only goalie involved)
{
  event_key: "EV1896900003",
  event_index: 3,
  event_type: "Rebound",
  linked_event_index: 2,     // Links to save
  
  // Players:
  // event_player_1: Goalie ONLY
  // No other players
}</code></pre></p>
<h3>Player Role Rules by Event Type</h3>
<td> Event Type </td> event_player_1 <td> opp_player_1 </td> Notes <td>
</td>------------<td>----------------</td>--------------<td>-------</td>
<td> <strong>Shot</strong> </td> Shooter <td> Goalie </td> Other players optional <td>
</td> <strong>Save</strong> <td> Goalie </td> Shooter <td> Roles swap from shot </td>
<td> <strong>Rebound</strong> </td> Goalie <td> - </td> Goalie only <td>
</td> <strong>Goal</strong> <td> Scorer </td> Goalie <td> Assists are player_2, player_3 </td>
<td> <strong>Pass</strong> </td> Passer <td> - </td> Receiver is event_player_2 <td>
</td> <strong>Hit</strong> <td> Hitter </td> Target <td> - </td>
<td> <strong>Block</strong> </td> Blocker <td> Shooter </td> - <td>
</td> <strong>Faceoff</strong> <td> Winner </td> Loser <td> - </td>
<td> <strong>Turnover</strong> </td> Player losing puck <td> - </td> - <td>
</td> <strong>Takeaway</strong> <td> Player gaining puck </td> Lost by <td> - </td>
<td> <strong>Stoppage</strong> </td> Last event_player_1 <td> - </td> Inherit from previous <td>
<h3>Same Players, Different Events</h3>
<p>Within a linked chain, typically:
<ul>
<li>Same players maintain same roles</li>
<li>Same <code>play_detail</code> and <code>play_detail_2</code></li>
<li>Only changes: <code>event_type</code>, <code>event_detail</code>, <code>event_detail_2</code>, <code>success</code></li>
</ul></p>
<hr>
<h2>Shift Structure</h2>
<h3>fact_shifts Columns</h3>
<pre><code>const shiftRecord = {
  // Keys
  shift_key: "18969_1",                // PRIMARY KEY
  game_id: "18969",
  shift_index: 1,
  
  // Timing
  Period: 1,                           // Note: uppercase P
  shift_start_min: 20,
  shift_start_sec: 0,
  shift_end_min: 19,
  shift_end_sec: 15,
  shift_duration: 45,                  // Seconds
  shift_start_total_seconds: 0,
  shift_end_total_seconds: 45,
  
  // Video timing
  running_video_time: 60.0,
  shift_start_running_time: 60.0,
  shift_end_running_time: 105.0,
  
  // Start/Stop types
  shift_start_type: "Faceoff",
  shift_stop_type: "Whistle",
  shift_start_type_id: "SS001",
  shift_stop_type_id: "ST001",
  
  // Players on ice (by position)
  home_forward_1: 17,                  // Jersey numbers
  home_forward_2: 23,
  home_forward_3: 9,
  home_defense_1: 4,
  home_defense_2: 77,
  home_goalie: 35,
  home_xtra: null,                     // Extra attacker if pulled goalie
  
  away_forward_1: 11,
  away_forward_2: 19,
  away_forward_3: 88,
  away_defense_1: 2,
  away_defense_2: 6,
  away_goalie: 30,
  away_xtra: null,
  
  // Strength/Situation
  home_team_strength: 5,
  away_team_strength: 5,
  strength: "5v5",
  situation: "EV",
  strength_id: "5v5",
  situation_id: "EV",
  
  // Team info
  home_team: "Storm",
  away_team: "Lightning",
  home_team_id: "T001",
  away_team_id: "T002",
  
  // Zone time (accumulated during shift)
  home_ozone_start: 0,
  home_ozone_end: 20,
  home_dzone_start: 0,
  home_dzone_end: 15,
  home_nzone_start: 0,
  home_nzone_end: 10,
  
  // Goals during shift
  home_goals: 0,
  away_goals: 0,
  
  // Plus/Minus during shift
  home_team_plus: 0,
  home_team_minus: 0,
  away_team_plus: 0,
  away_team_minus: 0,
  
  // Special teams
  home_team_en: 0,                     // Empty net
  away_team_en: 0,
  home_team_pk: 0,                     // Penalty kill
  home_team_pp: 0,                     // Power play
  away_team_pp: 0,
  away_team_pk: 0,
  
  // Period reference
  period_id: "P1",
  period_start_total_running_seconds: 0
};</code></pre>
<hr>
<h2>Video Integration</h2>
<h3>CRITICAL: Video Time Sync</h3>
<p>Every event and shift has video timing columns:</p>
<pre><code>// Event video timing
running_video_time: 125.5,    // Seconds from video start
event_running_start: 125.5,   // When event starts
event_running_end: 127.5,     // When event ends
<p>// Shift video timing
running_video_time: 60.0,
shift_start_running_time: 60.0,
shift_end_running_time: 105.0,</code></pre></p>
<h3>Building Video URLs</h3>
<p>Get video URL from <code>dim_schedule</code>:</p>
<pre><code>// From dim_schedule
const gameVideo = {
  video_id: "abc123xyz",
  video_url: "https://youtube.com/watch?v=abc123xyz",
  video_start_time: 0  // Offset if video doesn't start at puck drop
};
<p>// Build timestamped URL
function getVideoUrl(baseUrl, seconds) {
  // YouTube format
  return <code>${baseUrl}&t=${Math.floor(seconds)}s</code>;
  // Example: https://youtube.com/watch?v=abc123xyz&t=125s
}</p>
<p>// For an event
const eventVideoUrl = getVideoUrl(gameVideo.video_url, event.running_video_time);</code></pre></p>
<h3>Multiple Camera Angles</h3>
<p>Check <code>fact_video</code> for additional angles:</p>
<pre><code>SELECT <em> FROM fact_video WHERE game_id = '18969';</code></pre>
<p>May have: Main, Goal Cam, Blue Line, etc.</p>
<hr>
<h2>Supabase Integration</h2>
<h3>Reading Data</h3>
<pre><code>import { createClient } from '@supabase/supabase-js';
<p>const supabase = createClient(
  'https://uuaowslhpgyiudmbvqze.supabase.co',
  'YOUR_ANON_KEY'  // Use anon key for reads
);</p>
<p>// Load dimension tables on startup
async function loadDimensions() {
  const { data: eventTypes } = await supabase
    .from('dim_event_type')
    .select('</em>');
    
  const { data: players } = await supabase
    .from('dim_player')
    .select('player_id, player_full_name, player_primary_position');
    
  const { data: teams } = await supabase
    .from('dim_team')
    .select('team_id, team_name');
    
  // ... load all needed dims
  return { eventTypes, players, teams };
}</p>
<p>// Load game data
async function loadGame(gameId) {
  const { data: events } = await supabase
    .from('fact_events')
    .select('<em>')
    .eq('game_id', gameId)
    .order('event_index');
    
  const { data: shifts } = await supabase
    .from('fact_shifts')
    .select('</em>')
    .eq('game_id', gameId)
    .order('shift_index');
    
  return { events, shifts };
}</code></pre></p>
<h3>Writing Data</h3>
<pre><code>// Use SERVICE_ROLE key for writes (keep secret!)
const supabaseAdmin = createClient(
  'https://uuaowslhpgyiudmbvqze.supabase.co',
  'SERVICE_ROLE_KEY'
);
<p>// Save draft to staging
async function saveDraft(events, shifts, gameId) {
  // Clear existing staging for this game
  await supabaseAdmin
    .from('staging_events')
    .delete()
    .eq('game_id', gameId);
    
  // Insert new staging data
  const { error } = await supabaseAdmin
    .from('staging_events')
    .insert(events);
    
  if (error) throw error;
  
  // Same for shifts
  await supabaseAdmin
    .from('staging_shifts')
    .delete()
    .eq('game_id', gameId);
    
  await supabaseAdmin
    .from('staging_shifts')
    .insert(shifts);
}</p>
<p>// Publish final (move from staging to production)
async function publishGame(gameId) {
  // Get from staging
  const { data: events } = await supabaseAdmin
    .from('staging_events')
    .select('<em>')
    .eq('game_id', gameId);
    
  // Delete existing in production
  await supabaseAdmin
    .from('fact_events')
    .delete()
    .eq('game_id', gameId);
    
  // Insert to production
  await supabaseAdmin
    .from('fact_events')
    .upsert(events);
    
  // Clear staging
  await supabaseAdmin
    .from('staging_events')
    .delete()
    .eq('game_id', gameId);
}</code></pre></p>
<hr>
<h2>Workflow States</h2>
<h3>Game Tracking Workflow</h3>
<pre><code>1. NEW GAME
<ul>
<li>Create game_id</li>
<li>Set up roster from dim_player</li>
<li>Initialize empty events/shifts</li>
</ul>
   
2. TRACKING (Draft)
<ul>
<li>Add events as they happen</li>
<li>Auto-create shifts on changes</li>
<li>Save to staging_</em> tables</li>
<li>Can edit, delete, reorder</li>
</ul>
   
3. REVIEW
<ul>
<li>Validate all events</li>
<li>Check linked events</li>
<li>Verify timing</li>
<li>Compare to video</li>
</ul>
   
4. PUBLISH
<ul>
<li>Move staging → production</li>
<li>Lock for editing</li>
<li>Generate stats</code></pre></li>
</ul>
<h3>Save Modes</h3>
<pre><code>const SAVE_MODES = {
  DRAFT: 'draft',      // Save to staging, can edit
  PARTIAL: 'partial',  // Save incomplete game
  FINAL: 'final'       // Publish to production
};
<p>async function saveGame(gameId, events, shifts, mode) {
  switch(mode) {
    case SAVE_MODES.DRAFT:
      await saveDraft(events, shifts, gameId);
      break;
    case SAVE_MODES.PARTIAL:
      await saveDraft(events, shifts, gameId);
      // Mark as partial in game status
      await updateGameStatus(gameId, 'partial');
      break;
    case SAVE_MODES.FINAL:
      await validateGame(events, shifts);
      await publishGame(gameId);
      await updateGameStatus(gameId, 'complete');
      break;
  }
}</code></pre></p>
<hr>
<h2>Data Validation</h2>
<h3>Before Publishing</h3>
<pre><code>function validateGame(events, shifts) {
  const errors = [];
  
  // 1. Check all events have required fields
  events.forEach(e => {
    if (!e.event_type) errors.push(<code>Event ${e.event_index}: missing event_type</code>);
    if (!e.period) errors.push(<code>Event ${e.event_index}: missing period</code>);
    if (!e.shift_key) errors.push(<code>Event ${e.event_index}: not assigned to shift</code>);
  });
  
  // 2. Check event timing is within shift
  events.forEach(e => {
    const shift = shifts.find(s => s.shift_key === e.shift_key);
    if (shift) {
      if (e.time_start_total_seconds < shift.shift_start_total_seconds </td><td>
          e.time_end_total_seconds > shift.shift_end_total_seconds) {
        errors.push(<code>Event ${e.event_index}: timing outside shift</code>);
      }
    }
  });
  
  // 3. Check linked events are valid
  events.forEach(e => {
    if (e.linked_event_index) {
      const linked = events.find(ev => ev.event_index === e.linked_event_index);
      if (!linked) {
        errors.push(<code>Event ${e.event_index}: invalid linked_event_index</code>);
      }
    }
  });
  
  // 4. Check goals have at least scorer
  events.filter(e => e.event_type === 'Goal').forEach(e => {
    // Should have event_player entries
  });
  
  return errors;
}</code></pre>
<hr>
<h2>UI Recommendations</h2>
<h3>Event Entry Form</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│ EVENT ENTRY                                    [Period: 1]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Time: [19]:[45] - [19]:[43]     Video: [▶ 2:05]           │
│                                                             │
│  Type: [Shot ▼]  Detail: [Wrist ▼]  Success: [✓]           │
│                                                             │
│  Play: [Rush ▼]  Detail: [2-on-1 ▼]                        │
│                                                             │
│  Zone: [OZ ▼]   Team: [Away ▼]                             │
│                                                             │
│  ─── PLAYERS ───────────────────────────────────────────── │
│                                                             │
│  Event Player 1: [#17 Smith ▼] (Shooter)                   │
│  Event Player 2: [#23 Jones ▼] (Passer)                    │
│  Opp Player 1:   [#35 Johnson ▼] (Goalie)                  │
│                                                             │
│  [Link to Previous] [Save] [Next Event →]                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3>Keyboard Shortcuts</h3>
</td> Key <td> Action </td>
<td>-----</td>--------<td>
</td> S <td> Shot </td>
<td> P </td> Pass <td>
</td> G <td> Goal </td>
<td> F </td> Faceoff <td>
</td> H <td> Hit </td>
<td> Space </td> Success toggle <td>
</td> Enter <td> Save & Next </td>
<td> ← → </td> Navigate events <td>
</td> Ctrl+S <td> Save draft </td>
<td> Ctrl+Z </td> Undo |
<hr>
<h2>Testing Your Implementation</h2>
<h3>Test Data</h3>
<p>Use game 18969 as reference:
<ul>
<li>5,833 events</li>
<li>672 shifts</li>
<li>4 periods</li>
<li>Final score: Available in dim_schedule</li>
</ul></p>
<h3>Validation Queries</h3>
<pre><code>-- Check event counts by type
SELECT event_type, COUNT(<em>) 
FROM fact_events 
WHERE game_id = '18969'
GROUP BY event_type;
<p>-- Check linked events
SELECT e1.event_index, e1.event_type, e2.event_index as linked_to, e2.event_type as linked_type
FROM fact_events e1
LEFT JOIN fact_events e2 ON e1.linked_event_index = e2.event_index AND e1.game_id = e2.game_id
WHERE e1.game_id = '18969' AND e1.linked_event_index IS NOT NULL
LIMIT 20;</p>
<p>-- Check events per shift
SELECT shift_key, COUNT(</em>) as events
FROM fact_events
WHERE game_id = '18969'
GROUP BY shift_key
ORDER BY COUNT(<em>) DESC;</code></pre></p>
<hr>
<h2>Common Pitfalls</h2>
<p>1. <strong>Forgetting to link events</strong> - Shot-Save-Rebound must be linked
2. <strong>Wrong player roles</strong> - Goalie/Shooter swap on Save
3. <strong>Video time drift</strong> - Sync video to game clock regularly
4. <strong>Missing shift assignment</strong> - Every event needs a shift_key
5. <strong>Duplicate keys</strong> - Ensure unique event_key generation
6. <strong>Time zone issues</strong> - Store all times in game time (period:min:sec)</p>
<hr>
<h2>Resources</h2>
<ul>
<li>Prototype Tracker: <code>dashboard/tracker_v4_final_WORKING.html</code></li>
<li>Schema: <code>sql/05_FINAL_COMPLETE_SCHEMA.sql</code></li>
<li>Sample Data: <code>data/output/fact_events.csv</code></li>
<li>Dimension Tables: <code>data/output/dim_</em>.csv</code></li>
</ul>
<hr>
<h2>Questions?</h2>
<p>See <code>prompts/tracker_dev_prompt.md</code> for a prompt to start a new Claude chat with full context.
</p>
</body>
</html>