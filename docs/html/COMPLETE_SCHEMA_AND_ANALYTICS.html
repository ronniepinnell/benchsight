<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMPLETE SCHEMA AND ANALYTICS</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        a { color: #3498db; }
        hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
        .success { color: #27ae60; }
        .warning { color: #f39c12; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
<h1>BenchSight Complete Schema & Analytics Guide</h1>
<strong>Version:</strong> 2.0  
<strong>Date:</strong> December 30, 2025  
<strong>Tables:</strong> 96  
<strong>Total Columns:</strong> ~1,900
<hr>
<h2>Table of Contents</h2>
<p>1. <a href="#complete-table-inventory">Complete Table Inventory (96 Tables)</a>
2. <a href="#entity-relationship-diagram">Entity Relationship Diagram</a>
3. <a href="#key-relationships">Key Relationships</a>
4. <a href="#wowy-analysis">WOWY Analysis (With Or Without You)</a>
5. <a href="#h2h-analysis">H2H Analysis (Head to Head)</a>
6. <a href="#player-comparisons">Player Comparisons</a>
7. <a href="#line-combinations">Line Combinations</a>
8. <a href="#query-examples">Query Examples</a></p>
<hr>
<h2>Complete Table Inventory</h2>
<h3>Dimension Tables (44 tables)</h3>
<td> Table </td> Columns <td> Rows </td> Description <td>
</td>-------<td>---------</td>------<td>-------------</td>
<td> dim_player </td> 28 <td> 337 </td> Player master data (name, position, rating, etc.) <td>
</td> dim_team <td> 15 </td> 26 <td> Team master data </td>
<td> dim_schedule </td> 44 <td> 562 </td> Game schedule with scores, video links <td>
</td> dim_season <td> 9 </td> 9 <td> Season definitions </td>
<td> dim_event_type </td> 3 <td> 20 </td> Event types (Shot, Pass, Goal, etc.) <td>
</td> dim_event_detail <td> 3 </td> 59 <td> Event details (Wrist Shot, Slap Shot, etc.) </td>
<td> dim_event_detail_2 </td> 6 <td> 97 </td> Secondary event details <td>
</td> dim_play_detail <td> 6 </td> 154 <td> Play context (Rush, Cycle, etc.) </td>
<td> dim_play_detail_2 </td> 5 <td> 62 </td> Secondary play details (2-on-1, etc.) <td>
</td> dim_zone <td> 4 </td> 3 <td> Zones (OZ, NZ, DZ) </td>
<td> dim_period </td> 7 <td> 5 </td> Periods (P1, P2, P3, OT, SO) <td>
</td> dim_situation <td> 3 </td> 5 <td> Situations (EV, PP, PK, etc.) </td>
<td> dim_strength </td> 7 <td> 18 </td> Strength states (5v5, 5v4, etc.) <td>
</td> dim_success <td> 4 </td> 1 <td> Success outcomes (s/u) </td>
<td> dim_venue </td> 4 <td> 2 </td> Home/Away <td>
</td> dim_position <td> 4 </td> 7 <td> Player positions </td>
<td> dim_player_role </td> 6 <td> 14 </td> Roles in events (Shooter, Passer, etc.) <td>
</td> dim_shot_type <td> 10 </td> 14 <td> Shot types </td>
<td> dim_pass_type </td> 8 <td> 16 </td> Pass types <td>
</td> dim_turnover_type <td> 9 </td> 21 <td> Turnover types </td>
<td> dim_turnover_quality </td> 5 <td> 3 </td> Turnover quality ratings <td>
</td> dim_takeaway_type <td> 8 </td> 10 <td> Takeaway types </td>
<td> dim_giveaway_type </td> 8 <td> 12 </td> Giveaway types <td>
</td> dim_zone_entry_type <td> 9 </td> 11 <td> Zone entry types </td>
<td> dim_zone_exit_type </td> 8 <td> 10 </td> Zone exit types <td>
</td> dim_stoppage_type <td> 5 </td> 10 <td> Stoppage types </td>
<td> dim_shift_start_type </td> 7 <td> 9 </td> Shift start types <td>
</td> dim_shift_stop_type <td> 9 </td> 27 <td> Shift stop types </td>
<td> dim_shift_slot </td> 3 <td> 7 </td> Shift slots <td>
</td> dim_net_location <td> 5 </td> 10 <td> Net locations for shots </td>
<td> dim_danger_zone </td> 5 <td> 4 </td> Shot danger zones <td>
</td> dim_rink_coord <td> 7 </td> 19 <td> Rink coordinates </td>
<td> dim_rinkboxcoord </td> 12 <td> 50 </td> Rink box coordinates <td>
</td> dim_rinkcoordzones <td> 14 </td> 198 <td> Coordinate zone mappings </td>
<td> dim_stat </td> 12 <td> 83 </td> Stat definitions <td>
</td> dim_stat_type <td> 6 </td> 57 <td> Stat type categories </td>
<td> dim_stat_category </td> 4 <td> 13 </td> Stat categories <td>
</td> dim_micro_stat <td> 4 </td> 22 <td> Micro stat definitions </td>
<td> dim_comparison_type </td> 5 <td> 6 </td> Comparison types <td>
</td> dim_composite_rating <td> 6 </td> 8 <td> Composite rating definitions </td>
<td> dim_league </td> 2 <td> 2 </td> League info <td>
</td> dim_terminology_mapping <td> 4 </td> 84 <td> Term mappings </td>
<td> dim_playerurlref </td> 3 <td> 548 </td> Player URL references <td>
</td> dim_randomnames <td> 5 </td> 486 <td> Random name generator </td>
<h3>Fact Tables (51 tables)</h3>
<td> Table </td> Columns <td> Rows </td> Description <td>
</td>-------<td>---------</td>------<td>-------------</td>
<td> <strong>Core Events & Shifts</strong> </td>||<td>
</td> fact_events <td> 54 </td> 5,833 <td> All game events </td>
<td> fact_events_player </td> 63 <td> 11,635 </td> Player involvement in events <td>
</td> fact_events_long <td> 32 </td> 11,136 <td> Events in long format </td>
<td> fact_events_tracking </td> 46 <td> 11,918 </td> Event tracking details <td>
</td> fact_linked_events <td> 48 </td> 473 <td> Linked event chains </td>
<td> fact_shifts </td> 63 <td> 672 </td> All shifts <td>
</td> fact_shifts_player <td> 35 </td> 4,626 <td> Players on shifts </td>
<td> fact_shifts_long </td> 28 <td> 4,336 </td> Shifts in long format <td>
</td> fact_shifts_tracking <td> 58 </td> 476 <td> Shift tracking details </td>
<td> fact_shift_players </td> 9 <td> 5,513 </td> Shift-player junction <td>
</td> fact_shift_quality <td> 13 </td> 4,626 <td> Shift quality metrics </td>
<td> fact_shift_quality_logical </td> 10 <td> 105 </td> Logical shift quality <td>
</td> <strong>Player Stats</strong> |||<td>
</td> fact_player_game_stats <td> 317 </td> 107 <td> Comprehensive per-game stats </td>
<td> fact_player_boxscore_all </td> 23 <td> 14,473 </td> All player boxscores <td>
</td> fact_player_stats_long <td> 6 </td> 7,026 <td> Stats in long format </td>
<td> fact_player_period_stats </td> 10 <td> 321 </td> Per-period stats <td>
</td> fact_player_micro_stats <td> 6 </td> 212 <td> Micro-level stats </td>
<td> fact_player_game_position </td> 10 <td> 105 </td> Position by game <td>
</td> fact_player_event_chains <td> 22 </td> 5,831 <td> Player event chains </td>
<td> fact_playergames </td> 25 <td> 3,010 </td> Player-game records <td>
</td> <strong>Team Stats</strong> |||<td>
</td> fact_team_game_stats <td> 52 </td> 8 <td> Per-game team stats </td>
<td> fact_team_standings_snapshot </td> 14 <td> 1,124 </td> Standings over time <td>
</td> fact_team_zone_time <td> 18 </td> 8 <td> Zone time by team </td>
<td> <strong>Analytics</strong> </td>||<td>
</td> fact_h2h <td> 24 </td> 684 <td> Head-to-head matchups </td>
<td> fact_head_to_head </td> 16 <td> 572 </td> Alternative H2H format <td>
</td> fact_wowy <td> 28 </td> 641 <td> With/Without You analysis </td>
<td> fact_matchup_summary </td> 29 <td> 684 </td> Matchup summaries <td>
</td> fact_player_pair_stats <td> 12 </td> 475 <td> Player pair statistics </td>
<td> fact_line_combos </td> 40 <td> 332 </td> Line combination stats <td>
</td> <strong>Sequences & Plays</strong> |||<td>
</td> fact_sequences <td> 28 </td> 1,088 <td> Possession sequences </td>
<td> fact_plays </td> 25 <td> 2,714 </td> Individual plays <td>
</td> fact_event_chains <td> 15 </td> 295 <td> Event chain analysis </td>
<td> <strong>Scoring & Shots</strong> </td>||<td>
</td> fact_scoring_chances <td> 14 </td> 451 <td> Scoring chance quality </td>
<td> fact_shot_danger </td> 10 <td> 435 </td> Shot danger ratings <td>
</td> fact_shot_xy <td> 31 </td> 0 <td> Shot coordinates (empty) </td>
<td> fact_rush_events </td> 12 <td> 199 </td> Rush events <td>
</td> fact_cycle_events <td> 7 </td> 9 <td> Cycle events </td>
<td> <strong>Goalie Stats</strong> </td>||<td>
</td> fact_goalie_game_stats <td> 19 </td> 8 <td> Goalie stats per game </td>
<td> <strong>Position Tracking</strong> </td>||<td>
</td> fact_player_xy_long <td> 16 </td> 0 <td> Player positions (CV data) </td>
<td> fact_player_xy_wide </td> 50 <td> 0 </td> Player positions wide <td>
</td> fact_puck_xy_long <td> 12 </td> 0 <td> Puck positions (CV data) </td>
<td> fact_puck_xy_wide </td> 55 <td> 0 </td> Puck positions wide <td>
</td> <strong>Other</strong> |||<td>
</td> fact_gameroster <td> 29 </td> 14,471 <td> Game rosters </td>
<td> fact_game_status </td> 24 <td> 562 </td> Game status tracking <td>
</td> fact_possession_time <td> 14 </td> 107 <td> Possession time stats </td>
<td> fact_video </td> 15 <td> 10 </td> Video metadata <td>
</td> fact_draft <td> 15 </td> 160 <td> Draft data </td>
<td> fact_registration </td> 19 <td> 190 </td> Player registration <td>
</td> fact_leadership <td> 9 </td> 28 <td> Leadership stats </td>
<td> fact_league_leaders_snapshot </td> 13 <td> 14,473 </td> League leader snapshots <td>
</td> fact_suspicious_stats <td> 14 </td> 18 <td> Flagged suspicious stats </td>
<h3>QA Tables (1 table)</h3>
<td> Table </td> Columns <td> Rows </td> Description <td>
</td>-------<td>---------</td>------<td>-------------</td>
<td> qa_suspicious_stats </td> 11 <td> 22 </td> Data quality flags <td>
<hr>
<h2>Entity Relationship Diagram</h2>
<h3>Core Schema (Star Schema)</h3>
<pre><code>                              ┌─────────────────────┐
                              │     dim_player      │
                              │─────────────────────│
                              │ player_id (PK)      │
                              │ player_full_name    │
                              │ player_position     │
                              │ current_skill_rating│
                              └──────────┬──────────┘
                                         │
         ┌───────────────────────────────┼───────────────────────────────┐
         │                               │                               │
         ▼                               ▼                               ▼
┌─────────────────┐            ┌─────────────────┐            ┌─────────────────┐
│ fact_events_    │            │ fact_player_    │            │ fact_shifts_    │
│ player          │            │ game_stats      │            │ player          │
│─────────────────│            │─────────────────│            │─────────────────│
│ event_player_key│            │ player_game_key │            │ shift_player_key│
│ event_key (FK)  │            │ game_id (FK)    │            │ shift_key (FK)  │
│ player_id (FK)  │            │ player_id (FK)  │            │ player_id (FK)  │
│ role_abrev      │            │ goals, assists  │            │ toi, plus_minus │
└────────┬────────┘            │ shots, hits...  │            └────────┬────────┘
         │                     └─────────────────┘                     │
         │                                                             │
         ▼                                                             ▼
┌─────────────────┐                                          ┌─────────────────┐
│  fact_events    │                                          │  fact_shifts    │
│─────────────────│                                          │─────────────────│
│ event_key (PK)  │◄─────────────────────────────────────────│ shift_key (PK)  │
│ game_id (FK)    │          shift_key (FK)                  │ game_id (FK)    │
│ shift_key (FK)  │─────────────────────────────────────────►│ period          │
│ period          │                                          │ shift_duration  │
│ event_type      │                                          │ strength        │
│ event_detail    │                                          │ situation       │
│ running_video_  │                                          │ running_video_  │
│ time            │                                          │ time            │
└────────┬────────┘                                          └────────┬────────┘
         │                                                            │
         │                     ┌─────────────────┐                    │
         │                     │  dim_schedule   │                    │
         └─────────────────────┤─────────────────├────────────────────┘
                               │ game_id (PK)    │
                               │ date            │
                               │ home_team_id(FK)│
                               │ away_team_id(FK)│
                               │ home_total_goals│
                               │ away_total_goals│
                               │ video_url       │
                               └────────┬────────┘
                                        │
                    ┌───────────────────┴───────────────────┐
                    ▼                                       ▼
           ┌─────────────────┐                     ┌─────────────────┐
           │    dim_team     │                     │   dim_season    │
           │─────────────────│                     │─────────────────│
           │ team_id (PK)    │                     │ season_id (PK)  │
           │ team_name       │                     │ season_name     │
           │ team_color1     │                     │ start_date      │
           │ team_logo       │                     │ end_date        │
           └─────────────────┘                     └─────────────────┘</code></pre>
<h3>Analytics Tables Relationships</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                           ANALYTICS LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐       │
│  │    fact_wowy    │     │    fact_h2h     │     │fact_line_combos │       │
│  │─────────────────│     │─────────────────│     │─────────────────│       │
│  │ wowy_key (PK)   │     │ h2h_key (PK)    │     │line_combo_key   │       │
│  │ game_id (FK)    │     │ game_id (FK)    │     │ game_id (FK)    │       │
│  │ player_1_id (FK)│     │ player_1_id (FK)│     │ venue           │       │
│  │ player_2_id (FK)│     │ player_2_id (FK)│     │ forward_combo   │       │
│  │ venue           │     │ shifts_together │     │ defense_combo   │       │
│  │ shifts_together │     │ toi_together    │     │ shifts          │       │
│  │ toi_together    │     │ goals_for       │     │ toi_together    │       │
│  │ toi_apart       │     │ goals_against   │     │ goals_for       │       │
│  │ cf_pct_together │     │ cf_pct          │     │ cf_pct          │       │
│  │ cf_pct_apart    │     │ xgf, xga        │     │ xgf, xga        │       │
│  │ cf_pct_delta    │     └─────────────────┘     │ synergy metrics │       │
│  │ relative_corsi  │                             └─────────────────┘       │
│  └─────────────────┘                                                        │
│           │                       │                        │                │
│           └───────────────────────┴────────────────────────┘                │
│                                   │                                         │
│                                   ▼                                         │
│                          ┌─────────────────┐                                │
│                          │ fact_matchup_   │                                │
│                          │ summary         │                                │
│                          │─────────────────│                                │
│                          │ Combined H2H +  │                                │
│                          │ WOWY metrics    │                                │
│                          │ synergy_score   │                                │
│                          └─────────────────┘                                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
<h2>Key Relationships</h2>
<h3>Primary Keys</h3>
</td> Table <td> Primary Key </td> Format <td> Example </td>
<td>-------</td>-------------<td>--------</td>---------<td>
</td> dim_player <td> player_id </td> P + 6 digits <td> P100023 </td>
<td> dim_team </td> team_id <td> N + 5 digits </td> N10008 <td>
</td> dim_schedule <td> game_id </td> 5 digits <td> 18969 </td>
<td> fact_events </td> event_key <td> EV + game_id + 5-digit index </td> EV1896900001 <td>
</td> fact_shifts <td> shift_key </td> game_id + _ + index <td> 18969_1 </td>
<td> fact_events_player </td> event_player_key <td> event_key + _ + index </td> EV1896900001_1 <td>
</td> fact_shifts_player <td> shift_player_key </td> shift_key + _ + player_id <td> 18969_1_P100023 </td>
<td> fact_player_game_stats </td> player_game_key <td> game_id + _ + player_id </td> 18969_P100023 <td>
</td> fact_h2h <td> h2h_key </td> HH + game_id + 5-digit index <td> HH1896900001 </td>
<td> fact_wowy </td> wowy_key <td> WY + game_id + 5-digit index </td> WY1896900001 <td>
</td> fact_line_combos <td> line_combo_key </td> LC + game_id + 5-digit index <td> LC1896900001 </td>
<h3>Foreign Key Chains</h3>
<pre><code>dim_player.player_id
    ├── fact_events_player.player_id
    ├── fact_shifts_player.player_id
    ├── fact_player_game_stats.player_id
    ├── fact_h2h.player_1_id
    ├── fact_h2h.player_2_id
    ├── fact_wowy.player_1_id
    └── fact_wowy.player_2_id
<p>dim_schedule.game_id
    ├── fact_events.game_id
    ├── fact_shifts.game_id
    ├── fact_player_game_stats.game_id
    ├── fact_team_game_stats.game_id
    ├── fact_h2h.game_id
    ├── fact_wowy.game_id
    └── fact_line_combos.game_id</p>
<p>fact_shifts.shift_key
    └── fact_events.shift_key</p>
<p>fact_events.event_key
    └── fact_events_player.event_key</code></pre></p>
<hr>
<h2>WOWY Analysis (With Or Without You)</h2>
<h3>What is WOWY?</h3>
<p>WOWY measures how a player performs <strong>with</strong> a specific teammate versus <strong>without</strong> them. It answers: "Does Player A play better or worse when Player B is on the ice?"</p>
<h3>Table: <code>fact_wowy</code></h3>
<td> Column </td> Type <td> Description </td>
<td>--------</td>------<td>-------------</td>
<td> wowy_key </td> TEXT PK <td> Unique identifier </td>
<td> game_id </td> TEXT FK <td> Game reference </td>
<td> player_1_id </td> TEXT FK <td> The player being analyzed </td>
<td> player_2_id </td> TEXT FK <td> The teammate being compared </td>
<td> venue </td> TEXT <td> home/away </td>
<td> shifts_together </td> INT <td> Number of shifts together </td>
<td> p1_shifts_without_p2 </td> INT <td> Player 1's shifts without Player 2 </td>
<td> p2_shifts_without_p1 </td> INT <td> Player 2's shifts without Player 1 </td>
<td> toi_together </td> DECIMAL <td> Time on ice together (seconds) </td>
<td> toi_apart </td> DECIMAL <td> Time on ice apart (seconds) </td>
<td> <strong>cf_pct_together</strong> </td> DECIMAL <td> Corsi For % when together </td>
<td> <strong>cf_pct_apart</strong> </td> DECIMAL <td> Corsi For % when apart </td>
<td> <strong>cf_pct_delta</strong> </td> DECIMAL <td> Difference (together - apart) </td>
<td> gf_pct_together </td> DECIMAL <td> Goals For % when together </td>
<td> gf_pct_apart </td> DECIMAL <td> Goals For % when apart </td>
<td> gf_pct_delta </td> DECIMAL <td> Difference </td>
<td> xgf_pct_together </td> DECIMAL <td> Expected Goals For % together </td>
<td> xgf_pct_apart </td> DECIMAL <td> Expected Goals For % apart </td>
<td> xgf_pct_delta </td> DECIMAL <td> Difference </td>
<td> relative_corsi </td> DECIMAL <td> Relative Corsi impact </td>
<td> player_1_name </td> TEXT <td> Player 1 display name </td>
<td> player_2_name </td> TEXT <td> Player 2 display name </td>
<h3>How WOWY Works</h3>
<pre><code>                    Player A's Ice Time
    ┌──────────────────────────────────────────────────┐
    │                                                  │
    │   ┌─────────────────┐    ┌─────────────────┐    │
    │   │   WITH          │    │   WITHOUT       │    │
    │   │   Player B      │    │   Player B      │    │
    │   │                 │    │                 │    │
    │   │  CF% = 55%      │    │  CF% = 48%      │    │
    │   │  (together)     │    │  (apart)        │    │
    │   │                 │    │                 │    │
    │   └─────────────────┘    └─────────────────┘    │
    │                                                  │
    │   DELTA = 55% - 48% = +7%                       │
    │   Player A is BETTER with Player B              │
    └──────────────────────────────────────────────────┘</code></pre>
<h3>Interpreting WOWY</h3>
<td> cf_pct_delta </td> Interpretation <td>
</td>--------------<td>----------------</td>
<td> > +5% </td> Strong positive synergy <td>
</td> +2% to +5% <td> Good chemistry </td>
<td> -2% to +2% </td> Neutral <td>
</td> -5% to -2% <td> Poor chemistry </td>
<td> < -5% </td> Strong negative synergy <td>
<h3>WOWY Query Examples</h3>
<pre><code>-- Find Player A's best linemates
SELECT 
    player_2_name,
    shifts_together,
    toi_together / 60 as minutes_together,
    cf_pct_together,
    cf_pct_apart,
    cf_pct_delta
FROM fact_wowy
WHERE player_1_id = 'P100023'
  AND shifts_together >= 3  -- Minimum sample size
ORDER BY cf_pct_delta DESC
LIMIT 10;
<p>-- Find which teammates hurt a player's performance
SELECT 
    player_2_name,
    cf_pct_delta,
    gf_pct_delta
FROM fact_wowy
WHERE player_1_id = 'P100023'
  AND cf_pct_delta < -5
ORDER BY cf_pct_delta ASC;</p>
<p>-- Best teammate combinations on a team
SELECT 
    player_1_name,
    player_2_name,
    cf_pct_delta,
    toi_together / 60 as minutes
FROM fact_wowy
WHERE game_id = '18969'
  AND venue = 'home'
  AND cf_pct_delta > 0
ORDER BY cf_pct_delta DESC
LIMIT 20;</code></pre></p>
<h3>JavaScript Query (Supabase)</h3>
<pre><code>// Get WOWY data for a player
async function getPlayerWOWY(gameId, playerId) {
    const { data } = await supabase
        .from('fact_wowy')
        .select(<code>
            player_2_id,
            player_2_name,
            shifts_together,
            toi_together,
            cf_pct_together,
            cf_pct_apart,
            cf_pct_delta,
            gf_pct_delta
        </code>)
        .eq('game_id', gameId)
        .eq('player_1_id', playerId)
        .gte('shifts_together', 3)
        .order('cf_pct_delta', { ascending: false });
    
    return data;
}</code></pre>
<hr>
<h2>H2H Analysis (Head to Head)</h2>
<h3>What is H2H?</h3>
<p>H2H measures how a player performs <strong>against</strong> a specific opponent. It answers: "How does Player A do when facing Player B?"</p>
<h3>Table: <code>fact_h2h</code></h3>
</td> Column <td> Type </td> Description <td>
</td>--------<td>------</td>-------------<td>
</td> h2h_key <td> TEXT PK </td> Unique identifier <td>
</td> game_id <td> TEXT FK </td> Game reference <td>
</td> player_1_id <td> TEXT FK </td> The player being analyzed <td>
</td> player_2_id <td> TEXT FK </td> The opponent faced <td>
</td> shifts_together <td> INT </td> Shifts facing each other <td>
</td> toi_together <td> DECIMAL </td> Time on ice against (seconds) <td>
</td> <strong>goals_for</strong> <td> DECIMAL </td> Goals scored while facing opponent <td>
</td> <strong>goals_against</strong> <td> DECIMAL </td> Goals allowed while facing opponent <td>
</td> <strong>plus_minus</strong> <td> DECIMAL </td> Net goals (for - against) <td>
</td> <strong>corsi_for</strong> <td> DECIMAL </td> Shot attempts for <td>
</td> <strong>corsi_against</strong> <td> DECIMAL </td> Shot attempts against <td>
</td> <strong>cf_pct</strong> <td> DECIMAL </td> Corsi For % against opponent <td>
</td> fenwick_for <td> DECIMAL </td> Unblocked shot attempts for <td>
</td> fenwick_against <td> DECIMAL </td> Unblocked shot attempts against <td>
</td> ff_pct <td> DECIMAL </td> Fenwick For % <td>
</td> xgf <td> DECIMAL </td> Expected goals for <td>
</td> xga <td> DECIMAL </td> Expected goals against <td>
</td> xg_diff <td> DECIMAL </td> xGF - xGA <td>
</td> shots_for <td> DECIMAL </td> Shots on goal for <td>
</td> shots_against <td> DECIMAL </td> Shots on goal against <td>
</td> player_1_name <td> TEXT </td> Player 1 display name <td>
</td> player_2_name <td> TEXT </td> Opponent display name <td>
<h3>How H2H Works</h3>
<pre><code>              When Player A faces Player B
    ┌──────────────────────────────────────────────────┐
    │                                                  │
    │  Player A's Team          Player B's Team       │
    │       │                         │               │
    │       ▼                         ▼               │
    │   ┌───────┐                 ┌───────┐          │
    │   │ FOR   │                 │AGAINST│          │
    │   │       │                 │       │          │
    │   │ 2.9   │  Shot Attempts  │ 3.2   │          │
    │   │ Corsi │ ◄────────────── │ Corsi │          │
    │   │       │                 │       │          │
    │   └───────┘                 └───────┘          │
    │                                                  │
    │   CF% = 2.9 / (2.9 + 3.2) = 47.5%               │
    │   Player A is slightly outplayed by Player B    │
    └──────────────────────────────────────────────────┘</code></pre>
<h3>Interpreting H2H</h3>
</td> CF% <td> Interpretation </td>
<td>-----</td>----------------<td>
</td> > 55% <td> Dominating the matchup </td>
<td> 50-55% </td> Winning the matchup <td>
</td> 45-50% <td> Losing the matchup </td>
<td> < 45% </td> Being dominated <td>
<h3>H2H Query Examples</h3>
<pre><code>-- How does Player A do against each opponent?
SELECT 
    player_2_name as opponent,
    shifts_together,
    toi_together / 60 as minutes_against,
    cf_pct,
    plus_minus,
    xg_diff
FROM fact_h2h
WHERE player_1_id = 'P100022'
  AND game_id = '18969'
ORDER BY cf_pct DESC;
<p>-- Find tough matchups (opponents who dominate a player)
SELECT 
    player_2_name as opponent,
    cf_pct,
    goals_against,
    xga
FROM fact_h2h
WHERE player_1_id = 'P100022'
  AND cf_pct < 45
ORDER BY cf_pct ASC;</p>
<p>-- Find favorable matchups
SELECT 
    player_2_name as opponent,
    cf_pct,
    goals_for,
    xgf
FROM fact_h2h
WHERE player_1_id = 'P100022'
  AND cf_pct > 55
ORDER BY cf_pct DESC;</code></pre></p>
<h3>JavaScript Query (Supabase)</h3>
<pre><code>// Get H2H matchups for a player
async function getPlayerH2H(gameId, playerId) {
    const { data } = await supabase
        .from('fact_h2h')
        .select(<code>
            player_2_id,
            player_2_name,
            shifts_together,
            toi_together,
            goals_for,
            goals_against,
            cf_pct,
            xgf,
            xga
        </code>)
        .eq('game_id', gameId)
        .eq('player_1_id', playerId)
        .order('toi_together', { ascending: false });
    
    return data;
}</code></pre>
<hr>
<h2>Player Comparisons</h2>
<h3>Table: <code>fact_player_pair_stats</code></h3>
<p>For comparing any two players' overall stats:</p>
</td> Column <td> Type </td> Description <td>
</td>--------<td>------</td>-------------<td>
</td> game_id <td> TEXT FK </td> Game reference <td>
</td> player_1_id <td> TEXT FK </td> First player <td>
</td> player_1_name <td> TEXT </td> First player name <td>
</td> player_1_rating <td> DECIMAL </td> Skill rating <td>
</td> player_2_id <td> TEXT FK </td> Second player <td>
</td> player_2_name <td> TEXT </td> Second player name <td>
</td> player_2_rating <td> DECIMAL </td> Skill rating <td>
</td> shifts_together <td> INT </td> Times on ice together <td>
</td> toi_together_seconds <td> DECIMAL </td> TOI together <td>
</td> combined_rating <td> DECIMAL </td> Sum of ratings <td>
<h3>Table: <code>fact_head_to_head</code></h3>
<p>Alternative H2H with rating comparisons:</p>
</td> Column <td> Type </td> Description <td>
</td>--------<td>------</td>-------------<td>
</td> player_1_id <td> TEXT </td> Player 1 <td>
</td> player_1_rating <td> DECIMAL </td> Rating <td>
</td> player_1_venue <td> TEXT </td> Home/Away <td>
</td> player_2_id <td> TEXT </td> Player 2 (opponent) <td>
</td> player_2_rating <td> DECIMAL </td> Rating <td>
</td> player_2_venue <td> TEXT </td> Home/Away <td>
</td> shifts_against <td> INT </td> Matchup frequency <td>
</td> toi_against_seconds <td> DECIMAL </td> Time against <td>
</td> rating_diff <td> DECIMAL </td> player_1_rating - player_2_rating <td>
<h3>Building a Player Comparison Dashboard</h3>
<pre><code>async function comparePlayersInGame(gameId, player1Id, player2Id) {
    // Get both players' game stats
    const { data: stats } = await supabase
        .from('fact_player_game_stats')
        .select('<em>')
        .eq('game_id', gameId)
        .in('player_id', [player1Id, player2Id]);
    
    // Get their WOWY with each other
    const { data: wowy } = await supabase
        .from('fact_wowy')
        .select('</em>')
        .eq('game_id', gameId)
        .eq('player_1_id', player1Id)
        .eq('player_2_id', player2Id);
    
    // Get their H2H (if on opposite teams)
    const { data: h2h } = await supabase
        .from('fact_h2h')
        .select('<em>')
        .eq('game_id', gameId)
        .eq('player_1_id', player1Id)
        .eq('player_2_id', player2Id);
    
    return {
        player1Stats: stats.find(s => s.player_id === player1Id),
        player2Stats: stats.find(s => s.player_id === player2Id),
        wowy: wowy[0],  // If teammates
        h2h: h2h[0]     // If opponents
    };
}</code></pre>
<hr>
<h2>Line Combinations</h2>
<h3>Table: <code>fact_line_combos</code></h3>
</td> Column <td> Type </td> Description <td>
</td>--------<td>------</td>-------------<td>
</td> line_combo_key <td> TEXT PK </td> Unique key <td>
</td> game_id <td> TEXT FK </td> Game reference <td>
</td> venue <td> TEXT </td> Home/Away <td>
</td> <strong>forward_combo</strong> <td> TEXT </td> F1-F2-F3 player IDs <td>
</td> <strong>defense_combo</strong> <td> TEXT </td> D1-D2 player IDs <td>
</td> shifts <td> INT </td> Shifts together <td>
</td> toi_together <td> DECIMAL </td> TOI in seconds <td>
</td> goals_for <td> INT </td> Goals scored <td>
</td> goals_against <td> INT </td> Goals allowed <td>
</td> plus_minus <td> INT </td> Net goals <td>
</td> corsi_for <td> DECIMAL </td> Shot attempts for <td>
</td> corsi_against <td> DECIMAL </td> Shot attempts against <td>
</td> cf_pct <td> DECIMAL </td> Corsi For % <td>
</td> xgf <td> DECIMAL </td> Expected goals for <td>
</td> xg_against <td> DECIMAL </td> Expected goals against <td>
</td> zone_entries <td> INT </td> Zone entries <td>
</td> zone_exits <td> INT </td> Zone exits <td>
</td> controlled_entry_pct <td> DECIMAL </td> % controlled entries <td>
</td> giveaways <td> INT </td> Giveaways <td>
</td> takeaways <td> INT </td> Takeaways <td>
</td> <strong>avg_player_rating</strong> <td> DECIMAL </td> Average line rating <td>
</td> <strong>opp_avg_rating</strong> <td> DECIMAL </td> Average opponent rating <td>
</td> rating_diff <td> DECIMAL </td> Rating advantage <td>
</td> pdo <td> DECIMAL </td> PDO (luck metric) <td>
</td> sh_pct <td> DECIMAL </td> Shooting % <td>
</td> sv_pct <td> DECIMAL </td> Save % <td>
</td> team_name <td> TEXT </td> Team name <td>
<h3>Line Combo Query Examples</h3>
<pre><code>-- Best performing lines by CF%
SELECT 
    forward_combo,
    defense_combo,
    shifts,
    toi_together / 60 as minutes,
    goals_for,
    goals_against,
    cf_pct,
    xgf - xg_against as xg_diff
FROM fact_line_combos
WHERE game_id = '18969'
  AND venue = 'home'
  AND shifts >= 3
ORDER BY cf_pct DESC;
<p>-- Lines that score the most
SELECT 
    forward_combo,
    goals_for,
    xgf,
    sh_pct
FROM fact_line_combos
WHERE game_id = '18969'
ORDER BY goals_for DESC;</p>
<p>-- Defensive pairings
SELECT 
    defense_combo,
    shifts,
    goals_against,
    xg_against,
    cf_pct
FROM fact_line_combos
WHERE game_id = '18969'
ORDER BY goals_against ASC;</code></pre></p>
<hr>
<h2>Query Examples</h2>
<h3>Complete Player Analysis Dashboard</h3>
<pre><code>async function getPlayerDashboard(gameId, playerId) {
    // Basic stats
    const { data: stats } = await supabase
        .from('fact_player_game_stats')
        .select('</em>')
        .eq('game_id', gameId)
        .eq('player_id', playerId)
        .single();
    
    // WOWY - who does this player play well with?
    const { data: wowy } = await supabase
        .from('fact_wowy')
        .select('player_2_name, cf_pct_delta, toi_together')
        .eq('game_id', gameId)
        .eq('player_1_id', playerId)
        .order('cf_pct_delta', { ascending: false })
        .limit(5);
    
    // H2H - who does this player struggle against?
    const { data: h2h } = await supabase
        .from('fact_h2h')
        .select('player_2_name, cf_pct, toi_together')
        .eq('game_id', gameId)
        .eq('player_1_id', playerId)
        .order('toi_together', { ascending: false })
        .limit(5);
    
    // Line combos this player was part of
    const { data: lines } = await supabase
        .from('fact_line_combos')
        .select('forward_combo, defense_combo, cf_pct, goals_for')
        .eq('game_id', gameId)
        .or(<code>forward_combo.ilike.%${playerId}%,defense_combo.ilike.%${playerId}%</code>);
    
    return { stats, wowy, h2h, lines };
}</code></pre>
<h3>Team WOWY Matrix</h3>
<pre><code>-- Create a matrix of all teammate combinations
SELECT 
    p1.player_1_name as player,
    p1.player_2_name as with_teammate,
    p1.cf_pct_together,
    p1.cf_pct_apart,
    p1.cf_pct_delta
FROM fact_wowy p1
WHERE p1.game_id = '18969'
  AND p1.venue = 'home'
ORDER BY p1.player_1_name, p1.cf_pct_delta DESC;</code></pre>
<h3>H2H Matchup Report</h3>
<pre><code>-- Full matchup report for a game
SELECT 
    h.player_1_name as player,
    h.player_2_name as opponent,
    h.toi_together / 60 as minutes,
    h.cf_pct,
    h.goals_for,
    h.goals_against,
    h.xgf - h.xga as xg_diff
FROM fact_h2h h
WHERE h.game_id = '18969'
ORDER BY h.toi_together DESC;</code></pre>
<hr>
<h2>Visual Dashboard Ideas</h2>
<h3>WOWY Heatmap</h3>
<pre><code>                    PLAYER A's WOWY MATRIX
                    
              Teammate B  Teammate C  Teammate D
           ┌─────────────┬───────────┬───────────┐
 CF% Delta │    +7.2%    │   +3.1%   │   -2.4%   │
           │   (green)   │  (yellow) │   (red)   │
           └─────────────┴───────────┴───────────┘
           
 Interpretation: Player A plays best with Teammate B</code></pre>
<h3>H2H Comparison Chart</h3>
<pre><code>         Player A vs Opponents
         
 Opponent    CF%    Minutes    Result
 ─────────────────────────────────────
 Opp 1      62%    ████████   WON
 Opp 2      55%    ██████     WON
 Opp 3      48%    ████       LOST
 Opp 4      41%    ██████     LOST</code></pre>
<h3>Line Combo Performance</h3>
<pre><code>         Line Performance (CF%)
         
 Line 1 (F-F-F / D-D)   ████████████  58%
 Line 2 (F-F-F / D-D)   ██████████    52%
 Line 3 (F-F-F / D-D)   ████████      47%
 Line 4 (F-F-F / D-D)   ██████        44%</code></pre>
<hr>
<h2>Summary</h2>
</td> Analysis Type <td> Table </td> Key Metric <td> Use Case </td>
<td>--------------</td>-------<td>------------</td>----------<td>
</td> <strong>WOWY</strong> <td> fact_wowy </td> cf_pct_delta <td> Find best linemates </td>
<td> <strong>H2H</strong> </td> fact_h2h <td> cf_pct </td> Find tough matchups <td>
</td> <strong>Line Combos</strong> <td> fact_line_combos </td> cf_pct, goals <td> Optimize lines </td>
<td> <strong>Player Pairs</strong> </td> fact_player_pair_stats <td> combined_rating </td> Chemistry analysis <td>
</td> <strong>Matchup Summary</strong> <td> fact_matchup_summary </td> synergy_score <td> Combined analysis </td>
<p>These analytics tables enable NHL-quality analysis at the recreational level!
</p>
</body>
</html>