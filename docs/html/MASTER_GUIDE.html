<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER GUIDE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        a { color: #3498db; }
        hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
        .success { color: #27ae60; }
        .warning { color: #f39c12; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
<h1>BenchSight Complete Technical Guide v13.18</h1>
<strong>Last Updated:</strong> January 7, 2026
<hr>
<h2>⚠️ CRITICAL: The ETL is Broken</h2>
<td> Metric </td> Count <td>
</td>--------<td>-------</td>
<td> Tables created by ETL from scratch </td> ~62 <td>
</td> Tables with NO source code (broken) <td> ~68 </td>
<td> Total tables in backup </td> 130 <td>
<strong>To get working 59 tables:</strong>
<pre><code>cp data/output_backup_v13.02/<em>.csv data/output/</code></pre>
<hr>
<h2>Table of Contents</h2>
<p>1. <a href="#1-llm-instructions">LLM Instructions</a>
2. <a href="#2-quick-reference">Quick Reference</a>
3. <a href="#3-etl-workflow">ETL Workflow</a>
4. <a href="#4-module-reference">Module Reference</a>
5. <a href="#5-working-tables-62">Working Tables (59)</a>
6. <a href="#6-broken-tables-68">Broken Tables (68)</a>
7. <a href="#7-table-details--data-dictionary">Table Details & Data Dictionary</a></p>
<hr>
<h2>1. LLM Instructions</h2>
<h3>Copy-Paste This At Start of Every Chat</h3>
<pre><code>MANDATORY RULES - VIOLATIONS WILL WASTE TIME AND MONEY:
<p>1. READ LLM_REQUIREMENTS.md AND MASTER_GUIDE.md FIRST
2. NO NEW FILES unless I explicitly ask for one. Fix existing code.
3. NO PLACEHOLDER DATA. Ever. If data is missing, fix why it's missing.
4. NO POST-PROCESSING SCRIPTS. Fix the source.
5. Before ANY code change, show me:
<ul>
<li>WHICH FILE you will modify</li>
<li>WHAT LINE(S) you will change</li>
<li>WHY this is the root cause, not a symptom</li>
</ul>
6. After ANY code change, run tests and show results.
7. If you cannot find the root cause, SAY SO. Don't fake a fix.</p>
<p>CURRENT STATE:
<ul>
<li>ETL creates ~59 tables from scratch</li>
<li>~68 tables are BROKEN (no source code)</li>
<li>Full 59 tables available ONLY from backup</li>
</ul></p>
<p>VERIFICATION AFTER EVERY CHANGE:
rm -rf data/output/</em>.csv && python run_etl.py
Expected: ~59 tables, 32 passing tests</p>
<p>TO GET ALL 130 TABLES:
cp data/output_backup_v13.02/<em>.csv data/output/</p>
<p>GOAL COUNTING RULE:
Goals = event_type='Goal' AND event_detail='Goal_Scored'
Shot_Goal is the SHOT, not the goal!</code></pre></p>
<h3>Red Flags - Stop the LLM If You See These</h3>
<ul>
<li>"Let me create a script to fix this..."</li>
<li>"I'll add a post-processing step..."</li>
<li>"Let me generate the missing tables..."</li>
<li>Creating any file named <code>fix_</em>.py</code>, <code>patch_<em>.py</code>, <code>enhancement_</em>.py</code></li>
<li>Using backup data to "fill in" missing output</li>
<li>"This should work" without running actual tests</li>
<li>Saying there are 130 working tables (there are only ~62)</li>
</ul>
<h3>Testing Checklist</h3>
<p>After EVERY change:
<pre><code><h1>1. Clear output</h1>
rm -rf data/output/<em>.csv</p>
<h1>2. Run ETL</h1>
python run_etl.py
<h1>3. Count tables (should be ~62 from scratch)</h1>
ls data/output/</em>.csv </td> wc -l
<h1>4. Run tests</h1>
python -m pytest tests/test_etl.py -v
<h1>5. If you need all 59 tables</h1>
cp data/output_backup_v13.02/<em>.csv data/output/</code></pre>
<hr>
<h2>2. Quick Reference</h2>
<h3>Directory Structure</h3>
<pre><code>benchsight_v13.02/
├── run_etl.py                  # ONLY ETL entry point
├── LLM_REQUIREMENTS.md         # Detailed LLM rules
├── MASTER_GUIDE.md             # This file
├── data/
│   ├── raw/
│   │   ├── BLB_TABLES.xlsx     # Source dimension data
│   │   └── games/              # Game tracking (18969, 18977, 18981, 18987)
│   ├── output/                 # Generated CSVs
│   └── output_backup_v13.02/   # Known good 59 tables
├── src/
│   ├── core/                   # Core ETL (base_etl.py, add_all_fkeys.py)
│   ├── advanced/               # Enhancement modules
│   ├── etl/                    # Post-processing
│   ├── qa/                     # Quality assurance
│   └── etl_orchestrator.py     # Orchestration logic
├── tests/                      # 23 tests
├── docs/
│   ├── html/                   # HTML documentation (179 files)
│   │   └── tables/             # Per-table HTML docs
│   ├── reference/              # Technical reference docs
│   └── guides/                 # How-to guides
└── config/                     # Configuration files</code></pre>
<h3>Key Commands</h3>
<pre><code><h1>Run ETL (creates ~59 tables)</h1>
python run_etl.py
<h1>Restore all 59 tables</h1>
cp data/output_backup_v13.02/</em>.csv data/output/
<h1>Run tests</h1>
python -m pytest tests/test_etl.py -v
<h1>Count tables</h1>
ls data/output/<em>.csv <td> wc -l</code></pre>
<hr>
<h2>3. ETL Workflow</h2>
<h3>Data Flow Diagram</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                        DATA SOURCES                              │
├─────────────────────────────────────────────────────────────────┤
│  BLB_TABLES.xlsx          Game Tracking Files                   │
│  (Master Reference)       (18969, 18977, 18981, 18987)          │
└──────────┬───────────────────────────┬──────────────────────────┘
           │                           │
           ▼                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 1: base_etl.main()                      │
│                    src/core/base_etl.py                          │
├─────────────────────────────────────────────────────────────────┤
│  Creates ~53 tables:                                            │
│  • dim_</em> (dimensions from BLB)                                  │
│  • fact_event_players (raw tracking)                          │
│  • fact_shifts (shift data)                                     │
│  • fact_sequences, fact_plays                                   │
│  • Zone tables, event tables                                    │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 2: build_player_stats                   │
│                    ❌ BROKEN - Module Missing                    │
├─────────────────────────────────────────────────────────────────┤
│  Should create: fact_player_game_stats base                     │
│  Status: No source code exists                                  │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 3: add_all_fkeys.main()                 │
│                    src/core/add_all_fkeys.py                     │
├─────────────────────────────────────────────────────────────────┤
│  Creates: fact_shift_players                                    │
│  Adds foreign key relationships to existing tables              │
│  ⚠️ Partially fails without Phase 2                             │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 4: extended_tables                      │
│                    src/advanced/extended_tables.py               │
├─────────────────────────────────────────────────────────────────┤
│  Creates summary/aggregate tables                               │
│  ✅ Working                                                      │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 5: post_etl_processor                   │
│                    src/etl/post_etl_processor.py                 │
├─────────────────────────────────────────────────────────────────┤
│  Creates: fact_events (enhanced from tracking)                  │
│  ✅ Working                                                      │
└──────────────────────────────┬──────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 6-8: Enhancements                       │
│                    event_time_context, v11_enhancements, qa      │
├─────────────────────────────────────────────────────────────────┤
│  Creates: dim_shift_duration, qa_<em> tables                       │
│  ✅ Working                                                      │
└─────────────────────────────────────────────────────────────────┘</code></pre>
<h3>run_etl.py Execution Order</h3>
</td> Phase <td> Module </td> What It Does <td> Status </td>
<td>-------</td>--------<td>--------------</td>--------<td>
</td> 1 <td> <code>base_etl.main()</code> </td> Core table creation <td> ✅ ~53 tables </td>
<td> 2 </td> <code>build_player_stats.main()</code> <td> Player stats base </td> ❌ Missing module <td>
</td> 3 <td> <code>add_all_fkeys.main()</code> </td> FK relationships <td> ⚠️ Partial </td>
<td> 4 </td> <code>extended_tables.create_extended_tables()</code> <td> Summary tables </td> ✅ Working <td>
</td> 5 <td> <code>post_etl_processor.main()</code> </td> Enhanced events <td> ✅ Working </td>
<td> 6 </td> <code>event_time_context.enhance_event_tables()</code> <td> Time context </td> ✅ Working <td>
</td> 7 <td> <code>v11_enhancements.run_all_enhancements()</code> </td> dim_shift_duration <td> ✅ Working </td>
<td> 8 </td> <code>build_qa_facts.main()</code> <td> QA tables </td> ⚠️ Partial <td>
<hr>
<h2>4. Module Reference</h2>
<h3>Core Modules (src/core/)</h3>
</td> File <td> Lines </td> Purpose <td> Key Functions </td>
<td>------</td>-------<td>---------</td>---------------<td>
</td> <code>base_etl.py</code> <td> 3200+ </td> Main table creation <td> <code>main()</code>, <code>load_blb_tables()</code>, <code>load_tracking_data()</code>, <code>create_dim_</em>()</code>, <code>create_fact_<em>()</code> </td>
<td> <code>add_all_fkeys.py</code> </td> 900+ <td> FK relationships </td> <code>main()</code>, <code>ForeignKeyManager</code> class <td>
</td> <code>populate_all_fks_v2.py</code> <td> 900+ </td> FK population (alt) <td> Various FK functions </td>
<td> <code>key_utils.py</code> </td> 300+ <td> Key generation </td> <code>generate_pk()</code>, <code>load_keys()</code> <td>
</td> <code>safe_csv.py</code> <td> 150+ </td> Safe CSV I/O <td> <code>safe_read_csv()</code>, <code>safe_write_csv()</code> </td>
<td> <code>safe_sql.py</code> </td> 100+ <td> SQL injection prevention </td> <code>validate_identifier()</code> <td>
</td> <code>combine_tracking.py</code> <td> 200+ </td> Merge tracking data <td> <code>combine_game_tracking()</code> </td>
<h3>Advanced Modules (src/advanced/)</h3>
<td> File </td> Lines <td> Purpose </td> Key Functions <td>
</td>------<td>-------</td>---------<td>---------------</td>
<td> <code>extended_tables.py</code> </td> 400+ <td> Summary tables </td> <code>create_extended_tables()</code> <td>
</td> <code>enhance_all_stats.py</code> <td> 1100+ </td> Stats enhancement <td> <code>main()</code>, <code>aggregate_micro_stats()</code> </td>
<td> <code>create_additional_tables.py</code> </td> 500+ <td> Extra fact tables </td> <code>main()</code> <td>
</td> <code>v11_enhancements.py</code> <td> 200+ </td> v11 additions <td> <code>run_all_enhancements()</code> </td>
<td> <code>event_time_context.py</code> </td> 300+ <td> Time-based context </td> <code>enhance_event_tables()</code> <td>
</td> <code>final_stats_enhancement.py</code> <td> 400+ </td> Final stats calcs <td> <code>enhance_player_stats()</code> </td>
<h3>ETL/Post-Processing (src/etl/)</h3>
<td> File </td> Lines <td> Purpose </td> Key Functions <td>
</td>------<td>-------</td>---------<td>---------------</td>
<td> <code>post_etl_processor.py</code> </td> 600+ <td> Post-processing </td> <code>main()</code>, <code>process_events()</code> <td>
<h3>QA Modules (src/qa/)</h3>
</td> File <td> Lines </td> Purpose <td> Key Functions </td>
<td>------</td>-------<td>---------</td>---------------<td>
</td> <code>build_qa_facts.py</code> <td> 450+ </td> QA tables <td> <code>main()</code>, <code>create_qa_goal_accuracy()</code> </td>
<td> <code>validate_h2h_wowy.py</code> </td> 200+ <td> H2H/WOWY validation </td> <code>validate_h2h()</code>, <code>validate_wowy()</code> <td>
<h3>Key File → Table Mapping</h3>
</td> Need to modify... <td> Look in... </td>
<td>-------------------</td>------------<td>
</td> Core dimensions (dim_player, dim_team) <td> <code>src/core/base_etl.py</code> (BLB load section) </td>
<td> Event dimensions (dim_event_type) </td> <code>src/core/base_etl.py</code> lines 1000-1400 <td>
</td> fact_events <td> <code>src/etl/post_etl_processor.py</code> line 360 </td>
<td> fact_event_players </td> <code>src/core/base_etl.py</code> lines 541-737 <td>
</td> fact_shifts <td> <code>src/core/base_etl.py</code> line 883 </td>
<td> fact_shift_players </td> <code>src/core/add_all_fkeys.py</code> line 144 <td>
</td> fact_player_game_stats <td> <strong>BROKEN</strong> - no source </td>
<td> H2H/WOWY enhancements </td> <code>src/advanced/enhance_all_stats.py</code> <td>
</td> Shift quality tables <td> <code>src/advanced/create_additional_tables.py</code> </td>
<td> QA tables </td> <code>src/qa/build_qa_facts.py</code> <td>
<hr>
<h2>5. Working Tables (~62)</h2>
<p>These tables ARE created when you run <code>python run_etl.py</code> from scratch:</p>
<h3>Dimensions Created by base_etl.py</h3>
</td> Table <td> Line </td> Columns <td>
</td>-------<td>------</td>---------<td>
</td> dim_player_role <td> 977 </td> player_role_id, role_code, role_name <td>
</td> dim_position <td> 989 </td> position_id, position_code, position_name <td>
</td> dim_zone <td> 998 </td> zone_id, zone_code, zone_name <td>
</td> dim_period <td> 1009 </td> period_id, period_number, period_name <td>
</td> dim_venue <td> 1017 </td> venue_id, venue_code, venue_name <td>
</td> dim_event_type <td> 1033 </td> event_type_id, event_type_code, event_type_name <td>
</td> dim_event_detail <td> 1052 </td> event_detail_id, event_detail_code, event_detail_name <td>
</td> dim_success <td> 1064 </td> success_id, success_code, success_name <td>
</td> dim_shot_type <td> 1077 </td> shot_type_id, shot_type_code, shot_type_name <td>
</td> dim_pass_type <td> 1090 </td> pass_type_id, pass_type_code, pass_type_name <td>
</td> dim_event_detail_2 <td> 1138 </td> event_detail_2_id, detail_code, detail_name <td>
</td> dim_zone_entry_type <td> 1162 </td> zone_entry_type_id, entry_type_code, entry_type_name <td>
</td> dim_zone_exit_type <td> 1182 </td> zone_exit_type_id, exit_type_code, exit_type_name <td>
</td> dim_stoppage_type <td> 1203 </td> stoppage_type_id, stoppage_code, stoppage_name <td>
</td> dim_giveaway_type <td> 1224 </td> giveaway_type_id, giveaway_code, giveaway_name <td>
</td> dim_takeaway_type <td> 1246 </td> takeaway_type_id, takeaway_code, takeaway_name <td>
</td> dim_play_detail <td> 1322 </td> play_detail_id, detail_code, detail_name <td>
</td> dim_play_detail_2 <td> 1361 </td> play_detail_2_id, detail_code, detail_name <td>
</td> dim_danger_level <td> 2619 </td> danger_level_id, level_code, level_name <td>
</td> dim_shift_stop_type <td> 3033 </td> shift_stop_type_id, stop_code, stop_name <td>
</td> dim_situation <td> 3045 </td> situation_id, situation_code, situation_name <td>
<h3>Facts Created by base_etl.py</h3>
</td> Table <td> Line </td> Key Columns <td>
</td>-------<td>------</td>-------------<td>
</td> fact_tracking <td> 860 </td> tracking_key, game_id, period, event_type, etc. <td>
</td> fact_shifts <td> 883 </td> shift_key, game_id, player_id, period, duration <td>
</td> fact_event_players <td> 541-737 </td> All raw tracking columns <td>
</td> fact_sequences <td> 2360 </td> sequence_key, game_id, events_in_sequence <td>
</td> fact_plays <td> 2465 </td> play_key, game_id, play_type <td>
</td> fact_rushes <td> 2626 </td> rush_key, game_id, rush_type <td>
</td> fact_breakouts <td> 2648 </td> breakout_key, game_id, breakout_type <td>
</td> fact_zone_entries <td> 2655 </td> entry_key, game_id, entry_type <td>
</td> fact_zone_exits <td> 2662 </td> exit_key, game_id, exit_type <td>
</td> fact_scoring_chances_detailed <td> 2667 </td> chance_key, game_id, danger_level <td>
</td> fact_high_danger_chances <td> 2673 </td> hd_chance_key, game_id, is_goal <td>
</td> fact_saves <td> 2679 </td> save_key, game_id, goalie_id <td>
</td> fact_turnovers_detailed <td> 2685 </td> turnover_key, game_id, turnover_type <td>
</td> fact_faceoffs <td> 2692 </td> faceoff_key, game_id, winner_id <td>
</td> fact_penalties <td> 2698 </td> penalty_key, game_id, player_id <td>
</td> fact_gameroster <td> 3150 </td> roster_key, game_id, player_id <td>
</td> fact_cycle_events <td> 2025 </td> cycle_key, game_id, cycle_type <td>
<h3>Tables Created by Other Modules</h3>
</td> Table <td> Module </td> File:Line <td>
</td>-------<td>--------</td>-----------<td>
</td> fact_events <td> post_etl_processor </td> post_etl_processor.py:360 <td>
</td> fact_shift_players <td> add_all_fkeys </td> add_all_fkeys.py:144 <td>
</td> dim_shift_duration <td> v11_enhancements </td> v11_enhancements.py:70 <td>
</td> fact_game_status <td> build_qa_facts </td> build_qa_facts.py:213 <td>
</td> fact_player_game_position <td> build_qa_facts </td> build_qa_facts.py:432 <td>
<hr>
<h2>6. Broken Tables (~68)</h2>
<p>These tables exist in <code>data/output_backup_v13.02/</code> but have <strong>NO SOURCE CODE</strong> that creates them. They were created manually during previous sessions and never integrated.</p>
<h3>Broken Dimensions (21)</h3>
</td> Table <td> Columns </td> Rows <td>
</td>-------<td>---------</td>------<td>
</td> dim_assist_type <td> assist_type_id, assist_type_code, assist_type_name </td> 4 <td>
</td> dim_comparison_type <td> comparison_type_id, comparison_type_code, comparison_type_name, description, analysis_scope </td> 7 <td>
</td> dim_competition_tier <td> competition_tier_id, tier_name, min_rating, max_rating </td> 5 <td>
</td> dim_composite_rating <td> rating_id, rating_code, rating_name, description, scale_min, scale_max </td> 9 <td>
</td> dim_danger_zone <td> danger_zone_id, danger_zone_code, danger_zone_name, xg_base, description </td> 5 <td>
</td> dim_game_state <td> game_state_id, state_code, state_name </td> 4 <td>
</td> dim_league <td> league_id, league_code, league_name </td> 2 <td>
</td> dim_micro_stat <td> micro_stat_id, stat_code, stat_name, category </td> 23 <td>
</td> dim_net_location <td> net_location_id, net_location_code, net_location_name, x_pct, y_pct </td> 11 <td>
</td> dim_pass_outcome <td> pass_outcome_id, pass_outcome_code, pass_outcome_name, is_successful </td> 5 <td>
</td> dim_player <td> player_id, player_name, first_name, last_name, birth_date, etc. </td> ~200 <td>
</td> dim_playerurlref <td> player_id, url_ref </td> ~200 <td>
</td> dim_randomnames <td> random_name_id, name </td> 100 <td>
</td> dim_rating <td> rating_id, rating_value, rating_name </td> 6 <td>
</td> dim_rating_matchup <td> matchup_id, matchup_name, min_diff, max_diff </td> 6 <td>
</td> dim_rink_zone <td> rink_zone_id, zone_code, zone_name, granularity, x_min, x_max, y_min, y_max </td> 268 <td>
</td> dim_save_outcome <td> save_outcome_id, save_outcome_code, save_outcome_name, causes_stoppage </td> 4 <td>
</td> dim_schedule <td> schedule_id, game_id, date, home_team, away_team, home_score, away_score </td> ~50 <td>
</td> dim_season <td> season_id, season_name, start_date, end_date </td> 2 <td>
</td> dim_shift_quality_tier <td> tier_id, tier_name, min_score, max_score </td> 5 <td>
</td> dim_shift_slot <td> slot_id, slot_code, slot_name </td> 8 <td>
</td> dim_shot_outcome <td> shot_outcome_id, shot_outcome_code, shot_outcome_name, is_goal, is_save </td> 6 <td>
</td> dim_stat <td> stat_id, stat_code, stat_name, category, description, formula </td> 84 <td>
</td> dim_stat_category <td> stat_category_id, category_code, category_name, description </td> 14 <td>
</td> dim_stat_type <td> stat_id, stat_name, stat_category, stat_level, computable_now </td> 58 <td>
</td> dim_strength <td> strength_id, strength_code, strength_name, situation_type, xg_multiplier </td> 19 <td>
</td> dim_team <td> team_id, team_name, team_code, arena </td> ~10 <td>
</td> dim_terminology_mapping <td> dimension, old_value, new_value, match_type </td> 85 <td>
</td> dim_time_bucket <td> time_bucket_id, bucket_name, start_seconds, end_seconds </td> 10 <td>
</td> dim_turnover_quality <td> turnover_quality_id, turnover_quality_code, turnover_quality_name </td> 4 <td>
</td> dim_turnover_type <td> turnover_type_id, turnover_type_code, turnover_type_name, category </td> 22 <td>
</td> dim_zone_outcome <td> zone_outcome_id, zone_outcome_code, zone_outcome_name, is_controlled </td> 7 <td>
<h3>Broken Facts (43)</h3>
</td> Table <td> Key Columns </td> Rows <td>
</td>-------<td>-------------</td>------<td>
</td> fact_draft <td> draft_key, player_id, draft_round, draft_position </td> ~50 <td>
</td> fact_event_chains <td> chain_id, game_id, entry_event_key, shot_event_key, events_to_shot </td> 228 <td>
</td> fact_goalie_game_stats <td> goalie_game_key, game_id, player_id, saves, goals_against, save_pct </td> 9 <td>
</td> fact_h2h <td> game_id, player_1_id, player_2_id, toi_together, cf_pct </td> 685 <td>
</td> fact_head_to_head <td> game_id, player_1_id, player_2_id, shifts_against, toi_against_seconds </td> 573 <td>
</td> fact_leadership <td> leadership_key, player_id, leadership_type </td> ~50 <td>
</td> fact_league_leaders_snapshot <td> game_id, player_id, gp, goals, assists, pts </td> 14474 <td>
</td> fact_line_combos <td> line_combo_key, game_id, forward_combo, defense_combo, toi_together </td> 333 <td>
</td> fact_linked_events <td> linked_event_key, game_id, primary_event_index, event_count </td> 474 <td>
</td> fact_matchup_performance <td> game_id, player_id, matchup_id, toi_seconds, rating_advantage </td> 266 <td>
</td> fact_matchup_summary <td> game_id, player_1_id, player_2_id, cf_pct_together, synergy_score </td> 685 <td>
</td> fact_period_momentum <td> momentum_key, game_id, period, events_count, goals, shots </td> 13 <td>
</td> fact_player_boxscore_all <td> game_id, player_id, g, a, pts, pim </td> 14474 <td>
</td> fact_player_career_stats <td> player_career_key, player_id, games_played, career_goals </td> 69 <td>
</td> fact_player_event_chains <td> event_chain_key, game_id, event_key, event_type, period </td> 5118 <td>
</td> fact_player_game_stats <td> player_game_id, game_id, player_id, goals, assists, shots (300+ cols) </td> 108 <td>
</td> fact_player_micro_stats <td> micro_stat_key, player_game_key, micro_stat, count </td> 213 <td>
</td> fact_player_pair_stats <td> game_id, player_1_id, player_2_id, shifts_together </td> 476 <td>
</td> fact_player_period_stats <td> player_period_key, game_id, player_id, period, shots, goals </td> 322 <td>
</td> fact_player_position_splits <td> position_split_key, position, player_count, avg_goals </td> 4 <td>
</td> fact_player_qoc_summary <td> game_id, player_id, toi_seconds, player_rating, qoc </td> 106 <td>
</td> fact_player_season_stats <td> player_season_key, player_id, games_played, goals, assists (90+ cols) </td> 69 <td>
</td> fact_player_stats_by_competition_tier <td> game_id, player_id, competition_tier_id, toi_seconds </td> 241 <td>
</td> fact_player_stats_long <td> player_stat_key, player_game_key, stat_name, stat_value </td> 13885 <td>
</td> fact_player_trends <td> player_trend_key, player_id, game_number, cumulative_points </td> 108 <td>
</td> fact_player_xy_long <td> player_xy_key, game_id, event_index, player_id, x, y </td> 1 <td>
</td> fact_player_xy_wide <td> player_xy_key, game_id, player_id, x_1, y_1, x_2, y_2... </td> 1 <td>
</td> fact_playergames <td> ID, Date, Team, Player, G, A, GA, PIM </td> 3011 <td>
</td> fact_possession_time <td> possession_key, game_id, player_id, zone_entries </td> 108 <td>
</td> fact_puck_xy_long <td> puck_xy_key, game_id, event_index, x, y, z </td> 1 <td>
</td> fact_puck_xy_wide <td> puck_xy_key, game_id, x_1, y_1, z_1, x_2, y_2, z_2... </td> 1 <td>
</td> fact_registration <td> registration_key, player_id, team_id, season_id </td> ~200 <td>
</td> fact_rush_events <td> game_id, entry_event_index, shot_event_index, is_rush, is_goal </td> 200 <td>
</td> fact_scoring_chances <td> scoring_chance_key, game_id, event_id, danger_level, is_goal </td> 456 <td>
</td> fact_season_summary <td> season_summary_key, season_id, games_played, total_goals </td> 2 <td>
</td> fact_shift_quality <td> shift_quality_key, game_id, player_id, shift_duration, quality_score </td> 4560 <td>
</td> fact_shift_quality_logical <td> game_id, player_id, logical_shifts, avg_quality_score </td> 106 <td>
</td> fact_shot_danger <td> shot_danger_key, game_id, event_index, danger_zone, xg </td> 436 <td>
</td> fact_shot_xy <td> shot_xy_key, game_id, event_index, shot_x, shot_y, shot_distance </td> 1 <td>
</td> fact_special_teams_summary <td> special_teams_key, team_id, total_corsi_for, total_xg_for </td> 6 <td>
</td> fact_suspicious_stats <td> game_id, player_id, stat_name, stat_value, flag_type </td> 19 <td>
</td> fact_team_game_stats <td> team_game_key, game_id, goals, shots, cf_pct, xg_for </td> 9 <td>
</td> fact_team_season_stats <td> team_season_key, team_id, season_goals, avg_goals_per_game </td> 6 <td>
</td> fact_team_standings_snapshot <td> game_id, team_name, wins, losses, points </td> 1125 <td>
</td> fact_team_zone_time <td> various zone time metrics </td> ~50 <td>
</td> fact_video <td> video_key, game_id, timestamp </td> ~100 <td>
</td> fact_wowy <td> game_id, player_id, cf_with, cf_without, cf_pct_delta </td> ~500 <td>
</td> fact_zone_entry_summary <td> zone entry aggregates </td> ~50 <td>
</td> fact_zone_exit_summary <td> zone exit aggregates </td> ~50 <td>
<h3>Broken Lookup/QA (4)</h3>
</td> Table <td> Purpose </td>
<td>-------</td>---------<td>
</td> lookup_player_game_rating <td> Player ratings per game </td>
<td> qa_data_completeness </td> Data quality metrics <td>
</td> qa_goal_accuracy <td> Goal verification </td>
<td> qa_scorer_comparison </td> Scorer verification <td>
</td> qa_suspicious_stats <td> Outlier detection </td>
<hr>
<h2>7. Table Details & Data Dictionary</h2>
<p>For detailed column definitions and table documentation, see:</p>
<ul>
<li><strong>HTML docs:</strong> <code>docs/html/tables/</code> - One HTML file per table</li>
<li><strong>Data dictionary:</strong> <code>docs/reference/DATA_DICTIONARY.csv</code></li>
<li><strong>Schema diagram:</strong> <code>docs/html/diagrams/schema_diagram.html</code></li>
</ul>
<h3>Goal Counting (CRITICAL)</h3>
<pre><code><h1>CORRECT - Only count actual goals</h1>
goals = events[(events['event_type'] == 'Goal') & 
               (events['event_detail'] == 'Goal_Scored')]
<h1>WRONG - Shot_Goal is the shot that resulted in a goal, NOT the goal itself</h1>
<h1>Do NOT count Shot_Goal as a goal!</h1></code></pre>
<h3>Key Format Standard</h3>
<p>All entity keys use format: <code>{PREFIX}{game_id}{index:05d}</code></p>
<td> Key </td> Prefix <td> Example </td>
<td>-----</td>--------<td>---------</td>
<td> event_id </td> EV <td> EV1896901000 </td>
<td> shift_id </td> SH <td> SH1896900001 </td>
<td> sequence_key </td> SQ <td> SQ1896905001 </td>
<td> play_key </td> PL <td> PL1896906001 </td>
<hr>
<h2>Appendix: Source Code Line References</h2>
<h3>base_etl.py Key Sections</h3>
<td> Lines </td> What It Does <td>
</td>-------<td>--------------</td>
<td> 1-100 </td> Imports, constants <td>
</td> 100-420 <td> Helper functions </td>
<td> 420-540 </td> BLB table loading <td>
</td> 541-737 <td> Tracking data load (fact_event_players) </td>
<td> 738-880 </td> Event processing <td>
</td> 881-940 <td> Shift creation (fact_shifts) </td>
<td> 941-1400 </td> Dimension table creation <td>
</td> 1401-2000 <td> Additional dimension logic </td>
<td> 2001-2600 </td> Fact table creation <td>
</td> 2601-3000 <td> Zone/danger tables </td>
<td> 3001-3200 </td> Final tables and main() <td>
<h3>enhance_all_stats.py Key Lines</h3>
</td> Line <td> Creates/Enhances </td>
<td>------</td>------------------<td>
</td> 1037 <td> fact_player_game_stats enhancement </td>
<td> 1048 </td> fact_h2h enhancement <td>
</td> 1052 <td> fact_wowy enhancement </td>
<td> 1063 </td> fact_goalie_game_stats enhancement <td>
</td> 1076 <td> fact_player_period_stats </td>
<td> 1081 </td> fact_shot_danger <td>
</td> 1086 <td> dim_danger_zone </td>
<td> 1090 </td> dim_composite_rating <td>
<h3>create_additional_tables.py Key Lines</h3>
</td> Line <td> Creates </td>
<td>------</td>---------<td>
</td> 61 <td> fact_player_stats_long </td>
<td> 159 </td> fact_team_game_stats <td>
</td> 224 <td> fact_line_combos </td>
<td> 253 </td> fact_matchup_summary <td>
</td> 299 <td> fact_shift_quality </td>
<td> 331 </td> fact_team_zone_time <td>
</td> 369 <td> fact_scoring_chances </td>
<td> 408 </td> dim_stat_category <td>
</td> 447 <td> dim_micro_stat </td>
<td> 486 </td> fact_player_micro_stats |
<hr>
</em>End of guide. For questions, grep the source code or check docs/html/tables/*

</body>
</html>