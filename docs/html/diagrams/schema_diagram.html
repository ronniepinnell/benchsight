<!DOCTYPE html>
<html>
<head>
    <title>BenchSight Schema Diagram</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a2e; color: #eee; }
        h1, h2 { color: #00d4ff; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; }
        .table-group { background: #16213e; padding: 15px; border-radius: 8px; min-width: 300px; }
        .table-group h3 { color: #00d4ff; margin-top: 0; border-bottom: 1px solid #00d4ff; padding-bottom: 5px; }
        .table { background: #0f3460; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .table-name { font-weight: bold; color: #e94560; }
        .pk { color: #00ff88; }
        .fk { color: #ffaa00; }
        .col { color: #ccc; font-size: 12px; }
        .relationship { background: #1a1a2e; padding: 10px; margin: 5px 0; border-left: 3px solid #00d4ff; }
        .stats { color: #888; font-size: 11px; }
    </style>
</head>
<body>

<!-- ================================================================== -->
<!-- CHANGELOG - MUST BE UPDATED WITH EVERY MODIFICATION -->
<!-- ================================================================== -->
<!--
CHANGELOG:
---------------------------------------------------------------------------
2026-01-06 v8.0.5:
  - CRITICAL FIX: Restored 4 missing src/advanced/ modules:
    * create_additional_tables.py
    * enhance_all_stats.py
    * final_stats_enhancement.py
    * extended_tables.py
  - Created fact_events_player.csv (7,476 rows)
  - Extended tables now run: +15 tables created
  - Table count: 131 (54 dim, 73 fact, 3 QA, 1 other)
  - Added comprehensive code audit documentation
  - Fixed column name mismatches (Type -> event_type)

2026-01-06 v8.0.4:
  - CRITICAL: Recovered 72 missing tables from v7 backup
  - Table count restored from 53 to 130
  - Created 4 new outcome dimension tables
  - Regenerated ERD with all tables
  - Added table integrity tests

2026-01-05 v8.0.0:
  - Major schema expansion: 96 -> 111 tables planned
  - Added 317 player metrics
  - Created comprehensive foreign key relationships
  - Added QA validation tables

RULES FOR UPDATING THIS CHANGELOG:
1. ALWAYS add entry BEFORE making changes
2. Include: date, version, what changed, table counts
3. Never delete old entries
4. Be specific about what was added/changed/removed
---------------------------------------------------------------------------
-->

    <h1>BenchSight Schema Diagram</h1>
    <p>Version 12.03 | 108 Tables | Updated January 7, 2026</p>
    
    <h2>Core Event Tables</h2>
    <div class="container">
        <div class="table-group">
            <h3>fact_events</h3>
            <div class="table">
                <div class="table-name">fact_events</div>
                <div class="stats">5,117 rows | 27 columns</div>
                <div class="pk">PK: event_id (EV format)</div>
                <div class="fk">FK: sequence_key, play_key, shot_chain_key, tracking_event_key, shift_key, linked_event_key</div>
                <div class="fk">FK: period_id, event_type_id, event_detail_id, success_id, event_zone_id, home_team_id, away_team_id</div>
                <div class="col">Grain: One row per EVENT</div>
            </div>
        </div>
        
        <div class="table-group">
            <h3>fact_event_players</h3>
            <div class="table">
                <div class="table-name">fact_event_players</div>
                <div class="stats">11,181 rows | 60 columns</div>
                <div class="pk">Composite: event_id + player_game_number</div>
                <div class="fk">FK: All event keys + 16 FK columns</div>
                <div class="col">Grain: One row per PLAYER per EVENT</div>
            </div>
        </div>
        
        <div class="table-group">
            <h3>fact_tracking</h3>
            <div class="table">
                <div class="table-name">fact_tracking</div>
                <div class="stats">5,117 rows | 22 columns</div>
                <div class="pk">PK: tracking_event_key (TV format)</div>
                <div class="col">Grain: One row per TRACKING POINT</div>
                <div class="col">Purpose: XY coordinates (future)</div>
            </div>
        </div>
    </div>
    
    <h2>Relationships</h2>
    <div class="relationship">
        <strong>fact_events</strong> ← event_id → <strong>fact_event_players</strong>
    </div>
    <div class="relationship">
        <strong>fact_events</strong> ← tracking_event_key → <strong>fact_tracking</strong>
    </div>
    <div class="relationship">
        <strong>fact_event_players</strong> ← tracking_event_key → <strong>fact_tracking</strong>
    </div>
    
    <h2>Key Format Reference</h2>
    <div class="container">
        <div class="table-group">
            <h3>Key Formats</h3>
            <div class="table">
                <div class="col"><span class="pk">EV</span> - Event: EV1896901000</div>
                <div class="col"><span class="pk">SQ</span> - Sequence: SQ1896900003</div>
                <div class="col"><span class="pk">PL</span> - Play: PL1896900305</div>
                <div class="col"><span class="pk">EC</span> - Event Chain: EC18969001000</div>
                <div class="col"><span class="pk">TV</span> - Tracking: TV1896901000</div>
                <div class="col"><span class="pk">LV</span> - Linked: LV1896909001</div>
                <div class="col"><span class="pk">SH</span> - Shift: SH1896900001</div>
            </div>
        </div>
        
        <div class="table-group">
            <h3>Key Fill Rates</h3>
            <div class="table">
                <div class="col">sequence_key: 99.8%</div>
                <div class="col">play_key: 99.8%</div>
                <div class="col">shot_chain_key: 100%</div>
                <div class="col">tracking_event_key: 100%</div>
                <div class="col">linked_event_key: 9.3% (only for simultaneous events)</div>
            </div>
        </div>
    </div>
    
    <h2>Other Fact Tables</h2>
    <div class="container">
        <div class="table-group">
            <h3>Shift Tables</h3>
            <div class="table"><div class="table-name">fact_shifts</div></div>
            <div class="table"><div class="table-name">fact_shifts</div></div>
            <div class="table"><div class="table-name">fact_shift_players</div></div>
        </div>
        <div class="table-group">
            <h3>Chain Tables</h3>
            <div class="table"><div class="table-name">fact_shot_chains</div></div>
            <div class="table"><div class="table-name">fact_player_shot_chains</div></div>
            <div class="table"><div class="table-name">fact_linked_events</div></div>
        </div>
        <div class="table-group">
            <h3>Player Stats</h3>
            <div class="table"><div class="table-name">fact_player_game_stats</div><div class="stats">317 columns</div></div>
            <div class="table"><div class="table-name">fact_playergames</div></div>
            <div class="table"><div class="table-name">fact_gameroster</div></div>
        </div>
    </div>
</body>
</html>
