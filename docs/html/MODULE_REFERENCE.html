<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Reference - BenchSight v16.08</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: #f8f9fa; color: #333; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #1a1a2e 0%, #4a4e69 100%); color: white; padding: 20px 40px; }
        .header h1 { margin: 0; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .header .version { background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 12px; font-size: 12px; }
        .nav { background: #4a4e69; padding: 0 20px; display: flex; flex-wrap: wrap; gap: 0; }
        .nav a { color: white; text-decoration: none; padding: 10px 14px; font-size: 13px; font-weight: 500; white-space: nowrap; }
        .nav a:hover { background: rgba(255,255,255,0.1); }
        .nav a.active { background: rgba(255,255,255,0.2); }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px; }
        h1, h2, h3 { color: #1a1a2e; }
        h2 { border-bottom: 2px solid #4a4e69; padding-bottom: 8px; margin-top: 35px; }
        h3 { color: #4a4e69; margin-top: 25px; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #4a4e69; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        code { background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-family: 'Consolas', monospace; font-size: 0.9em; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 13px; }
        pre code { background: transparent; color: inherit; }
        a { color: #4a4e69; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.1); margin: 15px 0; }
        .card h3 { margin-top: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .alert { padding: 12px 18px; border-radius: 6px; margin: 15px 0; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffc107; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #28a745; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .badge-green { background: #28a745; color: white; }
        .badge-blue { background: #007bff; color: white; }
        .badge-yellow { background: #ffc107; color: #333; }
        .badge-red { background: #dc3545; color: white; }
        .badge-gray { background: #6c757d; color: white; }
        .mermaid { background: white; padding: 20px; border-radius: 8px; overflow-x: auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        .stat-card .number { font-size: 36px; font-weight: bold; color: #4a4e69; }
        .stat-card .label { color: #888; font-size: 13px; margin-top: 5px; }
        footer { text-align: center; padding: 25px; color: #888; font-size: 11px; border-top: 1px solid #ddd; margin-top: 40px; }
        ul { padding-left: 20px; }
        li { margin: 5px 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true, theme:'default'});</script>
</head>
<body>
    <div class="header">
        <h1>üèí BenchSight <span class="version">v16.08</span></h1>
    </div>
    
    <nav class="nav">
        <a href="index.html" >üè† Home</a>
        <a href="tables.html" >üìä Tables (59)</a>
        <a href="diagrams/ERD_VIEWER.html" >üóÇÔ∏è ERD</a>
        <a href="pipeline_visualization.html" >‚ö° Pipeline</a>
        <a href="MODULE_REFERENCE.html" class='active'>üì¶ Modules</a>
        <a href="KEY_FORMATS.html" >üîë Keys</a>
        <a href="DATA_DICTIONARY.html" >üìñ Dictionary</a>
        <a href="VERIFICATION_STATUS.html" >‚úÖ QA</a>
        <a href="LLM_HANDOFF.html" >ü§ñ LLM Guide</a>
        <a href="HONEST_ASSESSMENT.html" >üíØ Assessment</a>
        <a href="CHANGELOG.html" >üìù Changelog</a>
    </nav>

    <div class="container">

        <h1>üì¶ Module Reference</h1>
        <p><strong>Last Updated:</strong> January 8, 2026 | <strong>Version:</strong> 12.03</p>
        
        <h2>Architecture Overview</h2>
        <div class="mermaid">
graph TB
    subgraph Entry["Entry Points"]
        A[run_etl.py] --> B[ETLOrchestrator]
        CLI[CLI] --> B
    end
    
    subgraph Core["Core ETL"]
        B --> C[base_etl.py]
        C --> D[key_utils.py]
        C --> E[add_all_fkeys.py]
        C --> F[safe_csv.py]
    end
    
    subgraph Transform["Transformation"]
        C --> G[transformation/]
        G --> G1[data_transformer.py]
        G --> G2[standardize_play_details.py]
    end
    
    subgraph Advanced["Advanced Analytics"]
        C --> H[advanced/]
        H --> H1[extended_tables.py]
        H --> H2[create_additional_tables.py]
        H --> H3[event_time_context.py]
    end
    
    subgraph Data["Data Sources"]
        I[BLB_Tables.xlsx] --> C
        J[tracking.xlsx] --> C
        K[roster.json] --> C
    end
    
    subgraph Out["Output"]
        C --> L[data/output/*.csv]
        H --> L
    end
        </div>
        
        <h2>Module Directory</h2>
        
        <h3>src/ - Source Code Root</h3>
        <table>
            <tr><th>Module</th><th>Purpose</th><th>Key Functions</th></tr>
            <tr>
                <td><code>etl_orchestrator.py</code></td>
                <td>Main entry point, coordinates all ETL</td>
                <td>run_full(), run_incremental(), run_single_game()</td>
            </tr>
            <tr>
                <td><code>run_etl.py</code></td>
                <td>Simple script wrapper</td>
                <td>main()</td>
            </tr>
        </table>
        
        <h3>src/core/ - Core ETL Engine</h3>
        <table>
            <tr><th>Module</th><th>Lines</th><th>Purpose</th><th>Key Functions</th></tr>
            <tr>
                <td><code>base_etl.py</code></td>
                <td>~800</td>
                <td>Main ETL logic, creates all base tables</td>
                <td>load_blb_data(), load_tracking_data(), create_derived_tables()</td>
            </tr>
            <tr>
                <td><code>key_utils.py</code></td>
                <td>~400</td>
                <td>Key generation, normalization</td>
                <td>format_key(), generate_event_id(), add_player_id_columns()</td>
            </tr>
            <tr>
                <td><code>add_all_fkeys.py</code></td>
                <td>~300</td>
                <td>FK column population</td>
                <td>add_all_fkeys(), build_lookup_tables()</td>
            </tr>
            <tr>
                <td><code>safe_csv.py</code></td>
                <td>~150</td>
                <td>Safe CSV I/O with type handling</td>
                <td>safe_read_csv(), safe_to_csv()</td>
            </tr>
            <tr>
                <td><code>safe_sql.py</code></td>
                <td>~100</td>
                <td>SQL injection prevention</td>
                <td>safe_game_id(), safe_table_name()</td>
            </tr>
        </table>
        
        <h3>src/advanced/ - Extended Analytics</h3>
        <table>
            <tr><th>Module</th><th>Purpose</th><th>Tables Created</th></tr>
            <tr>
                <td><code>extended_tables.py</code></td>
                <td>15+ extended tables</td>
                <td>fact_h2h, fact_wowy, fact_line_combos</td>
            </tr>
            <tr>
                <td><code>create_additional_tables.py</code></td>
                <td>Supplementary tables</td>
                <td>fact_player_period_stats, fact_team_zone_time</td>
            </tr>
            <tr>
                <td><code>event_time_context.py</code></td>
                <td>Time-based context</td>
                <td>Adds TOI columns, time_to_next_* columns</td>
            </tr>
            <tr>
                <td><code>enhance_all_stats.py</code></td>
                <td>Stat enhancements</td>
                <td>Enhanced fact_player_game_stats</td>
            </tr>
        </table>
        
        <h3>src/transformation/ - Data Transformation</h3>
        <table>
            <tr><th>Module</th><th>Purpose</th></tr>
            <tr><td><code>data_transformer.py</code></td><td>Core event/shift transformation</td></tr>
            <tr><td><code>standardize_play_details.py</code></td><td>Normalize play_detail values</td></tr>
            <tr><td><code>transform_pipeline.py</code></td><td>Orchestrate transformations</td></tr>
        </table>
        
        <h3>Other Directories</h3>
        <table>
            <tr><th>Directory</th><th>Purpose</th></tr>
            <tr><td><code>src/ingestion/</code></td><td>Data loading (BLB, games, XY)</td></tr>
            <tr><td><code>src/norad/</code></td><td>noradhockey.com integration</td></tr>
            <tr><td><code>src/qa/</code></td><td>QA table generation</td></tr>
            <tr><td><code>src/stats/</code></td><td>Statistics calculation</td></tr>
            <tr><td><code>src/supabase/</code></td><td>Cloud deployment</td></tr>
            <tr><td><code>src/xy/</code></td><td>XY coordinate processing</td></tr>
        </table>
        
        <h2>ETL Processing Order</h2>
        <div class="mermaid">
graph LR
    A[1. base_etl.py<br/>53 base tables] --> B[2. post_etl_processor.py<br/>Enhancements]
    B --> C[3. extended_tables.py<br/>15+ tables]
    C --> D[4. create_additional_tables.py<br/>More tables]
    D --> E[5. event_time_context.py<br/>TOI columns]
        </div>
        
        <h2>Critical Rules</h2>
        <div class="alert alert-danger">
            <strong>‚ö†Ô∏è NEVER DELETE</strong> these modules in <code>src/advanced/</code>:
            <ul>
                <li><code>create_additional_tables.py</code></li>
                <li><code>enhance_all_stats.py</code></li>
                <li><code>final_stats_enhancement.py</code></li>
                <li><code>extended_tables.py</code></li>
            </ul>
        </div>
        
        <div class="alert alert-warning">
            <strong>Goal Counting:</strong> Goals via <code>event_type='Goal' AND event_detail='Goal_Scored'</code> only.
            <br><code>Shot_Goal</code> is the SHOT, not the goal!
        </div>

    </div>
    <footer>
        BenchSight v16.08 | NORAD Hockey Analytics | Generated: January 8, 2026<br>
        <a href="index.html">Home</a> ¬∑ <a href="tables.html">Tables</a> ¬∑ <a href="LLM_HANDOFF.html">LLM Guide</a>
    </footer>
</body>
</html>
