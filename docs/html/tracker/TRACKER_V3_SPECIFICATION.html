<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BenchSight Tracker v3 - Complete Technical Specification - BenchSight</title>
<style>
:root {
  --bg: #0d1117;
  --surface: #161b22;
  --border: #30363d;
  --text: #c9d1d9;
  --muted: #8b949e;
  --accent: #58a6ff;
  --accent2: #3fb950;
  --warn: #d29922;
  --danger: #f85149;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  font-size: 14px;
}
.container { max-width: 900px; margin: 0 auto; padding: 20px 40px; }
header {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 15px 0;
}
header .container { display: flex; justify-content: space-between; align-items: center; }
header h1 {
  font-size: 18px;
  color: var(--accent);
}
header nav a {
  color: var(--muted);
  text-decoration: none;
  margin-left: 15px;
  font-size: 13px;
}
header nav a:hover { color: var(--accent); }
main { padding: 30px 0; }
h1 { font-size: 28px; color: var(--accent); margin-bottom: 20px; }
h2 { font-size: 22px; color: var(--text); margin: 30px 0 15px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
h3 { font-size: 18px; color: var(--accent2); margin: 25px 0 12px; }
h4 { font-size: 15px; color: var(--text); margin: 20px 0 10px; }
p { margin: 12px 0; color: var(--text); }
ul, ol { margin: 12px 0 12px 25px; }
li { margin: 6px 0; }
code {
  font-family: 'SF Mono', Consolas, monospace;
  background: var(--surface);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 13px;
  border: 1px solid var(--border);
}
pre {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 15px;
  overflow-x: auto;
  margin: 15px 0;
  font-size: 12px;
}
pre code { background: none; border: none; padding: 0; }
table {
  width: 100%;
  border-collapse: collapse;
  margin: 15px 0;
  font-size: 13px;
}
th, td {
  border: 1px solid var(--border);
  padding: 10px 12px;
  text-align: left;
}
th { background: var(--surface); color: var(--accent); }
tr:nth-child(even) { background: rgba(255,255,255,0.02); }
blockquote {
  border-left: 3px solid var(--accent);
  padding: 10px 15px;
  margin: 15px 0;
  background: rgba(88,166,255,0.1);
  border-radius: 0 6px 6px 0;
}
hr { border: none; border-top: 1px solid var(--border); margin: 30px 0; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }
strong { color: var(--text); }
.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
}
.badge-done { background: var(--accent2); color: #000; }
.badge-pending { background: var(--warn); color: #000; }
footer {
  border-top: 1px solid var(--border);
  padding: 20px 0;
  margin-top: 40px;
  text-align: center;
  color: var(--muted);
  font-size: 12px;
}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>⚡ BenchSight</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="tracker/index.html">Tracker</a>
      <a href="tables.html">Tables</a>
      <a href="diagrams/ERD_VIEWER.html">ERD</a>
    </nav>
  </div>
</header>
<main>
<div class="container">
<h1>BenchSight Tracker v3 - Complete Technical Specification</h1>

<strong>Version:</strong> 3.0  
<strong>Date:</strong> 2026-01-07  
<strong>Status:</strong> Specification for Implementation
<p>---</p>

<h2>CRITICAL: ETL Format Requirements</h2>

<h3>Events Tab Format (LONG - One Row Per Player Per Event)</h3>
<p>The ETL expects events in <strong>LONG FORMAT</strong> - meaning each event generates MULTIPLE rows, one for each player involved.</p>

<pre><code class="language-">Event #1002 with 3 players generates 3 rows:
Row 1: event_index=1002, player_role=event_team_player_1, player_game_number=42, ...
Row 2: event_index=1002, player_role=event_team_player_2, player_game_number=14, ...
Row 3: event_index=1002, player_role=opp_team_player_1, player_game_number=30, ...
</code></pre>

<h3>Required Events Tab Columns (73 columns)</h3>

<pre><code class="language-"># Index columns (tracking)
event_index_flag_           # 1 if this is event_player_1 row
sequence_index_flag_        # Sequence grouping
play_index_flag_            # Play grouping  
linked_event_index_flag_    # Linked event grouping

<h1>Time columns</h1>
event_start_min_            # Start minute (countdown from 18/20)
event_start_sec_            # Start second
event_end_min_              # End minute
event_end_sec_              # End second

<h1>Player columns (per row)</h1>
player_game_number_         # Jersey number
player_game_number          # Jersey number (duplicate)
player_num_dup_             # Duplicate check
role_abrev_binary_          # 'e' or 'o' (event/opp team)
role_abrev                  # 'e' or 'o'

<h1>Zone columns</h1>
event_team_zone_            # o/n/d from event team perspective
event_team_zone2_           # Alternate zone
event_team_zone             # Final zone value
home_team_zone_             # Zone from home perspective
away_team_zone_             # Zone from away perspective
home_team_zone              # Final home zone
away_team_zone              # Final away zone

<h1>Event columns</h1>
event_type_                 # Event type (Shot, Pass, etc.)
event_detail_               # Detail 1 (Shot_OnNetSaved, etc.)
event_detail_2_             # Detail 2 (Shot-Wrist, etc.)
event_successful_           # 's' or 'u' (successful/unsuccessful)
Type                        # Event type (copy)
event_detail                # Detail 1 (copy)
event_detail_2              # Detail 2 (copy)
event_successful            # s/u (copy)

<h1>Play details (PER PLAYER - different for each row)</h1>
play_detail1_               # Offensive/defensive play type
play_detail2_               # Play detail 2
play_detail_successful_     # s/u for THIS PLAYER's play
play_detail1                # Copy
play_detail_2               # Copy
play_detail_successful      # Copy
pressured_pressurer_        # If player was pressured/pressurer
pressured_pressurer         # Copy

<h1>Index columns (final)</h1>
event_index_                # Event index (internal)
linked_event_index_         # Linked event
sequence_index_             # Sequence index
play_index_                 # Play index
event_index                 # Event index (final) - FORMAT: {game_id}{4-digit-seq}
linked_event_index          # Linked event index
tracking_event_index        # Original tracking index
sequence_index              # Sequence index (final)
play_index                  # Play index (final)
zone_change_index           # Zone change tracking

<h1>Team columns</h1>
team_                       # Team name
team_venue_                 # Home/Away
team_venue_abv_             # h/a
team_venue                  # Home/Away (final)
team_venue_abv              # h/a (final)
side_of_puck                # Offensive/Defensive/Neutral

<h1>Game columns</h1>
game_id                     # Game ID
home_team                   # Home team name
away_team                   # Away team name
shift_index                 # Which shift this event belongs to

<h1>Time calculations (ETL computes these)</h1>
duration                    # Event duration in seconds
time_start_total_seconds    # Total seconds from period start
time_end_total_seconds      # Total seconds from period start
running_intermission_duration  # Cumulative intermission time
period_start_total_running_seconds  # Video time at period start
running_video_time          # Running video timestamp
event_running_start         # Video time at event start
event_running_end           # Video time at event end

<h1>Period</h1>
period                      # 1, 2, 3, OT

<h1>Player identification</h1>
player_role                 # event_team_player_1, event_team_player_2, opp_team_player_1, etc.
role_number                 # 1, 2, 3, 4
player_id                   # Player ID (P######)
player_team                 # Player's team name
</code></pre>

<h3>Shifts Tab Format (WIDE - One Row Per Shift)</h3>

<pre><code class="language-"># Core columns
shift_index                 # Shift number
Period                      # 1, 2, 3, OT
shift_start_min             # Start minute
shift_start_sec             # Start second
shift_end_min               # End minute  
shift_end_sec               # End second
shift_start_type            # GameStart, PeriodStart, OtherFaceoff, etc.
shift_stop_type             # Period End, Stoppage, etc.

<h1>Home players (jersey numbers)</h1>
home_forward_1
home_forward_2
home_forward_3
home_defense_1
home_defense_2
home_xtra
home_goalie

<h1>Away players (jersey numbers)</h1>
away_forward_1
away_forward_2
away_forward_3
away_defense_1
away_defense_2
away_xtra
away_goalie

<h1>Stoppage tracking</h1>
stoppage_time               # Time between shifts

<h1>Zone tracking (per shift)</h1>
home_ozone_start            # 1 if shift started in home offensive zone
home_ozone_end              # 1 if shift ended in home offensive zone
home_dzone_start
home_dzone_end
home_nzone_start
home_nzone_end

<h1>Game info</h1>
game_id
home_team
away_team

<h1>Calculated fields (ETL computes)</h1>
shift_start_total_seconds
shift_end_total_seconds
shift_duration
home_team_strength          # 5, 4, 3
away_team_strength
home_team_en                # Empty net flag
away_team_en
home_team_pk                # Penalty kill flag
home_team_pp                # Power play flag
away_team_pp
away_team_pk
situation                   # "Full Strength", "Power Play", etc.
strength                    # "5v5", "5v4", etc.
home_goals                  # Score at shift start
away_goals

<h1>Plus/minus per shift</h1>
home_team_plus
home_team_minus
away_team_plus
away_team_minus

<h1>Video timing</h1>
period_start_total_running_seconds
running_video_time
shift_start_running_time
shift_end_running_time
</code></pre>
<p>---</p>

<h2>XY Data Format</h2>
<p>XY data stored in separate CSV files:</p>
<ul>
<li>Location: <code>data/raw/games/{game_id}/xy/event_locations/{game_id}_{period}.csv</code></li>
</ol>
<p>Columns:</p>
<pre><code class="language-">game_id                     # Game ID
link_event_index            # Event index to link to
Player                      # Jersey number
X, Y                        # Position 1
X2, Y2                      # Position 2
X3, Y3                      # Position 3
X4, Y4                      # Position 4 (up to 10)
...
X10, Y10                    # Position 10
Distance                    # Calculated distance
</code></pre>
<p>Puck positions stored separately or in same file with Player='puck':</p>
<pre><code class="language-">game_id, link_event_index, Player='puck', X, Y, X2, Y2, ... X10, Y10
</code></pre>
<p>---</p>

<h2>Dropdown Options (From Lists Tab)</h2>

<h3>Event Types</h3>
<ul>
<li>Faceoff, Shot, Pass, Goal, Turnover, Zone_Entry_Exit, Penalty, PenaltyShot_Shootout</li>
<li>Stoppage, Hit, Possession, LoosePuck, Save, TeamPossessionChange, Rebound</li>
<li>DeadIce, Play, Timeout, Intermission, Clockstop</li>
</ul>

<h3>Event Details (Cascading by Event Type)</h3>

<strong>Shot:</strong>
<ul>
<li>Detail 1: Shot_OnNetSaved, Shot_Missed, Shot_Blocked, Shot_BlockedSameTeam, Shot_Deflected, Shot_DeflectedOnNetSaved, Shot_Tipped, Shot_TippedOnNetSaved, Shot_OnNetGoal, Shot_OnNetTippedGoal, Shot_OnNetDeflectedGoal, Shot_Goal, Shot_MissedPost</li>
<li>Detail 2: Shot-Wrist, Shot-Slap, Shot-Backhand, Shot-Snap, Shot-WrapAround, Shot-Bat, Shot-Cradle, Shot-Poke, Shot-BetweenLegs, Shot-Dumpin, Shot-OneTime, Shot-Tip, Shot-Deflection, Shot-Other</li>
</ul>

<strong>Pass:</strong>
<ul>
<li>Detail 1: Pass_Completed, Pass_Missed, Pass_Deflected, Pass_Intercepted</li>
<li>Detail 2: Pass-Stretch, Pass-Rim/Wrap, Pass-Backhand, Pass-Forehand, Pass-Bank, Pass-Dump, Pass-Tipped, Pass-Lob, Pass-Drop, Pass-Deflected/TippedShot, Pass-ReceiverMissed, Pass-OneTouch, Pass-SecondTouch, Pass-QuickUp, Pass-GiveAndGo, Pass-Reverse, Pass-Other</li>
</ul>

<strong>Goal:</strong>
<ul>
<li>Detail 1: Goal_Scored, Goal_Shootout, Goal_PenaltyShot</li>
<li>Detail 2: Goal-Wrist, Goal-Slap, Goal-Backhand, Goal-Tip, Goal-Snap, Goal-WrapAround, Goal-Bat, Goal-Cradle, Goal-Poke, Goal-BetweenLegs, Goal-Dumpin, Goal-Deflection, Goal-OneTime, Goal-Other</li>
</ul>

<strong>Turnover:</strong>
<ul>
<li>Detail 1: Turnover_Giveaway, Turnover_Takeaway</li>
<li>Detail 2 (Giveaway): Giveaway-Misplayed, Giveaway-BattleLost, Giveaway-PassIntercepted, Giveaway-PassMissed, Giveaway-PassBlocked, Giveaway-PassReceiverMissed, Giveaway-ShotBlocked, Giveaway-ShotMissed, Giveaway-ZoneClear/Dump, Giveaway-AttemptedZoneClear/Dump, Giveaway-ZoneEntry/ExitMisplay, Giveaway-DumpInZone, Giveaway-Other</li>
<li>Detail 2 (Takeaway): Takeaway-BattleWon, Takeaway-PokeCheck, Takeaway-PassIntercepted, Takeaway-PassBlocked, Takeaway-ShotBlocked, Takeaway-ZoneClear/Dump, Takeaway-AttemptedZoneClear/Dump, Takeaway-Other</li>
</ul>

<strong>Zone_Entry_Exit:</strong>
<ul>
<li>Detail 1: Zone_Entry, Zone_Exit, Zone_Keepin, Zone_Entryfailed, Zone_ExitFailed, Zone_KeepinFailed</li>
<li>Detail 2 (Entry): ZoneEntry-Rush, ZoneEntry-Pass, ZoneEntry-DumpIn, ZoneEntry-Chip, ZoneEntry-FromExitClear, ZoneEntry-PassMiss/Misplay, ZoneEntry-OppTeam, ZoneEntry-Lob, ZoneEntry-RushBreakaway, ZoneEntry-CausedTurnover, ZoneEntry-PenaltyKillClear, ZoneEntry-Shot, ZoneEntry-Other</li>
<li>Detail 2 (Exit): ZoneExit-Rush, ZoneExit-Pass, ZoneExit-Clear, ZoneExit-Chip, ZoneExit-PassMiss/Misplay, ZoneExit-OppTeam, ZoneExit-Lob, ZoneExit-CausedTurnover, ZoneExit-PenaltyKillClear, ZoneExit-Shot, ZoneExit-Other</li>
<li>Detail 2 (Keepin): Zone-KeepIn, Zone-Pinch, Zone-Other</li>
</ul>

<strong>Faceoff:</strong>
<ul>
<li>Detail 1: Faceoff_AfterPenalty, Faceoff_AfterGoal, Faceoff_PeriodStart, Faceoff_AfterStoppage, Faceoff_GameStart</li>
</ol>

<strong>Save:</strong>
<ul>
<li>Detail 1: Save_Rebound, Save_Freeze, Save_Played</li>
<li>Detail 2: Save-Glove, Save-Blocker, Save-LeftPad, Save-RightPad, Save-Stick, Save-Scramble, Save-Butterfly, Save-Chest, Save-Shoulder, Save-Skate, Save-Other</li>
</ul>

<strong>Stoppage:</strong>
<ul>
<li>Detail 1: Stoppage_Period, Stoppage_Play, Stoppage_Other, Stoppage_GameEnd</li>
<li>Detail 2 (Play): Stoppage-Icing, Stoppage-Offsides, Stoppage-ClockProblem, Stoppage-HighStick, Stoppage-HandPass, Stoppage-NetDislodged, Stoppage-Injury, Stoppage-GoalieStoppage, Stoppage-PuckOutofPlay, Stoppage-Penalty, Stoppage-Goal</li>
<li>Detail 2 (Period): Stoppage-StartofShootout, Stoppage-PeriodStart, Stoppage-PeriodEnd</li>
<li>Detail 2 (Other): Stoppage-ObjectsonIce, Stoppage-HomeTimeout, Stoppage-VisitorTimeout, Stoppage-RinkRepair, Stoppage-PlayerEquipment, Stoppage-Challenge, Stoppage-Other</li>
</ul>

<strong>Penalty:</strong>
<ul>
<li>Detail 1: Penalty_Minor, Penalty_Major, Penalty_Offsetting</li>
<li>Detail 2: Penalty-Bench Penalty, Penalty-Boarding, Penalty-Charging, Penalty-CrossChecking, Penalty-DelayofGame, Penalty-Diving, Penalty-Elbowing, Penalty-GoalieInterference, Penalty-HighSticking, Penalty-Holding, Penalty-Interference, Penalty-Fighting, Penalty-Hooking, Penalty-Roughing, Penalty-Slashing, Penalty-Misconduct, Penalty-TooManyMenontheIce, Penalty-Tripping, Penalty-UnsportsmanlikeConduct, Penalty-Other</li>
</ul>

<strong>Possession:</strong>
<ul>
<li>Detail 1: Breakaway, PuckRetrieval, PuckRecovery, Regroup</li>
</ol>

<strong>Rebound:</strong>
<ul>
<li>Detail 1: Rebound_TeamRecovered, Rebound_OppTeamRecovered, Rebound_ShotGenerated, Rebound_FlurryGenerated</li>
</ol>

<strong>LoosePuck:</strong>
<ul>
<li>Detail 1: LoosePuck_Forecheck, LoosePuck_Battle</li>
</ol>

<strong>Play:</strong>
<ul>
<li>Detail 1: Play_Offensive, Play_Defensive</li>
<li>Detail 2 (Offensive): Play-DriveMiddle, Play-DriveWide, Play-DriveCorner, Play-DriveNetMiddle, Play-DriveNetWide, Play-CrashNet, Play-Delay, Play-Deke, Play-Chip, Play-Other, Play-DumpChase, Play-Forecheck, Play-Speed, Play-Dump/RimInZone</li>
<li>Detail 2 (Defensive): Play-PokeCheck, Play-PokeCheckFailed, Play-SeperateFromPuck, Play-Backcheck, Play-FroceWide, Play-Contain, Play-BeatMiddle, Play-BeatWide, Play-BeatDeke, Play-BeatSpeed, Play-BoxOut, Play-AttemptedClear, Play-Other</li>
</ul>

<h3>Shift Start Types</h3>
<ul>
<li>PeriodStart, FaceoffAfterGoal, GameStart, FaceoffAfterPenalty, OtherFaceoff, DeadIce/Stoppage, Intermission, DelayedPenalty</li>
</ol>

<h3>Shift Stop Types  </h3>
<ul>
<li>(Derived from events - linked to stoppage/goal/period end events)</li>
</ol>
<p>---</p>

<h2>Play Details (PER PLAYER)</h2>
<p>Each player in an event can have their own play details:</p>

<h3>Offensive Play Details (play_detail1 when offensive)</h3>
<ul>
<li>Play-DriveMiddle, Play-DriveWide, Play-DriveCorner, Play-DriveNetMiddle, Play-DriveNetWide</li>
<li>Play-CrashNet, Play-Delay, Play-Deke, Play-Chip, Play-DumpChase, Play-Forecheck, Play-Speed</li>
<li>Play-Dump/RimInZone, Play-Other</li>
</ul>

<h3>Defensive Play Details (play_detail1 when defensive)</h3>
<ul>
<li>Play-PokeCheck, Play-PokeCheckFailed, Play-SeperateFromPuck, Play-Backcheck</li>
<li>Play-FroceWide, Play-Contain, Play-BeatMiddle, Play-BeatWide, Play-BeatDeke</li>
<li>Play-BeatSpeed, Play-BoxOut, Play-AttemptedClear, Play-Other</li>
</ul>

<h3>Success/Unsuccessful</h3>
<ul>
<li><code>s</code> = successful</li>
<li><code>u</code> = unsuccessful</li>
</ul>
<p>Applied to:</p>
<ul>
<li><code>event_successful_</code> (overall event)</li>
<li><code>play_detail_successful_</code> (per player's play)</li>
</ul>
<p>---</p>

<h2>Zone Calculation</h2>
<p>Zone is determined by event_player_1's XY position:</p>

<pre><code class="language-">Rink coordinates: x from -100 to +100, y from -42.5 to +42.5
<p>For HOME team (defending left goal, attacking right):</p>
  x &lt; -25  → Zone = 'd' (defensive)
  x &gt; +25  → Zone = 'o' (offensive)
  else     → Zone = 'n' (neutral)
<p>For AWAY team (defending right goal, attacking left):</p>
  x &lt; -25  → Zone = 'o' (offensive)
  x &gt; +25  → Zone = 'd' (defensive)
  else     → Zone = 'n' (neutral)
</code></pre>
<p>---</p>

<h2>Intermission Handling</h2>
<p>Intermissions are special shift entries:</p>
<ul>
<li><code>shift_start_type = 'Intermission'</code></li>
<li>All player slots empty</li>
<li>Duration entered in seconds</li>
<li>Affects <code>running_intermission_duration</code> calculation for video sync</li>
</ul>
<p>---</p>

<h2>Data Flow</h2>

<ol>
<li>1. <strong>User Input (Tracker)</strong></li>
</ol>
   - Events entered in UI-friendly format
   - Players added to event with roles
   - XY positions clicked on rink
   - Play details selected per player

<ol>
<li>2. <strong>Internal Storage (JSON/localStorage)</strong></li>
</ol>
   - Events stored in intermediate format
   - One object per event with nested player array

<ol>
<li>3. <strong>Export (Excel)</strong></li>
</ol>
   - Events expanded to LONG format (one row per player)
   - Shifts exported in WIDE format
   - XY data exported to separate CSV files

<ol>
<li>4. <strong>ETL Processing</strong></li>
</ol>
   - Reads Excel files in expected format
   - Calculates derived fields
   - Loads to database tables
<p>---</p>

<h2>Rink SVG Corrections</h2>
<p>Current issues:</p>
<ol>
<li>1. Goal lines should be at x = ±89 (not at edge)</li>
<li>2. Goal creases are semi-circles in front of goal</li>
<li>3. Goal nets are 6 feet wide (in rink scale: ~6 units)</li>
</ul>
<p>Correct rink proportions (NHL standard, scaled to 200x85):</p>
<ul>
<li>Rink: 200 ft x 85 ft → viewBox: -100 to +100, -42.5 to +42.5</li>
<li>Goal lines: x = ±89</li>
<li>Blue lines: x = ±25</li>
<li>Center line: x = 0</li>
<li>Goal crease: 6 ft radius semicircle at goal line</li>
<li>Faceoff circles: 15 ft radius at (±69, ±22)</li>
<li>Center circle: 15 ft radius at (0, 0)</li>
</ul>
<p>---</p>

<h2>UI Requirements Summary</h2>

<ol>
<li>1. <strong>Time Auto-fill</strong>: New shift/event start = previous end time</li>
<li>2. <strong>Intermission</strong>: Dropdown + duration input</li>
<li>3. <strong>Play Details</strong>: Per-player entry with s/u</li>
<li>4. <strong>Zone Auto-fill</strong>: Based on event_player_1 XY</li>
<li>5. <strong>Full Editing</strong>: All fields editable for events and shifts</li>
<li>6. <strong>Cascading Dropdowns</strong>: event_type → detail_1 → detail_2</li>
<li>7. <strong>XY</strong>: Up to 10 points per player, 10 puck points per event</li>
<li>8. <strong>Long Format Export</strong>: Events expand to one row per player</li>
<li>9. <strong>Scrollable Logs</strong>: Both events and shifts with quick navigation</li>
<li>10. <strong>Dropdown Options</strong>: All from dim tables (or Lists tab)</li>
</ul>

</div>
</main>
<footer>
  <div class="container">
    BenchSight Documentation • v14.01 • January 7, 2026
  </div>
</footer>
</body>
</html>
