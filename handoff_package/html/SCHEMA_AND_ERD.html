<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schema & ERD</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #1a365d; border-bottom: 3px solid #3182ce; padding-bottom: 10px; }
        h2 { color: #2c5282; margin-top: 30px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }
        h3 { color: #2d3748; }
        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #edf2f7;
            font-weight: 600;
        }
        tr:hover { background: #f7fafc; }
        .nav {
            background: #1a365d;
            padding: 15px 20px;
            margin: -40px -40px 30px -40px;
            border-radius: 8px 8px 0 0;
        }
        .nav a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
        }
        .nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html">Home</a>
            <a href="MASTER_INSTRUCTIONS.html">Master Instructions</a>
            <a href="TRACKER_DEV_COMPLETE_GUIDE.html">Tracker Dev</a>
            <a href="DASHBOARD_DEV_COMPLETE_GUIDE.html">Dashboard Dev</a>
            <a href="SCHEMA_AND_ERD.html">Schema</a>
        </nav>
        <h1 id="benchsight-database-schema-erd">BenchSight Database Schema &amp; ERD</h1>
<h2 id="entity-relationship-diagram-text-format">Entity Relationship Diagram (Text Format)</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────────────────────┐
│                           BENCHSIGHT DATA MODEL                                  │
│                              Star Schema Design                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

                              DIMENSION TABLES
    ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐
    │    dim_player    │    │    dim_team      │    │  dim_schedule    │
    ├──────────────────┤    ├──────────────────┤    ├──────────────────┤
    │ PK: player_id    │    │ PK: team_id      │    │ PK: game_id      │
    │    player_name   │    │    team_name     │    │    game_date     │
    │    jersey_number │    │    team_abbrev   │    │ FK: home_team_id │
    │    position      │    │    division      │    │ FK: away_team_id │
    │    shoots        │    │    conference    │    │    home_score    │
    └────────┬─────────┘    └────────┬─────────┘    │    away_score    │
             │                       │              │    venue         │
             │                       │              └────────┬─────────┘
             │                       │                       │
             ▼                       ▼                       ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                              FACT TABLES                                        │
└────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────┐          ┌─────────────────────────┐
│     fact_events         │          │   fact_events_player    │
│     (Wide Format)       │          │    (Long Format)        │
├─────────────────────────┤          ├─────────────────────────┤
│ PK: event_key           │◄────────►│ PK: event_player_key    │
│ FK: game_id             │          │ FK: event_key           │
│ FK: shift_key           │          │ FK: game_id             │
│    event_index          │          │ FK: player_id           │
│    period               │          │    player_role          │
│    event_start_seconds  │          │    event_type           │
│    event_type           │          │    event_detail         │
│    event_detail         │          │    play_detail1         │
│    event_detail_2       │          │    linked_event_index   │
│    event_successful     │          └─────────────────────────┘
│    event_team_player_1  │
│    opp_team_player_1    │
│    linked_event_index   │
│    empty_net_goal       │
└─────────────────────────┘

┌─────────────────────────┐          ┌─────────────────────────┐
│     fact_shifts         │          │  fact_shifts_player     │
├─────────────────────────┤          ├─────────────────────────┤
│ PK: shift_key           │◄────────►│ PK: shift_player_key    │
│ FK: game_id             │          │ FK: shift_key           │
│    shift_index          │          │ FK: game_id             │
│    period               │          │ FK: player_id           │
│    shift_start_seconds  │          │    position_slot        │
│    shift_end_seconds    │          │    is_goalie            │
│    shift_duration       │          └─────────────────────────┘
│    home_team_en         │
│    away_team_en         │
│    home_1..home_6       │
│    away_1..away_6       │
│    situation            │
│    strength             │
└─────────────────────────┘

┌─────────────────────────┐          ┌─────────────────────────┐
│ fact_player_game_stats  │          │  fact_team_game_stats   │
├─────────────────────────┤          ├─────────────────────────┤
│ PK: player_game_key     │          │ PK: team_game_key       │
│ FK: game_id             │          │ FK: game_id             │
│ FK: player_id           │          │ FK: team_id             │
│ FK: team_id             │          │    team_name            │
│    player_name          │          │    venue (Home/Away)    │
│    goals                │          │    goals                │
│    assists              │          │    shots                │
│    points               │          │    sog                  │
│    shots                │          │    fo_wins              │
│    sog                  │          │    fo_losses            │
│    shooting_pct         │          │    fo_pct               │
│    fo_wins              │          │    pass_attempts        │
│    fo_losses            │          │    pass_completed       │
│    fo_pct               │          │    pass_pct             │
│    zone_entries         │          │    giveaways            │
│    zone_entry_control%  │          │    takeaways            │
│    pass_attempts        │          │    shooting_pct         │
│    pass_completed       │          └─────────────────────────┘
│    pass_pct             │
│    giveaways            │
│    takeaways            │
│    shift_count          │
│    logical_shifts       │
│    toi_seconds          │
│    avg_shift_seconds    │
└─────────────────────────┘

┌─────────────────────────┐
│ fact_goalie_game_stats  │
├─────────────────────────┤
│ PK: goalie_game_key     │
│ FK: game_id             │
│ FK: player_id           │
│    player_name          │
│    team_name            │
│    saves                │
│    goals_against        │
│    shots_against        │
│    save_pct             │
│    toi_seconds          │
│    empty_net_ga         │
│    saves_rebound        │
│    saves_freeze         │
│    saves_glove          │
│    saves_blocker        │
│    saves_left_pad       │
│    saves_right_pad      │
│    rebound_control_pct  │
└─────────────────────────┘

┌─────────────────────────┐          ┌─────────────────────────┐
│      fact_h2h           │          │      fact_wowy          │
│  (Head-to-Head)         │          │ (With Or Without You)   │
├─────────────────────────┤          ├─────────────────────────┤
│ PK: h2h_key             │          │ PK: wowy_key            │
│ FK: game_id             │          │ FK: game_id             │
│ FK: player_1_id         │          │ FK: player_1_id         │
│ FK: player_2_id         │          │ FK: player_2_id         │
│    player_1_team        │          │    (same team)          │
│    player_2_team        │          │    shifts_with          │
│    (opposite teams)     │          │    shifts_without       │
│    shifts_together      │          │    cf_with              │
│    toi_together         │          │    ca_with              │
│    gf                   │          │    cf_without           │
│    ga                   │          │    ca_without           │
│    cf                   │          │    cf_pct_with          │
│    ca                   │          │    cf_pct_without       │
│    cf_pct               │          │    cf_pct_diff          │
│    xgf                  │          └─────────────────────────┘
│    xga                  │
└─────────────────────────┘
</code></pre>
<h2 id="primary-key-formats">Primary Key Formats</h2>
<p>All primary keys follow standardized formats:</p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Key Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>fact_events</td>
<td><code>E{game_id}{event_index:05d}</code></td>
<td><code>E1896900001</code></td>
</tr>
<tr>
<td>fact_events_player</td>
<td><code>EP{game_id}{event_index:05d}</code></td>
<td><code>EP1896900001</code></td>
</tr>
<tr>
<td>fact_shifts</td>
<td><code>S{game_id}{shift_index:05d}</code></td>
<td><code>S1896900001</code></td>
</tr>
<tr>
<td>fact_shifts_player</td>
<td><code>SP{game_id}{shift_index:05d}</code></td>
<td><code>SP1896900001</code></td>
</tr>
<tr>
<td>fact_player_game_stats</td>
<td><code>PG{game_id}{player_id}</code></td>
<td><code>PG18969P100192</code></td>
</tr>
<tr>
<td>fact_team_game_stats</td>
<td><code>TG{game_id}{team_abbrev}</code></td>
<td><code>TG18969PLA</code></td>
</tr>
<tr>
<td>fact_goalie_game_stats</td>
<td><code>GG{game_id}{player_id}</code></td>
<td><code>GG18969P100099</code></td>
</tr>
<tr>
<td>fact_h2h</td>
<td><code>H2H{game_id}{p1_id}{p2_id}</code></td>
<td><code>H2H18969P100192P100001</code></td>
</tr>
<tr>
<td>fact_wowy</td>
<td><code>WOWY{game_id}{p1_id}{p2_id}</code></td>
<td><code>WOWY18969P100192P100025</code></td>
</tr>
</tbody>
</table>
<h2 id="foreign-key-relationships">Foreign Key Relationships</h2>
<pre><code>fact_events.game_id ──────────────► dim_schedule.game_id
fact_events.shift_key ────────────► fact_shifts.shift_key
fact_events_player.event_key ─────► fact_events.event_key
fact_events_player.player_id ─────► dim_player.player_id
fact_shifts.game_id ──────────────► dim_schedule.game_id
fact_shifts_player.shift_key ─────► fact_shifts.shift_key
fact_shifts_player.player_id ─────► dim_player.player_id
fact_player_game_stats.game_id ───► dim_schedule.game_id
fact_player_game_stats.player_id ─► dim_player.player_id
fact_player_game_stats.team_id ───► dim_team.team_id
fact_team_game_stats.game_id ─────► dim_schedule.game_id
fact_team_game_stats.team_id ─────► dim_team.team_id
fact_goalie_game_stats.game_id ───► dim_schedule.game_id
fact_goalie_game_stats.player_id ─► dim_player.player_id
fact_h2h.game_id ─────────────────► dim_schedule.game_id
fact_h2h.player_1_id ─────────────► dim_player.player_id
fact_h2h.player_2_id ─────────────► dim_player.player_id
fact_wowy.game_id ────────────────► dim_schedule.game_id
fact_wowy.player_1_id ────────────► dim_player.player_id
fact_wowy.player_2_id ────────────► dim_player.player_id
</code></pre>
<h2 id="table-row-counts-typical-game">Table Row Counts (Typical Game)</h2>
<table>
<thead>
<tr>
<th>Table</th>
<th>Rows per Game</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>dim_player</td>
<td>~30</td>
<td>Both teams' rosters</td>
</tr>
<tr>
<td>dim_team</td>
<td>2</td>
<td>Home + Away</td>
</tr>
<tr>
<td>dim_schedule</td>
<td>1</td>
<td>One row per game</td>
</tr>
<tr>
<td>fact_events</td>
<td>~400-600</td>
<td>All events (deduplicated)</td>
</tr>
<tr>
<td>fact_events_player</td>
<td>~1,200-1,800</td>
<td>Multiple players per event</td>
</tr>
<tr>
<td>fact_shifts</td>
<td>~140-180</td>
<td>Shift segments</td>
</tr>
<tr>
<td>fact_shifts_player</td>
<td>~1,400-1,800</td>
<td>10 players per shift</td>
</tr>
<tr>
<td>fact_player_game_stats</td>
<td>~30</td>
<td>One per player</td>
</tr>
<tr>
<td>fact_team_game_stats</td>
<td>2</td>
<td>One per team</td>
</tr>
<tr>
<td>fact_goalie_game_stats</td>
<td>2</td>
<td>One per goalie</td>
</tr>
<tr>
<td>fact_h2h</td>
<td>~200-400</td>
<td>Opponent pairs</td>
</tr>
<tr>
<td>fact_wowy</td>
<td>~100-200</td>
<td>Teammate pairs</td>
</tr>
</tbody>
</table>
<h2 id="data-types">Data Types</h2>
<h3 id="common-column-types">Common Column Types</h3>
<table>
<thead>
<tr>
<th>Column Pattern</th>
<th>Data Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*_key</code></td>
<td>VARCHAR(20)</td>
<td><code>E1896900001</code></td>
</tr>
<tr>
<td><code>*_id</code></td>
<td>VARCHAR(10)</td>
<td><code>P100192</code></td>
</tr>
<tr>
<td><code>game_id</code></td>
<td>INTEGER</td>
<td><code>18969</code></td>
</tr>
<tr>
<td><code>*_index</code></td>
<td>INTEGER</td>
<td><code>1001</code></td>
</tr>
<tr>
<td><code>*_seconds</code></td>
<td>INTEGER</td>
<td><code>1080</code></td>
</tr>
<tr>
<td><code>*_pct</code></td>
<td>DECIMAL(5,2)</td>
<td><code>55.50</code></td>
</tr>
<tr>
<td><code>*_name</code></td>
<td>VARCHAR(100)</td>
<td><code>John Smith</code></td>
</tr>
<tr>
<td><code>event_type</code></td>
<td>VARCHAR(50)</td>
<td><code>Shot</code></td>
</tr>
<tr>
<td><code>event_detail</code></td>
<td>VARCHAR(100)</td>
<td><code>Shot_OnNetSaved</code></td>
</tr>
<tr>
<td><code>event_successful</code></td>
<td>CHAR(1)</td>
<td><code>s</code> or <code>u</code></td>
</tr>
</tbody>
</table>
<h2 id="indexes-recommended">Indexes (Recommended)</h2>
<pre><code class="language-sql">-- Primary indexes (automatic on PKs)
CREATE INDEX idx_events_game ON fact_events(game_id);
CREATE INDEX idx_events_type ON fact_events(event_type);
CREATE INDEX idx_events_player ON fact_events_player(player_id);
CREATE INDEX idx_shifts_game ON fact_shifts(game_id);
CREATE INDEX idx_player_stats_game ON fact_player_game_stats(game_id);
CREATE INDEX idx_player_stats_player ON fact_player_game_stats(player_id);
CREATE INDEX idx_team_stats_game ON fact_team_game_stats(game_id);
CREATE INDEX idx_goalie_stats_game ON fact_goalie_game_stats(game_id);
</code></pre>
<h2 id="mermaid-erd-for-rendering">Mermaid ERD (for rendering)</h2>
<pre><code class="language-mermaid">erDiagram
    dim_player ||--o{ fact_events_player : &quot;player_id&quot;
    dim_player ||--o{ fact_shifts_player : &quot;player_id&quot;
    dim_player ||--o{ fact_player_game_stats : &quot;player_id&quot;
    dim_player ||--o{ fact_goalie_game_stats : &quot;player_id&quot;
    dim_player ||--o{ fact_h2h : &quot;player_1_id&quot;
    dim_player ||--o{ fact_h2h : &quot;player_2_id&quot;
    dim_player ||--o{ fact_wowy : &quot;player_1_id&quot;
    dim_player ||--o{ fact_wowy : &quot;player_2_id&quot;

    dim_team ||--o{ fact_team_game_stats : &quot;team_id&quot;
    dim_team ||--o{ fact_player_game_stats : &quot;team_id&quot;
    dim_team ||--o{ dim_schedule : &quot;home_team_id&quot;
    dim_team ||--o{ dim_schedule : &quot;away_team_id&quot;

    dim_schedule ||--o{ fact_events : &quot;game_id&quot;
    dim_schedule ||--o{ fact_shifts : &quot;game_id&quot;
    dim_schedule ||--o{ fact_player_game_stats : &quot;game_id&quot;
    dim_schedule ||--o{ fact_team_game_stats : &quot;game_id&quot;
    dim_schedule ||--o{ fact_goalie_game_stats : &quot;game_id&quot;
    dim_schedule ||--o{ fact_h2h : &quot;game_id&quot;
    dim_schedule ||--o{ fact_wowy : &quot;game_id&quot;

    fact_events ||--o{ fact_events_player : &quot;event_key&quot;
    fact_shifts ||--o{ fact_shifts_player : &quot;shift_key&quot;
    fact_events }o--|| fact_shifts : &quot;shift_key&quot;

    dim_player {
        string player_id PK
        string player_name
        int jersey_number
        string position
    }

    dim_team {
        string team_id PK
        string team_name
        string team_abbrev
    }

    dim_schedule {
        int game_id PK
        date game_date
        string home_team_id FK
        string away_team_id FK
        int home_score
        int away_score
    }

    fact_events {
        string event_key PK
        int game_id FK
        string shift_key FK
        int event_index
        string event_type
        string event_detail
    }

    fact_events_player {
        string event_player_key PK
        string event_key FK
        string player_id FK
        string player_role
    }

    fact_shifts {
        string shift_key PK
        int game_id FK
        int shift_index
        int shift_duration
    }

    fact_player_game_stats {
        string player_game_key PK
        int game_id FK
        string player_id FK
        int goals
        int assists
        int points
    }

    fact_team_game_stats {
        string team_game_key PK
        int game_id FK
        string team_id FK
        int goals
        int shots
    }

    fact_goalie_game_stats {
        string goalie_game_key PK
        int game_id FK
        string player_id FK
        int saves
        float save_pct
    }
</code></pre>
<hr />
<p><em>Document Version: 1.0 | Last Updated: December 2024</em></p>
    </div>
</body>
</html>
