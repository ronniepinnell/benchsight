<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenchSight Master Instructions</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #1a365d; border-bottom: 3px solid #3182ce; padding-bottom: 10px; }
        h2 { color: #2c5282; margin-top: 30px; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }
        h3 { color: #2d3748; }
        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #edf2f7;
            font-weight: 600;
        }
        tr:hover { background: #f7fafc; }
        .nav {
            background: #1a365d;
            padding: 15px 20px;
            margin: -40px -40px 30px -40px;
            border-radius: 8px 8px 0 0;
        }
        .nav a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
        }
        .nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html">Home</a>
            <a href="MASTER_INSTRUCTIONS.html">Master Instructions</a>
            <a href="TRACKER_DEV_COMPLETE_GUIDE.html">Tracker Dev</a>
            <a href="DASHBOARD_DEV_COMPLETE_GUIDE.html">Dashboard Dev</a>
            <a href="SCHEMA_AND_ERD.html">Schema</a>
        </nav>
        <h1 id="benchsight-master-instructions-for-next-chat">BenchSight Master Instructions for Next Chat</h1>
<h2 id="project-overview">Project Overview</h2>
<p>BenchSight is a comprehensive hockey analytics platform for the NORAD recreational hockey league. The system processes game tracking data through an ETL pipeline and outputs to a Supabase PostgreSQL database.</p>
<h2 id="current-state-december-2024">Current State (December 2024)</h2>
<h3 id="completed">‚úÖ Completed</h3>
<ul>
<li><strong>ETL Pipeline:</strong> 317 columns, 293 tests passing</li>
<li><strong>Database:</strong> Supabase PostgreSQL at <code>https://uuaowslhpgyiudmbvqze.supabase.co</code></li>
<li><strong>Ground Truth Validation:</strong> 100% game scores, 96% goals, 91% assists</li>
<li><strong>Data Dictionary:</strong> 10 comprehensive files covering all tables</li>
<li><strong>Key Standardization:</strong> <code>{prefix}{game_id}{5d}</code> format for all PKs/FKs</li>
</ul>
<h3 id="tables-in-production">üìä Tables in Production</h3>
<pre><code>DIMENSION TABLES:
- dim_player (player_id, player_name, etc.)
- dim_team (team_id, team_name)
- dim_schedule (game_id, home_team, away_team, scores)

FACT TABLES:
- fact_events (wide format - one row per event)
- fact_events_player (long format - one row per player per event)
- fact_shifts (shift-level data with on-ice players)
- fact_shifts_player (player-shift assignments)
- fact_player_game_stats (29 columns - player aggregates)
- fact_team_game_stats (18 columns - team aggregates)
- fact_goalie_game_stats (19 columns - goalie stats + microstats)
- fact_h2h (head-to-head matchups)
- fact_wowy (with-or-without-you analysis)
</code></pre>
<h3 id="critical-business-rules">üîë Critical Business Rules</h3>
<ol>
<li><strong>player_role is CRITICAL:</strong> Only <code>event_team_player_1</code> gets stat credit</li>
<li><strong>Shots = Corsi:</strong> All shot attempts (60-70 per team is CORRECT)</li>
<li><strong>SOG requires filter:</strong> <code>event_detail IN (Shot_OnNetSaved, Shot_Goal, ...)</code></li>
<li><strong>Assists in play_detail1:</strong> <code>AssistPrimary</code>, <code>AssistSecondary</code></li>
<li><strong>Logical Shifts:</strong> 10-14 typical (continuous periods, not micro-shifts)</li>
</ol>
<h3 id="known-data-gaps">‚ö†Ô∏è Known Data Gaps</h3>
<ul>
<li>Pass completion missing in games 18977, 18981, 18987</li>
<li>Save events show dual perspective (shooter + goalie both credited)</li>
<li>Assist tracking ~83% match rate due to tracking gaps</li>
</ul>
<h2 id="workflow-commands">Workflow Commands</h2>
<pre><code class="language-bash"># Full ETL Pipeline
python etl.py
python scripts/fix_data_integrity.py
python scripts/fix_final_data.py
python scripts/etl_validation.py
pytest tests/

# Generate Data Dictionary
python scripts/generate_data_dictionary_complete.py

# Upload to Supabase
python upload.py
</code></pre>
<h2 id="file-locations">File Locations</h2>
<pre><code>/data/raw/games/{game_id}/     # Raw tracking files
/data/output/                   # ETL output CSVs
/data/output/data_dictionary/   # Data dictionaries
/scripts/                       # Utility scripts
/tracker/                       # Game tracker HTML
/docs/handoff/                  # Handoff documentation
</code></pre>
<h2 id="delivery-checklist">Delivery Checklist</h2>
<p>Before packaging any delivery:
1. Run <code>python scripts/verify_delivery.py</code>
2. Include ALL files (src/, data/raw/, config/, dashboard/, etc.)
3. Verify goals match noradhockey.com
4. Include updated handoff docs and HTML previews
5. Package as <code>benchsight_FINAL_vX_DESCRIPTION.zip</code></p>
<h2 id="key-contacts-resources">Key Contacts &amp; Resources</h2>
<ul>
<li><strong>Supabase Dashboard:</strong> https://supabase.com/dashboard/project/uuaowslhpgyiudmbvqze</li>
<li><strong>Ground Truth:</strong> noradhockey.com game pages</li>
<li><strong>Inspiration Docs:</strong> <code>/docs/handoff/</code> folder</li>
</ul>
<h2 id="next-steps-prioritized">Next Steps (Prioritized)</h2>
<h3 id="immediate">Immediate</h3>
<ol>
<li>Tracker fixes: roster loading from BLB tables</li>
<li>Event/shift ordering and editing capabilities</li>
<li>Ensure all tracked games appear in dropdown</li>
</ol>
<h3 id="short-term">Short-term</h3>
<ol>
<li>Phase 3: Linked events tables</li>
<li>Possession time calculations</li>
<li>Event chains for xG modeling</li>
</ol>
<h3 id="medium-term">Medium-term</h3>
<ol>
<li>XY coordinate integration</li>
<li>Dashboard development</li>
<li>Real game data testing</li>
</ol>
<h2 id="stat-definitions-quick-reference">Stat Definitions Quick Reference</h2>
<table>
<thead>
<tr>
<th>Stat</th>
<th>Formula</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td>Goals</td>
<td>COUNT(event_type="Goal" AND player_role="event_team_player_1")</td>
<td>fact_events</td>
</tr>
<tr>
<td>Assists</td>
<td>COUNT(play_detail1 CONTAINS "Assist")</td>
<td>fact_events_player</td>
</tr>
<tr>
<td>Shots (Corsi)</td>
<td>COUNT(event_type="Shot")</td>
<td>fact_events</td>
</tr>
<tr>
<td>SOG</td>
<td>Shots WHERE event_detail IN (OnNet types)</td>
<td>fact_events</td>
</tr>
<tr>
<td>FO Wins</td>
<td>event_team_player_1 on Faceoff events</td>
<td>fact_events</td>
</tr>
<tr>
<td>FO Losses</td>
<td>opp_team_player_1 on Faceoff events</td>
<td>fact_events</td>
</tr>
<tr>
<td>TOI</td>
<td>SUM(shift_duration) for player's shifts</td>
<td>fact_shifts_player</td>
</tr>
<tr>
<td>Save%</td>
<td>saves / shots_against * 100</td>
<td>fact_goalie_game_stats</td>
</tr>
</tbody>
</table>
<hr />
<p><em>Always provide complete project zip with updated docs, updated handoff docs, and all HTML previews.</em></p>
    </div>
</body>
</html>
