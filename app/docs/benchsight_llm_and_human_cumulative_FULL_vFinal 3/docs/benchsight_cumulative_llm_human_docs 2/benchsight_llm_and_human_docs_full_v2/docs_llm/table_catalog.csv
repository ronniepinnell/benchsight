table_name,layer,grain,primary_key,foreign_keys,source,description,important_notes
stg_events,stage,1 row = 1 raw event row from tracking Excel (per player-role),"game_id, event_index, player_role, team_side","game_id -> dim_games (later), player_id -> dim_players (later)",tracking workbooks in data/raw/games/*,Normalized staging table for event-level records as entered in the tracker/Excel.,Column names normalized to lowercase snake_case; includes many technical columns ending with '_' that may be dropped downstream.
stg_shifts,stage,1 row = 1 raw shift segment per game from tracking Excel (wide: many players in columns),"game_id, shift_index",game_id -> dim_games,tracking workbooks in data/raw/games/*,Staging table for shift segments with players in F/D/G columns and timing fields.,Used to generate long-format shifts with 1 row per player per logical shift.
int_events_long,intermediate,1 row = 1 player-role for 1 event,"game_id, event_index, team_side, role_slot","game_id -> dim_games, player_id -> dim_players, team_id -> dim_teams",stg_events,Expanded view of events with explicit player_id and team_id columns.,Retains event_successful and play_details for microstats; used to build wide headers and chains.
int_events_wide,intermediate,1 row = 1 event,"game_id, event_index","game_id -> dim_games, team_id_for -> dim_teams, team_id_against -> dim_teams",int_events_long,"Event header table with players pivoted into event_player_*, opp_player_* roles and aggregated context fields.",Used as the base for fact_events; joins to shifts and xy to enrich context.
int_shifts_long,intermediate,1 row = 1 player per logical shift,"game_id, player_id, logical_shift_id","game_id -> dim_games, player_id -> dim_players, team_id -> dim_teams",stg_shifts,"Long-format shift table with one row per player per logical shift, including cumulative shift numbers and TOI.",Computed using window functions over shift_index; includes TOI with and without stoppages.
int_chains_sequence,intermediate,1 row = 1 sequence of events (multi-possession),sequence_id,game_id -> dim_games,int_events_long/int_events_wide,"Sequences capturing stretches of play with shared context (e.g., same team in control over multiple zones).",Used for rush vs cycle analysis and xG chains.
fact_events,mart,1 row = 1 event,event_id,"game_id -> dim_games, team_id_for -> dim_teams, team_id_against -> dim_teams, player_id_main -> dim_players","int_events_wide, int_shifts_long, xy join tables, chains",Central fact table for all tracked events used by BI and ML.,"Contains context columns (zone, strength, score state, rating context, sequence/play/linked IDs, xy features)."
fact_shifts,mart,1 row = 1 player’s logical shift in a game,shift_id,"game_id -> dim_games, player_id -> dim_players, team_id -> dim_teams",int_shifts_long,Fact table for time on ice and deployment analysis.,"Includes shift_number_in_game, cumulative_shift_number, TOI, TOI_excl_stoppages, on-ice score, rating context."
fact_box_player,mart,1 row = 1 player in 1 game,box_id,"game_id -> dim_games, player_id -> dim_players, team_id -> dim_teams","fact_events, fact_shifts","Game-level summary stats for players (goals, assists, Corsi, microstats, xG, etc.).",Primary table for player game cards and resume portfolio visuals.
dim_players,mart,1 row = 1 player,player_id,,BLB_Tables dim_player,"Player dimension including ratings, handedness, position, etc.",Player rating (2–6) is key for rating-context features.
dim_teams,mart,1 row = 1 team,team_id,,BLB_Tables dim_team,"Team dimension with names, abbreviations, league, etc.",Used to join to all team-level facts.
