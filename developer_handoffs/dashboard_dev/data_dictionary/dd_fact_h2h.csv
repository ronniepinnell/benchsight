column,type,nullable,description,source,formula,filter_context,tolerance,depends_on,used_by
h2h_key,VARCHAR(20),NO,Primary key,CALCULATED,f'HH{game_id}{pair_sequence:05d}',Per opponent pair per game,,game_id,
game_id,INT,NO,Game identifier,EXPLICIT,From source,,,,Joins
player_1_id,VARCHAR(10),NO,First player in matchup,DERIVED,From shifts where players on ice together on OPPOSITE teams,,,fact_shifts_player,dim_player join
player_1_name,VARCHAR(100),YES,First player name,LOOKUP,fact_gameroster.player_full_name,,,player_1_id,Display
player_1_team,VARCHAR(50),YES,First player team,LOOKUP,fact_gameroster.team_name,,,player_1_id,Stats attribution
player_2_id,VARCHAR(10),NO,Second player (opponent) in matchup,DERIVED,Opponent player on ice same time,,,fact_shifts_player,dim_player join
player_2_name,VARCHAR(100),YES,Second player name,LOOKUP,fact_gameroster.player_full_name,,,player_2_id,Display
player_2_team,VARCHAR(50),YES,Second player team (opponent),LOOKUP,fact_gameroster.team_name,,,player_2_id,Stats attribution
shifts_together,INT,NO,Number of shifts both players on ice,CALCULATED,COUNT(shifts) WHERE p1 on ice AND p2 on ice AND p1.team != p2.team,"Shifts where both on ice, opposite teams",1-50,fact_shifts_player,Time/event filtering
toi_together,INT,YES,Time on ice together in seconds,CALCULATED,SUM(shift_duration) for shifts_together,Same as shifts_together,10-600 seconds,fact_shifts.shift_duration_seconds,Per-60 calculations
gf,INT,NO,Goals for (by player_1 team when both on ice),CALCULATED,COUNT goals by p1 team during shifts_together,p1 team goals during shared ice time,0-5,"fact_events_player Goal events, shifts_together",gf_pct
ga,INT,NO,Goals against (by player_2 team when both on ice),CALCULATED,COUNT goals by p2 team during shifts_together,p2 team goals during shared ice time,0-5,"fact_events_player Goal events, shifts_together",gf_pct
cf,INT,NO,Corsi for (shot attempts by p1 team),CALCULATED,COUNT shot attempts by p1 team during shifts_together,p1 team shots during shared ice time,0-30,"fact_events_player Shot events, shifts_together",cf_pct
ca,INT,NO,Corsi against (shot attempts by p2 team),CALCULATED,COUNT shot attempts by p2 team during shifts_together,p2 team shots during shared ice time,0-30,"fact_events_player Shot events, shifts_together",cf_pct
cf_pct,"DECIMAL(5,2)",YES,Corsi for percentage,CALCULATED,"ROUND(cf / (cf + ca) * 100, 1) IF (cf + ca) > 0 ELSE NULL",Same row,"0-100%, typical 40-60%","cf, ca",
xgf,"DECIMAL(5,2)",YES,Expected goals for,CALCULATED,SUM(shot xG values) for p1 team during shifts_together,p1 team shots during shared ice time,0-3,"xG model, fact_events_player",xgf_pct
xga,"DECIMAL(5,2)",YES,Expected goals against,CALCULATED,SUM(shot xG values) for p2 team during shifts_together,p2 team shots during shared ice time,0-3,"xG model, fact_events_player",xgf_pct
