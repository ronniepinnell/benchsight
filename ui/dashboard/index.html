<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BenchSight Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg: #0f172a; --panel: #1e293b; --card: #334155;
  --border: #475569; --accent: #06b6d4; --accent2: #8b5cf6;
  --success: #10b981; --warn: #f59e0b; --danger: #ef4444;
  --text: #f1f5f9; --muted: #94a3b8;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
.topnav { background: var(--panel); padding: 12px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.topnav h1 { font-size: 20px; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.nav-links { display: flex; gap: 20px; }
.nav-links a { color: var(--muted); text-decoration: none; font-size: 14px; padding: 4px 0; border-bottom: 2px solid transparent; }
.nav-links a:hover, .nav-links a.active { color: var(--accent); border-bottom-color: var(--accent); }
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
h2 { font-size: 20px; color: var(--text); }
.conn-status { display: flex; align-items: center; gap: 8px; }
.conn-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--danger); }
.conn-dot.on { background: var(--success); }
.settings-btn { background: var(--panel); border: 1px solid var(--border); color: var(--text); padding: 8px 16px; border-radius: 6px; cursor: pointer; }
.settings-btn:hover { background: var(--card); }

/* Cards Grid */
.grid { display: grid; gap: 20px; }
.grid-4 { grid-template-columns: repeat(4, 1fr); }
.grid-3 { grid-template-columns: repeat(3, 1fr); }
.grid-2 { grid-template-columns: repeat(2, 1fr); }
@media (max-width: 1200px) { .grid-4 { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px) { .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; } }

.card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.card-title { font-size: 14px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
.card-value { font-size: 36px; font-weight: 700; color: var(--accent); }
.card-subtitle { font-size: 12px; color: var(--muted); margin-top: 4px; }

/* Stats Cards */
.stat-card { display: flex; flex-direction: column; }
.stat-icon { font-size: 24px; margin-bottom: 8px; }
.stat-change { font-size: 11px; padding: 2px 6px; border-radius: 4px; }
.stat-change.up { background: rgba(16,185,129,0.2); color: var(--success); }
.stat-change.down { background: rgba(239,68,68,0.2); color: var(--danger); }

/* Game Selector */
.game-selector { display: flex; gap: 12px; align-items: center; margin-bottom: 24px; }
.game-selector select { background: var(--panel); border: 1px solid var(--border); color: var(--text); padding: 10px 16px; border-radius: 6px; min-width: 300px; font-size: 14px; }
.game-selector select:focus { outline: none; border-color: var(--accent); }

/* Table */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
th { background: var(--card); color: var(--muted); font-weight: 600; text-transform: uppercase; font-size: 11px; }
tr:hover { background: rgba(6,182,212,0.05); }
.num { font-family: 'SF Mono', monospace; }
.positive { color: var(--success); }
.negative { color: var(--danger); }

/* Shot Chart */
.shot-chart { position: relative; width: 100%; aspect-ratio: 2.35; }
.shot-chart svg { width: 100%; height: 100%; }
.shot-dot { cursor: pointer; }
.shot-dot:hover { opacity: 0.8; }

/* Period Bar */
.period-bar { display: flex; gap: 4px; margin-top: 16px; }
.period-seg { flex: 1; height: 32px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
.period-seg.home { background: var(--accent); color: #000; }
.period-seg.away { background: var(--accent2); color: #fff; }

/* Loading */
.loading { display: flex; align-items: center; justify-content: center; height: 200px; color: var(--muted); }
.spinner { width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-right: 12px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; }
.modal-overlay.show { display: flex; }
.modal { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 24px; min-width: 400px; }
.modal h2 { font-size: 18px; margin-bottom: 16px; }
.modal input { width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; font-size: 14px; }
.modal input:focus { outline: none; border-color: var(--accent); }
.modal-actions { display: flex; gap: 8px; margin-top: 16px; }
.modal-actions button { flex: 1; padding: 10px; border-radius: 6px; font-size: 14px; cursor: pointer; }
.btn-primary { background: var(--accent); color: #000; border: none; }
.btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--text); }
</style>
</head>
<body>
<div class="topnav">
  <h1>üèí BenchSight</h1>
  <div class="nav-links">
    <a href="index.html" class="active">Dashboard</a>
    <a href="player.html">Players</a>
    <a href="team.html">Teams</a>
    <a href="game.html">Games</a>
  </div>
</div>
<div class="container">
  <header>
    <h2>Analytics Overview</h2>
    <div class="conn-status">
      <div class="conn-dot" id="connDot"></div>
      <span id="connText">Connecting...</span>
      <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è Settings</button>
    </div>
  </header>

  <!-- Game Selector -->
  <div class="game-selector">
    <select id="gameSelect" onchange="loadGame(this.value)">
      <option value="">-- Select Game --</option>
    </select>
    <span id="gameInfo" style="color:var(--muted);font-size:13px;"></span>
  </div>

  <!-- Stats Overview -->
  <div class="grid grid-4" style="margin-bottom:24px;">
    <div class="card stat-card">
      <span class="stat-icon">üéØ</span>
      <span class="card-title">Total Goals</span>
      <span class="card-value" id="totalGoals">-</span>
      <span class="card-subtitle" id="goalBreakdown">Home - Away</span>
    </div>
    <div class="card stat-card">
      <span class="stat-icon">üèí</span>
      <span class="card-title">Total Shots</span>
      <span class="card-value" id="totalShots">-</span>
      <span class="card-subtitle" id="shotBreakdown">Home - Away</span>
    </div>
    <div class="card stat-card">
      <span class="stat-icon">‚≠ï</span>
      <span class="card-title">Faceoffs</span>
      <span class="card-value" id="totalFaceoffs">-</span>
      <span class="card-subtitle" id="foBreakdown">Win %</span>
    </div>
    <div class="card stat-card">
      <span class="stat-icon">‚ö°</span>
      <span class="card-title">Turnovers</span>
      <span class="card-value" id="totalTurnovers">-</span>
      <span class="card-subtitle" id="toBreakdown">GA - TA</span>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="grid grid-2" style="margin-bottom:24px;">
    <!-- Shot Chart -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Shot Locations</span>
        <select id="shotFilter" onchange="renderShotChart()" style="background:var(--card);border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:4px;font-size:11px;">
          <option value="all">All Shots</option>
          <option value="goals">Goals Only</option>
          <option value="home">Home Only</option>
          <option value="away">Away Only</option>
        </select>
      </div>
      <div class="shot-chart" id="shotChart">
        <svg viewBox="0 0 200 85">
          <rect x="0" y="0" width="200" height="85" fill="#fff" rx="14"/>
          <line x1="65" y1="0" x2="65" y2="85" stroke="#0066cc" stroke-width="1"/>
          <line x1="135" y1="0" x2="135" y2="85" stroke="#0066cc" stroke-width="1"/>
          <line x1="100" y1="0" x2="100" y2="85" stroke="#cc0000" stroke-width="0.5" stroke-dasharray="2,2"/>
          <circle cx="169" cy="22" r="10" fill="none" stroke="#cc0000" stroke-width="0.5"/>
          <circle cx="169" cy="63" r="10" fill="none" stroke="#cc0000" stroke-width="0.5"/>
          <circle cx="31" cy="22" r="10" fill="none" stroke="#cc0000" stroke-width="0.5"/>
          <circle cx="31" cy="63" r="10" fill="none" stroke="#cc0000" stroke-width="0.5"/>
          <rect x="0" y="38" width="3" height="9" fill="#333"/>
          <rect x="197" y="38" width="3" height="9" fill="#333"/>
          <g id="shotMarkers"></g>
        </svg>
      </div>
    </div>

    <!-- Event Timeline -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Scoring by Period</span>
      </div>
      <canvas id="periodChart" height="200"></canvas>
      <div class="period-bar" id="periodBar"></div>
    </div>
  </div>

  <!-- Player Stats Table -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Player Stats</span>
      <select id="teamFilter" onchange="renderPlayerTable()" style="background:var(--card);border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:4px;font-size:11px;">
        <option value="all">All Players</option>
        <option value="home">Home Only</option>
        <option value="away">Away Only</option>
      </select>
    </div>
    <div class="table-wrap">
      <table id="playerTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Team</th>
            <th>G</th>
            <th>A</th>
            <th>PTS</th>
            <th>SOG</th>
            <th>FO%</th>
            <th>+/-</th>
          </tr>
        </thead>
        <tbody id="playerTableBody">
          <tr><td colspan="9" class="loading"><div class="spinner"></div>Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <h2>‚öôÔ∏è Supabase Connection</h2>
    <label style="font-size:12px;color:var(--muted);margin-bottom:4px;display:block;">Supabase URL</label>
    <input type="text" id="sbUrl" placeholder="https://xxx.supabase.co">
    <label style="font-size:12px;color:var(--muted);margin-bottom:4px;display:block;">Anon Key</label>
    <input type="password" id="sbKey" placeholder="eyJ...">
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeSettings()">Cancel</button>
      <button class="btn-primary" onclick="saveSettings()">Connect</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// STATE
// ============================================================
let sb = null;
let connected = false;
let currentGame = null;
let gameData = { events: [], players: [], shots: [] };

// ============================================================
// INIT
// ============================================================
async function init() {
  loadSettings();
  await connect();
  if (connected) await loadGames();
}

function loadSettings() {
  try {
    const s = JSON.parse(localStorage.getItem('bs_dash_settings') || '{}');
    if (s.sbUrl) document.getElementById('sbUrl').value = s.sbUrl;
    if (s.sbKey) document.getElementById('sbKey').value = s.sbKey;
  } catch(e) {}
}

function saveSettings() {
  localStorage.setItem('bs_dash_settings', JSON.stringify({
    sbUrl: document.getElementById('sbUrl').value,
    sbKey: document.getElementById('sbKey').value
  }));
  closeSettings();
  connect();
}

function openSettings() { document.getElementById('settingsModal').classList.add('show'); }
function closeSettings() { document.getElementById('settingsModal').classList.remove('show'); }

// ============================================================
// SUPABASE CONNECTION
// ============================================================
async function connect() {
  const url = document.getElementById('sbUrl').value;
  const key = document.getElementById('sbKey').value;
  
  if (!url || !key) {
    updateConnection(false);
    return;
  }
  
  try {
    sb = supabase.createClient(url, key);
    const { error } = await sb.from('dim_schedule').select('game_id').limit(1);
    if (error) throw error;
    connected = true;
    updateConnection(true);
    await loadGames();
  } catch(e) {
    console.error('Connection failed:', e);
    connected = false;
    updateConnection(false);
  }
}

function updateConnection(on) {
  document.getElementById('connDot').className = 'conn-dot ' + (on ? 'on' : '');
  document.getElementById('connText').textContent = on ? 'Connected' : 'Disconnected';
}

// ============================================================
// LOAD DATA
// ============================================================
async function loadGames() {
  if (!connected) return;
  
  try {
    // ONLY load TRACKED games - paginate through fact_events to get ALL game_ids
    console.log('Dashboard: Loading games from fact_events...');
    
    const allGameIds = new Set();
    let offset = 0;
    const pageSize = 1000;
    let hasMore = true;
    
    while (hasMore && offset < 50000) {
      const { data, error } = await sb.from('fact_events')
        .select('game_id')
        .range(offset, offset + pageSize - 1);
      
      if (error) {
        console.error('Dashboard: Error at offset', offset, ':', error);
        break;
      }
      
      if (!data || data.length === 0) {
        hasMore = false;
      } else {
        data.forEach(r => allGameIds.add(r.game_id));
        console.log(`  Page ${offset/pageSize + 1}: ${data.length} rows, ${allGameIds.size} unique games`);
        offset += pageSize;
        if (data.length < pageSize) hasMore = false;
      }
    }
    
    const trackedGameIds = Array.from(allGameIds);
    console.log('Dashboard: Tracked game IDs:', trackedGameIds);
    
    if (trackedGameIds.length === 0) {
      document.getElementById('gameSelect').innerHTML = '<option value="">No tracked games</option>';
      return;
    }
    
    // Get game details for tracked games only
    const { data, error } = await sb.from('dim_schedule')
      .select('game_id,date,home_team_name,away_team_name')
      .in('game_id', trackedGameIds)
      .order('date', {ascending: false});
    
    if (error) throw error;
    
    console.log('Dashboard: Schedule returned', data?.length, 'rows');
    
    // Dedupe by game_id
    const seen = new Set();
    const uniqueGames = (data || []).filter(g => {
      if (seen.has(g.game_id)) return false;
      seen.add(g.game_id);
      return true;
    });
    
    const sel = document.getElementById('gameSelect');
    sel.innerHTML = '<option value="">-- Select Tracked Game (' + uniqueGames.length + ') --</option>' +
      uniqueGames.map(g => `<option value="${g.game_id}">${g.game_id}: ${g.home_team_name} vs ${g.away_team_name} (${g.date?.split('T')[0] || g.date})</option>`).join('');
    
    console.log('Dashboard: Loaded', uniqueGames.length, 'tracked games');
  } catch(e) {
    console.error('Dashboard: Failed to load games:', e);
  }
}

async function loadGame(gameId) {
  if (!gameId || !connected) return;
  currentGame = parseInt(gameId);
  
  document.getElementById('playerTableBody').innerHTML = '<tr><td colspan="9" class="loading"><div class="spinner"></div>Loading...</td></tr>';
  
  try {
    // Load events
    const { data: events, error: evtErr } = await sb.from('fact_events')
      .select('*')
      .eq('game_id', currentGame);
    if (evtErr) throw evtErr;
    gameData.events = events || [];
    
    // Load event players
    const { data: players, error: plErr } = await sb.from('fact_event_players')
      .select('*')
      .eq('game_id', currentGame);
    if (plErr) throw plErr;
    gameData.players = players || [];
    
    // Update UI
    updateStats();
    renderShotChart();
    renderPeriodChart();
    renderPlayerTable();
    
    // Game info
    const game = document.getElementById('gameSelect').selectedOptions[0]?.text || '';
    document.getElementById('gameInfo').textContent = `${gameData.events.length} events loaded`;
    
  } catch(e) {
    console.error('Failed to load game:', e);
    document.getElementById('playerTableBody').innerHTML = '<tr><td colspan="9" style="color:var(--danger);">Error loading data</td></tr>';
  }
}

// ============================================================
// UPDATE STATS
// ============================================================
function updateStats() {
  const events = gameData.events;
  
  // Goals
  const goals = events.filter(e => e.event_type === 'Goal' && e.event_detail === 'Goal_Scored');
  const homeGoals = goals.filter(e => e.event_team_zone === 'Offensive').length;
  const awayGoals = goals.length - homeGoals;
  document.getElementById('totalGoals').textContent = goals.length;
  document.getElementById('goalBreakdown').textContent = `Home ${homeGoals} - ${awayGoals} Away`;
  
  // Shots
  const shots = events.filter(e => e.event_type === 'Shot' || e.event_type === 'Goal');
  const homeShots = shots.filter(e => e.event_team_zone === 'Offensive').length;
  const awayShots = shots.length - homeShots;
  document.getElementById('totalShots').textContent = shots.length;
  document.getElementById('shotBreakdown').textContent = `Home ${homeShots} - ${awayShots} Away`;
  
  // Faceoffs
  const faceoffs = events.filter(e => e.event_type === 'Faceoff');
  const foWins = faceoffs.filter(e => e.event_successful === 's').length;
  const foPct = faceoffs.length ? Math.round(foWins / faceoffs.length * 100) : 0;
  document.getElementById('totalFaceoffs').textContent = faceoffs.length;
  document.getElementById('foBreakdown').textContent = `${foPct}% win rate`;
  
  // Turnovers
  const turnovers = events.filter(e => e.event_type === 'Turnover');
  const giveaways = turnovers.filter(e => e.event_detail?.includes('Giveaway')).length;
  const takeaways = turnovers.filter(e => e.event_detail?.includes('Takeaway')).length;
  document.getElementById('totalTurnovers').textContent = turnovers.length;
  document.getElementById('toBreakdown').textContent = `${giveaways} GA - ${takeaways} TA`;
}

// ============================================================
// SHOT CHART
// ============================================================
function renderShotChart() {
  const filter = document.getElementById('shotFilter').value;
  const events = gameData.events;
  
  let shots = events.filter(e => e.event_type === 'Shot' || e.event_type === 'Goal');
  
  if (filter === 'goals') shots = shots.filter(e => e.event_type === 'Goal');
  else if (filter === 'home') shots = shots.filter(e => e.event_team_zone === 'Offensive');
  else if (filter === 'away') shots = shots.filter(e => e.event_team_zone === 'Defensive');
  
  const markers = document.getElementById('shotMarkers');
  markers.innerHTML = shots.map(s => {
    // Use puck_x_1, puck_y_1 if available
    const x = s.puck_x_1 || Math.random() * 60 + 135; // Default to offensive zone
    const y = s.puck_y_1 || Math.random() * 60 + 12;
    const isGoal = s.event_type === 'Goal';
    const color = isGoal ? '#10b981' : (s.event_team_zone === 'Offensive' ? '#06b6d4' : '#ef4444');
    const r = isGoal ? 4 : 2.5;
    return `<circle class="shot-dot" cx="${x}" cy="${y}" r="${r}" fill="${color}" opacity="0.8"/>`;
  }).join('');
}

// ============================================================
// PERIOD CHART
// ============================================================
let periodChart = null;
function renderPeriodChart() {
  const events = gameData.events;
  
  // Count goals by period
  const goals = events.filter(e => e.event_type === 'Goal' && e.event_detail === 'Goal_Scored');
  const periods = [1, 2, 3, 'OT'];
  const homeByPeriod = periods.map(p => goals.filter(g => g.period == p && g.event_team_zone === 'Offensive').length);
  const awayByPeriod = periods.map(p => goals.filter(g => g.period == p && g.event_team_zone !== 'Offensive').length);
  
  const ctx = document.getElementById('periodChart').getContext('2d');
  
  if (periodChart) periodChart.destroy();
  
  periodChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['P1', 'P2', 'P3', 'OT'],
      datasets: [
        { label: 'Home', data: homeByPeriod, backgroundColor: '#06b6d4' },
        { label: 'Away', data: awayByPeriod, backgroundColor: '#8b5cf6' }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: true, position: 'top', labels: { color: '#94a3b8', font: { size: 11 } } } },
      scales: {
        x: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } },
        y: { beginAtZero: true, grid: { color: '#334155' }, ticks: { color: '#94a3b8', stepSize: 1 } }
      }
    }
  });
  
  // Period bar
  const shots = events.filter(e => e.event_type === 'Shot' || e.event_type === 'Goal');
  const bar = document.getElementById('periodBar');
  bar.innerHTML = periods.map(p => {
    const pShots = shots.filter(s => s.period == p);
    const home = pShots.filter(s => s.event_team_zone === 'Offensive').length;
    const away = pShots.length - home;
    const total = home + away || 1;
    return `<div class="period-seg home" style="flex:${home/total};">${home}</div><div class="period-seg away" style="flex:${away/total};">${away}</div>`;
  }).join('');
}

// ============================================================
// PLAYER TABLE
// ============================================================
function renderPlayerTable() {
  const filter = document.getElementById('teamFilter').value;
  const players = gameData.players;
  
  // Aggregate stats by player
  const stats = {};
  players.forEach(p => {
    if (!p.player_id) return;
    if (!stats[p.player_id]) {
      stats[p.player_id] = {
        id: p.player_id,
        num: p.player_game_number,
        name: p.player_name,
        team: p.team_venue || 'home',
        goals: 0, assists: 0, shots: 0, foWins: 0, foTotal: 0, plusMinus: 0
      };
    }
    
    const s = stats[p.player_id];
    
    // Goals
    if (p.event_type === 'Goal' && p.player_role === 'event_player_1') s.goals++;
    // Assists
    if (p.event_type === 'Goal' && (p.player_role === 'event_player_2' || p.player_role === 'event_player_3')) s.assists++;
    // Shots
    if ((p.event_type === 'Shot' || p.event_type === 'Goal') && p.player_role === 'event_player_1') s.shots++;
    // Faceoffs
    if (p.event_type === 'Faceoff' && p.player_role === 'event_player_1') {
      s.foTotal++;
      if (p.event_successful === 's') s.foWins++;
    }
  });
  
  // Filter and sort
  let playerList = Object.values(stats);
  if (filter === 'home') playerList = playerList.filter(p => p.team === 'home');
  else if (filter === 'away') playerList = playerList.filter(p => p.team === 'away');
  
  playerList.sort((a, b) => (b.goals + b.assists) - (a.goals + a.assists));
  
  // Render
  const tbody = document.getElementById('playerTableBody');
  if (!playerList.length) {
    tbody.innerHTML = '<tr><td colspan="9" style="color:var(--muted);text-align:center;">No player data</td></tr>';
    return;
  }
  
  tbody.innerHTML = playerList.map(p => `
    <tr>
      <td class="num">${p.num || '-'}</td>
      <td>${p.name || 'Unknown'}</td>
      <td>${p.team === 'home' ? 'üè†' : '‚úàÔ∏è'}</td>
      <td class="num ${p.goals > 0 ? 'positive' : ''}">${p.goals}</td>
      <td class="num">${p.assists}</td>
      <td class="num" style="font-weight:600;">${p.goals + p.assists}</td>
      <td class="num">${p.shots}</td>
      <td class="num">${p.foTotal ? Math.round(p.foWins / p.foTotal * 100) + '%' : '-'}</td>
      <td class="num ${p.plusMinus > 0 ? 'positive' : p.plusMinus < 0 ? 'negative' : ''}">${p.plusMinus > 0 ? '+' : ''}${p.plusMinus}</td>
    </tr>
  `).join('');
}

// ============================================================
// START
// ============================================================
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
